/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/cdk/drag-drop"),require("@angular/material/button"),require("@angular/material/button-toggle"),require("@angular/material/card"),require("@angular/material/dialog"),require("@angular/material/grid-list"),require("@angular/material/icon"),require("@angular/material/list"),require("@angular/material/select"),require("@angular/material/sidenav"),require("@angular/material/slide-toggle"),require("@angular/material/slider"),require("@angular/material/tabs"),require("@angular/material/toolbar"),require("@angular/material/tooltip"),require("@ngx-translate/core"),require("ngx-color-picker"),require("@ajf/core/common"),require("@ajf/core/map"),require("@ajf/core/table"),require("@ajf/core/text"),require("@ajf/material/image"),require("@ajf/material/monaco-editor"),require("rxjs"),require("@ajf/core/reports"),require("rxjs/operators"),require("@ajf/core/models"),require("@ajf/core/forms"),require("@ajf/core/utils"),require("@ajf/core/image"),require("quill")):"function"==typeof define&&define.amd?define("@ajf/material/report-builder",["exports","@angular/common","@angular/core","@angular/forms","@angular/cdk/drag-drop","@angular/material/button","@angular/material/button-toggle","@angular/material/card","@angular/material/dialog","@angular/material/grid-list","@angular/material/icon","@angular/material/list","@angular/material/select","@angular/material/sidenav","@angular/material/slide-toggle","@angular/material/slider","@angular/material/tabs","@angular/material/toolbar","@angular/material/tooltip","@ngx-translate/core","ngx-color-picker","@ajf/core/common","@ajf/core/map","@ajf/core/table","@ajf/core/text","@ajf/material/image","@ajf/material/monaco-editor","rxjs","@ajf/core/reports","rxjs/operators","@ajf/core/models","@ajf/core/forms","@ajf/core/utils","@ajf/core/image","quill"],e):e(((t=t||self).ajf=t.ajf||{},t.ajf.material=t.ajf.material||{},t.ajf.material.reportBuilder={}),t.ng.common,t.ng.core,t.ng.forms,t.ng.cdk.dragDrop,t.ng.material.button,t.ng.material.buttonToggle,t.ng.material.card,t.ng.material.dialog,t.ng.material.gridList,t.ng.material.icon,t.ng.material.list,t.ng.material.select,t.ng.material.sidenav,t.ng.material.slideToggle,t.ng.material.slider,t.ng.material.tabs,t.ng.material.toolbar,t.ng.material.tooltip,t.ngxt.core,t.ngxColorPicker,t.ajf.core.common,t.ajf.core.map,t.ajf.core.table,t.ajf.core.text,t.ajf.material.image,t.ajf.material.monacoEditor,t.rxjs,t.ajf.core.reports,t.rxjs.operators,t.ajf.core.models,t.ajf.core.forms,t.ajf.core.utils,t.ajf.core.image,t.quill)}(this,function(t,e,i,r,o,n,a,s,l,d,c,u,p,g,m,f,h,b,y,v,j,w,x,W,_,S,C,D,T,k,E,M,I,P,R){"use strict";R=R&&R.hasOwnProperty("default")?R.default:R;var O=function(){return(O=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},F=new i.InjectionToken("AJF_REPORTS_CONFIG"),L=function(){function t(t){var c=this;this._customWidgetsUpdate=new D.Subject,this._originUpdate=new D.Subject,this._savedReportUpdate=new D.Subject,this._jsonStack=new D.BehaviorSubject([]),this._emptyContent=new D.BehaviorSubject(!0),this._onDraggedUpdate=new D.Subject,this._onOverUpdate=new D.Subject,this._fixedZoomUpdate=new D.Subject,this._onDragEnterUpdate=new D.Subject,this._headerWidgetsUpdate=new D.Subject,this._contentWidgetsUpdate=new D.Subject,this._footerWidgetsUpdate=new D.Subject,this._colorUpdate=new D.Subject,this._defaultColor=["rgba(0, 0, 0, 1)","rgba(51, 153, 255, 1)","rgba(153, 204, 0, 1)","rgba(255, 102, 0, 1)","rgba(0, 204, 204, 1)","rgba(204, 204, 153, 1)","rgba(255, 153, 0, 1)","rgba(230, 0, 0, 1)","rgba(255, 153, 0, 1)","rgba(255, 255, 0, 1)","rgba(0, 138, 0, 1)","rgba(0, 102, 204, 1)","rgba(153, 51, 255, 1)","rgba(255, 255, 255, 1)","rgba(250, 204, 204, 1)","rgba(255, 235, 204, 1)","rgba(255, 255, 204, 1)","rgba(204, 232, 204, 1)","rgba(204, 224, 245, 1)","rgba(235, 214, 255, 1)","rgba(187, 187, 187, 1)","rgba(240, 102, 102, 1)","rgba(255, 194, 102, 1)","rgba(255, 255, 102, 1)","rgba(102, 185, 102, 1)","rgba(102, 163, 224, 1)","rgba(194, 133, 255, 1)","rgba(136, 136, 136, 1)","rgba(161, 0, 0, 1)","rgba(178, 107, 0, 1)","rgba(178, 178, 0, 1)","rgba(0, 97, 0, 1)","rgba(0, 71, 178, 1)","rgba(107, 36, 178, 1)","rgba(68, 68, 68, 1)","rgba(92, 0, 0, 1)","rgba(102, 61, 0, 1)","rgba(102, 102, 0, 1)","rgba(0, 55, 0, 1)","rgba(0, 41, 102, 1)","rgba(61, 20, 102, 1)"],this._currentWidgetUpdate=new D.BehaviorSubject(null),this._formsVariablesUpdate=new D.BehaviorSubject(null),this._conditionNamesUpdate=new D.BehaviorSubject(null),this._saveReport=new D.BehaviorSubject(null),this._report=new D.BehaviorSubject(null),this._reportStylesUpdate=new D.Subject,this._reportFormsUpdate=new D.Subject,this._updates={header:this._headerWidgetsUpdate,content:this._contentWidgetsUpdate,footer:this._footerWidgetsUpdate,color:this._colorUpdate,customWidgets:this._customWidgetsUpdate},this._saveReportEvent=new i.EventEmitter,this._saveFormulaTOHtml=new i.EventEmitter,this.columnWidthChangedEmitter=new i.EventEmitter,this._iconSets={"ajf-icon":[]},this._lastDeletedJson="",null!=t&&null!=t.icons&&(this._iconSets=O({},this._iconSets,t.icons)),this._origin=this._originUpdate.pipe(k.startWith("header"),k.share()),this._savedReport=this._savedReportUpdate.pipe(k.share()),this._onDragged=this._onDraggedUpdate.pipe(k.startWith(!1),k.share()),this._onOver=this._onOverUpdate.pipe(k.startWith(!1),k.share()),this._fixedZoom=this._fixedZoomUpdate.pipe(k.startWith(!1),k.share()),this._onDragEnter=this._onDragEnterUpdate.pipe(k.share()),this._reportStyles=this._reportStylesUpdate.pipe(k.scan(function(t,e){return e(t)},{}),k.share(),k.startWith({})),this._reportForms=this._reportFormsUpdate.pipe(k.scan(function(t,e){return e(t)},[]),k.share(),k.startWith([])),this._customWidgets=this._customWidgetsUpdate.pipe(k.scan(function(t,e){return e(t)},[]),k.share(),k.startWith([])),this._formsVariables=this._formsVariablesUpdate.pipe(k.filter(function(t){return null!=t}),k.scan(function(t,e){return e(t)},[]),k.publishReplay(1),k.refCount()),this._conditionNames=this._conditionNamesUpdate.pipe(k.filter(function(t){return null!=t}),k.scan(function(t,e){return e(t)},[]),k.share(),k.startWith([])),this._headerWidgets=this._headerWidgetsUpdate.pipe(k.scan(function(t,e){return e(t)},{widgets:[],styles:{}}),k.startWith({widgets:[],styles:{}}),k.publishReplay(1),k.refCount()),this._headerStyles=this._headerWidgets.pipe(k.map(function(t){return null!=t?t.styles:{}})),this._contentWidgets=this._contentWidgetsUpdate.pipe(k.scan(function(t,e){return e(t)},{widgets:[],styles:{}}),k.startWith({widgets:[],styles:{}}),k.publishReplay(1),k.refCount()),this._contentStyles=this._contentWidgets.pipe(k.map(function(t){return null!=t?t.styles:{}})),this._footerWidgets=this._footerWidgetsUpdate.pipe(k.scan(function(t,e){return e(t)},{widgets:[],styles:{}}),k.startWith({widgets:[],styles:{}}),k.publishReplay(1),k.refCount()),this._footerStyles=this._footerWidgets.pipe(k.map(function(t){return null!=t?t.styles:{}})),this._color=this._colorUpdate.pipe(k.scan(function(t,e){return e(t)},this._defaultColor),k.share(),k.startWith(this._defaultColor)),this._currentWidget=this._currentWidgetUpdate.pipe(k.filter(function(t){return null!=t}),k.scan(function(t,e){return e(t)},void 0),k.publishReplay(1),k.refCount()),this._reportForms.pipe(k.filter(function(t){return 0!=t.length}),k.map(function(e){return function(t){return c.fillFormsVariables(e)}})).subscribe(this._formsVariablesUpdate),this._reportForms.pipe(k.filter(function(t){return 0!=t.length}),k.map(function(e){return function(t){return c.fillFormsVariables(e)}})).subscribe(this._conditionNamesUpdate);var e=this._report;e.pipe(k.map(function(d){return function(t){var e=c._defaultColor;if(null==d)return[];c.parseColor(d.styles,e),c.parseColor(d.content.styles,e),c.parseColor(d.footer.styles,e),c.parseColor(d.header.styles,e);for(var r=0;r<d.header.content.length;r++){var i=d.header.content[r];if(c.parseColor(i.styles,e),i instanceof T.AjfReportLayoutWidget)for(var o=i,n=0;n<o.content.length;n++){var a=o.content[n];c.parseColor(a.styles,e);for(var s=0;s<a.content.length;s++){var l=a.content[s];c.parseColor(l.styles,e)}}}return e}})).subscribe(this._colorUpdate),e.pipe(k.map(function(e){return function(t){return null==e||null==e.styles?{}:e.styles}})).subscribe(this._reportStylesUpdate),e.pipe(k.map(function(e){return function(t){return null==e||null==e.header?{widgets:[],styles:{}}:{widgets:e.header.content||[],styles:e.header.styles||{}}}})).subscribe(this._headerWidgetsUpdate),e.pipe(k.map(function(e){return function(t){return null==e||null==e.content?{widgets:[],styles:{}}:{widgets:e.content.content||[],styles:e.content.styles||{}}}})).subscribe(this._contentWidgetsUpdate),e.pipe(k.map(function(e){return function(t){return null==e||null==e.footer?{widgets:[],styles:{}}:{widgets:e.footer.content||[],styles:e.footer.styles||{}}}})).subscribe(this._footerWidgetsUpdate),this._saveReport.pipe(k.map(function(t){return function(t){return null?{}:null}})),this._saveReportEvent.pipe(k.combineLatest(this.report,this.reportForms),k.combineLatest(this._headerWidgets.pipe(k.filter(function(t){return null!=t})),this._contentWidgets.pipe(k.filter(function(t){return null!=t})),this._footerWidgets.pipe(k.filter(function(t){return null!=t})),this._reportStyles.pipe(k.filter(function(t){return null!=t})))).subscribe(function(t){var e={},r=t[0][1],i=null!=t[0][2]?t[0][2]||[]:null!=r&&r.forms||[];e.header={content:t[1].widgets.map(function(t){return t.toJson()}),styles:t[1].styles},e.content={content:t[2].widgets.map(function(t){return t.toJson()}),styles:t[2].styles},e.footer={content:t[3].widgets.map(function(t){return t.toJson()}),styles:t[3].styles},e.styles=t[4];var o=new T.AjfReport(i,{header:new T.AjfReportContainer({content:t[1].widgets,styles:t[1].styles}),content:new T.AjfReportContainer({content:t[2].widgets,styles:t[2].styles}),footer:new T.AjfReportContainer({content:t[3].widgets,styles:t[3].styles}),styles:t[4]});c.setSaveReport(e),c._savedReportUpdate.next(o),c.pushJsonStack(JSON.stringify(e))})}return t.prototype.getFormulaToHtmlEvent=function(){return this._saveFormulaTOHtml.asObservable()},Object.defineProperty(t.prototype,"iconSets",{get:function(){return this._iconSets},enumerable:!0,configurable:!0}),t.prototype.filterNodes=function(t){for(var e=0;e<t.length;e++)(t[e]instanceof M.AjfNodeGroup||t[e]instanceof M.AjfSlide||t[e]instanceof M.AjfRepeatingSlide||t[e]instanceof M.AjfStringField)&&(t.splice(e,1),e--);return t},t.prototype.parseColor=function(e,r){["background-color","backgroundColor","color"].forEach(function(t){e[t]&&-1==r.indexOf(e[t])&&r.push(e[t])})},t.prototype.fillFormsVariables=function(t){for(var e=[],r=0;r<t.length;r++)e[r]={nodes:[],labels:[],names:[],types:[]},null!=t[r].nodes&&0<t[r].nodes.length&&(e[r].nodes=this.filterNodes(M.flattenNodes(t[r].nodes))),e[r].labels=this.extractLabelsNodes(e[r].nodes),e[r].names=this.extractNamesNodes(e[r].nodes),e[r].types=this.extractTypesNodes(e[r].nodes);return e},t.prototype.extractLabelsNodes=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].label);return e},t.prototype.extractNamesNodes=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].name);return e},t.prototype.extractTypesNodes=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];e.push(i.fieldType)}return e},t.prototype.setOrigin=function(t){this._originUpdate.next(t)},t.prototype.roundTo=function(t,e){var r=t*Math.pow(10,e);return(r=Math.floor(r))/Math.pow(10,e)},t.prototype.isNumber=function(t){return/^\d+(\.\d+)?/.test(t)},t.prototype.isNumberArray=function(t){var e=this;return t.forEach(function(t){if(!e.isNumber(t))return!1}),!0},Object.defineProperty(t.prototype,"onDragged",{get:function(){return this._onDragged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onOver",{get:function(){return this._onOver},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fixedZoom",{get:function(){return this._fixedZoom},enumerable:!0,configurable:!0}),t.prototype.fixedZoomIn=function(){this._fixedZoomUpdate.next(!0)},t.prototype.fixedZoomOut=function(){this._fixedZoomUpdate.next(!1)},Object.defineProperty(t.prototype,"onDragEnter",{get:function(){return this._onDragEnter},enumerable:!0,configurable:!0}),t.prototype.dragEnter=function(t,e){this._onDragEnterUpdate.next({array:t,index:e})},t.prototype.dragStarted=function(){this._onDraggedUpdate.next(!0)},t.prototype.dragEnded=function(){this._onDraggedUpdate.next(!1)},t.prototype.overStarted=function(){this._onOverUpdate.next(!0)},t.prototype.overEnded=function(){this._onOverUpdate.next(!1)},t.prototype.dragLeave=function(){this._onDragEnterUpdate.next({})},Object.defineProperty(t.prototype,"report",{get:function(){return this._report.asObservable()},enumerable:!0,configurable:!0}),t.prototype.saveReport=function(){null!=this._saveReportEvent&&this._saveReportEvent.emit()},t.prototype.saveImageFormula=function(r){this._currentWidgetUpdate.next(function(t){if(null==t)return t;var e=t;return e.flag=r,e.icon=r,e})},t.prototype.saveFormulaToHtml=function(t,e){if(null!=this._saveFormulaTOHtml){var r={formula:t,reference:e};this._saveFormulaTOHtml.emit(r)}},t.prototype.setEmptyContent=function(t){this._emptyContent.next(t)},t.prototype.pushJsonStack=function(t){var e=this._jsonStack.getValue();-1===e.indexOf(t)&&t!==this._lastDeletedJson&&e.push(t),this._jsonStack.next(e)},t.prototype.popJsonStack=function(){var t=this._jsonStack.getValue();return t.pop(),this._lastDeletedJson=t.pop(),t.length<=0?(this._lastDeletedJson="",this._jsonStack.next([]),this.updateCurrentWidget(null),this.setEmptyContent(!0),'{"header":{"content":[],"styles":{}},"content":{"content":[],"styles":{}},"footer":{"content":[],"styles":{}},"styles":{}}'):(this._jsonStack.next(t),this._lastDeletedJson)},Object.defineProperty(t.prototype,"columnWidthChanged",{get:function(){return this.columnWidthChangedEmitter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customWidgets",{get:function(){return this._customWidgets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerWidgets",{get:function(){return this._headerWidgets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerStyles",{get:function(){return this._headerStyles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentWidgets",{get:function(){return this._contentWidgets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentStyles",{get:function(){return this._contentStyles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerWidgets",{get:function(){return this._footerWidgets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerStyles",{get:function(){return this._footerStyles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emptyContent",{get:function(){return this._emptyContent},enumerable:!0,configurable:!0}),t.prototype.updateArrayWidgets=function(t,e){if("header"!==t&&"content"!==t&&"footer"!==t)throw new Error("Unknown type "+t);this._updates[t].next(function(t){return e})},Object.defineProperty(t.prototype,"formsVariables",{get:function(){return this._formsVariables},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conditionNames",{get:function(){return this._conditionNames},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentWidget",{get:function(){return this._currentWidget},enumerable:!0,configurable:!0}),t.prototype.updateCurrentWidget=function(e){var r=this;this._currentWidgetUpdate.next(function(t){return r._saveReportEvent.emit(),e})},Object.defineProperty(t.prototype,"getSaveReport",{get:function(){return this._saveReport.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reportSaved",{get:function(){return this._savedReport},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reportStyles",{get:function(){return this._reportStyles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reportForms",{get:function(){return this._reportForms},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),t.prototype.instantColumnValue=function(f,h){var b=this;this._currentWidgetUpdate.next(function(t){if(null==t)return t;var e=t,r=e.columns.length,i=0,o=0,n=0,a=-1,s=!1,l=!1,d=new RegExp("(^[0].[1-9][0-9]$)"),c=new RegExp("(^[0].[1-9]$)"),u=new RegExp("^[1]$"),p=e.columns[h];if(f=Number(b.roundTo(f,2).toFixed(2)),null==e.columns[h])throw new Error("invalid value");for(var g=0;g<r;g++)-1===e.columns[g]&&o++;if(-1==p?(p=.1,o--,f=Number(b.roundTo(1/(r-o),2).toFixed(2)),e.columns[h]=.1):p<.1&&(p=.1),-1!==f){if(1===e.columns.length)return e.columns[0]=1,e;if(f<.1?f=.1:1<f+.1*(r-o-1)&&(f=1-.1*(r-o-1)),p===f&&.1===p)return e.columns[h]=f,e;i=f<p?(s=!0,(p-f)/(r-o-1)):(s=!1,(f-p)/(r-o-1)),(i=Number(b.roundTo(i,2).toFixed(2)))<.01&&(i=.1)}else e.columns[h]=-1,o++,s=!0,i=1==e.columns.length?1:p/(r-o);for(var m=0;m<r;m++)-1!==e.columns[m]&&(m==h?e.columns[h]=f:(s?(e.columns[m]+=i,.9<e.columns[m]&&e.columns.length-o!=1&&(e.columns[m]=.9)):(e.columns[m]-=i,e.columns[m]<.1&&(e.columns[m]=.1)),e.columns[m]=Number(b.roundTo(e.columns[m],2).toFixed(2)),n+=e.columns[m]),n=Number(b.roundTo(n,2).toFixed(2)),0==l&&(a=m,l=!0));-1===f?(e.columns[h]=-1,l&&(e.columns[a]+=Number(b.roundTo(1-n,2).toFixed(2)))):e.columns[h]=Number(b.roundTo(1-n,2).toFixed(2));for(g=0;g<e.columns.length;g++)-1===e.columns[g]||d.test(String(e.columns[g]))||c.test(String(e.columns[g]))||u.test(String(e.columns[g]))||b.instantColumnValue(.1,g);return b.columnWidthChangedEmitter.emit(),b._saveReportEvent.emit(),e})},t.prototype.setImageUrl=function(r){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;return e.setUrl(r),e})},t.prototype.setIcon=function(r){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;return e.setIcon(r),e})},t.prototype.setFlag=function(r){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;return e.setFlag(r),e})},t.prototype.saveCondition=function(e){this._currentWidgetUpdate.next(function(t){return null==t?null:(null!=t.visibility&&(t.visibility.condition=e),t)})},t.prototype.saveChartFormula=function(t,e,r,i,o,n){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;if(null!=e&&null!=e.dataset){var r=new E.AjfFormula,i=new T.AjfAggregation;r.formula=o,i.aggregation=n}return e})},t.prototype.saveTableFormula=function(t,o,n,e,r){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;if(null!=e.dataset){var r=new E.AjfFormula,i=new T.AjfAggregation;r.formula=n,i.aggregation=o}return e})},t.prototype.removeTableMainData=function(t){this._removeFromCurrentWidgetArrayProperty("dataset",t)},t.prototype.removeData=function(t,e){this._currentWidgetUpdate.next(function(t){return t})},t.prototype.setChartType=function(t){this._setCurrentWidgetProperty("type",t)},t.prototype.removeMainData=function(t){this._currentWidgetUpdate.next(function(t){return t})},t.prototype.removeRelatedData=function(t,e){this._currentWidgetUpdate.next(function(t){return t})},t.prototype.setChartBackgroundColor=function(t){this._setCurrentWidgetProperty("backgroundColor",t)},t.prototype.addChartBackgroundColor=function(t){this._addToCurrentWidgetArrayProperty("backgroundColor",t)},t.prototype.removeChartBackgroundColor=function(t){this._removeFromCurrentWidgetArrayProperty("backgroundColor",t)},t.prototype.setChartBorderColor=function(t){this._setCurrentWidgetProperty("borderColor",t)},t.prototype.setChartBorderWidth=function(t){this._setCurrentWidgetProperty("borderWidth",t)},t.prototype.addChartBorderColor=function(t){this._addToCurrentWidgetArrayProperty("borderColor",t)},t.prototype.removeChartBorderColor=function(t){this._removeFromCurrentWidgetArrayProperty("borderColor",t)},t.prototype.setReport=function(t){this._report.next(t)},t.prototype.setSaveReport=function(t){this._saveReport.next(t)},t.prototype.setWidgetStyles=function(i,o){var n=this;this._currentWidgetUpdate.next(function(t){var e=t,r=-1<["font-size","height","width","border-width","border-radius","padding","margin"].indexOf(i);return!r||o instanceof Array||!n.isNumber(o)?r&&o instanceof Array&&n.isNumberArray(o)&&(o=o.join("px ")+"px"):o+="px",e.styles[i]=o,e})},t.prototype.setSectionStyles=function(t,e,r){if("header"!==t&&"content"!==t&&"footer"!==t)throw new Error("uncknow origin "+t);this._updates[t].next(function(t){return t.styles[e]=r,t.styles=O({},t.styles),t})},t.prototype.setReportStyles=function(e,r){this._reportStylesUpdate.next(function(t){return t=null==t?{}:(t[e]=r,O({},t))})},t.prototype.setReportForms=function(e){this._reportFormsUpdate.next(function(t){return e||[]})},t.prototype.addCustomWidgets=function(e,r){this._customWidgetsUpdate.next(function(t){return t=t||[],null!=r&&0<=r?t.splice(r,0,e):t.push(e),t})},t.prototype.resetCustomWidgets=function(){this._customWidgetsUpdate.next(function(t){return t.length=0,t})},t.prototype.changeLabelCustomWidget=function(e,r){this._customWidgetsUpdate.next(function(t){return t[r].type=e,t})},t.prototype.addHeaderWidget=function(t,e){this._addWidgetToContainer(this._headerWidgetsUpdate,t,e)},t.prototype.addContentWidget=function(t,e){this._addWidgetToContainer(this._contentWidgetsUpdate,t,e)},t.prototype.addfooterWidget=function(t,e){this._addWidgetToContainer(this._footerWidgetsUpdate,t,e)},t.prototype.unfixedColumn=function(d){var c=this;this._currentWidgetUpdate.next(function(t){if(null==t)return t;for(var e,r,i=t,o=i.columns.length,n=0,a=0,s=i.columns[d]=0;s<o;s++)-1===i.columns[s]&&a++;e=Number(c.roundTo(1/(o-a),2).toFixed(2));for(var l=0;l<o;l++)-1!==i.columns[l]&&(i.columns[l]=e,n=Number(c.roundTo(n+e,2).toFixed(2)));return 1<(n=Number(c.roundTo(n,2).toFixed(2)))?(r=parseFloat(c.roundTo((n-1)%1,2).toFixed(2)),i.columns[d]-=r,i.columns[d]=c.roundTo(i.columns[d],2)):n<1&&(i.columns[d]+=1-n%1,i.columns[d]=Number(c.roundTo(i.columns[d],2).toFixed(2))),i})},t.prototype.addColumn=function(){var u=this;this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e,r,i=t,o=[],n=i.columns.length+1,a=0,s=0;if(10<n)throw new Error("exceed max columns");for(var l=0;l<n;l++)-1===i.columns[l]&&s++;e=Number(u.roundTo(1/(n-s),2).toFixed(2));for(var d=0;d<n;d++)-1===i.columns[d]?o.push(-1):(o.push(e),a=Number(u.roundTo(a+e,2).toFixed(2)));1<(a=Number(u.roundTo(a,2).toFixed(2)))?(r=parseFloat(u.roundTo((a-1)%1,2).toFixed(2)),o[0]-=r,o[0]=u.roundTo(o[0],2)):a<1&&(o[0]+=1-a%1,o[0]=Number(u.roundTo(o[0],2).toFixed(2))),i.columns=o;var c={widgetType:7,value:i.columns[i.columns.length-1]};return i.content.push(new T.AjfReportColumnWidget(c)),u._saveReportEvent.emit(),i})},t.prototype.removeWidgetToColumn=function(t,e){t.content.splice(e,1)},t.prototype.remove=function(r,o){var n=this;switch(r){case"header":case"content":case"footer":this._updates[r].next(function(t){if(0===t.widgets.length)throw new Error("you can not remove from empty array");if(null==t.widgets[o])throw new Error("invalid index");return t.widgets.splice(o,1),n.updateCurrentWidget(null),t});break;case"layout":this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;if(1===e.columns.length)return e.content[0].content.length=0,e;if(null==e.columns[o])throw new Error("this content is undefined");var r=e.columns[o]/(e.columns.length-1);1<e.columns.length&&(e.columns.splice(o,1),e.content.splice(o,1));for(var i=0;i<e.columns.length;i++)e.columns[i]+=r;return n.instantColumnValue(e.columns[0],0),e});break;case"column":case"layoutContent":case"unfixedColumn":this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;if("column"===r)t.content.splice(o,1);else if("layoutContent"===r){if(0===e.columns.length)throw new Error("the column length is 0");if(0===e.content.length)throw new Error("can not remove any widget from empty content");if(null!=e.columns[o]&&null==e.content[o])throw new Error("this content is undefined")}else if("unfixedColumn"===r){if(-1!==e.columns[o])throw new Error("the column position value  isnt -1");n.unfixedColumn(o)}return e});break;case"customWidgets":this._updates[r].next(function(t){if(0===t.length)throw new Error("you can not remove from empty array");if(null==t[o])throw new Error("invalid index");return t.splice(o,1),t});break;default:throw new Error("unknown node "+r)}},t.prototype.addToContent=function(r,i){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t;return null!=e.content[i]&&e.content.splice(i,1),e.content.splice(i,0,r),e})},t.prototype.addToColumn=function(t,e,r){if(t.dragData&&null!=t.dragData.fromColumn){var i=t.dragData.fromColumn,o=t.dragData.widget,n=t.dragData.fromIndex;i.content.splice(n,1),e.content.push(o)}else if(t.dragData&&t.dragData.arrayFrom)this.remove(t.dragData.arrayFrom,t.dragData.fromIndex),e.content.push(t.dragData.widget);else if(t.dragData&&t.dragData.json){var a=JSON.parse(t.dragData.json),s=T.AjfReportWidget.fromJson(a);null!=r?e.content.splice(r,0,s):e.content.push(s)}else{a={widgetType:T.AjfReportWidgetType[t.dragData]},s=T.AjfReportWidget.fromJson(a);null!=r?e.content.splice(r,0,s):e.content.push(s)}},t.prototype.changePositionOnColumn=function(t,e,r){var i=t.dragData.fromColumn,o=t.dragData.fromIndex,n=i.content[o],a=i.content[r];i==e?(i.content[o]=a,i.content[r]=n):(i.content.splice(o,1),e.content.splice(r,0,n))},t.prototype.fixedColumn=function(t){this.instantColumnValue(-1,t)},t.prototype.changeColumn=function(t,e,r){if(!(e<0||e>=r.content.length||t>r.content.length-1&&t<e)){var i=r.content[t],o=r.columns[t],n=r.content[e],a=r.columns[e];r.content[t]=n,r.columns[t]=a,r.content[e]=i,r.columns[e]=o,this.updateCurrentWidget(r)}},t.prototype.addCustomColor=function(e){this._updates.color.next(function(t){return t.indexOf(e)<0&&t.push(e),t})},t.prototype._addWidgetToContainer=function(t,e,r){t.next(function(t){return null!=r&&0<=r?t.widgets.splice(r,0,e):t.widgets.push(e),t}),this.updateCurrentWidget(e),this.setEmptyContent(!1)},t.prototype._setCurrentWidgetProperty=function(e,r){this._currentWidgetUpdate.next(function(t){return null==t?null:(t[e]=r,t)})},t.prototype._addToCurrentWidgetArrayProperty=function(r,i){this._currentWidgetUpdate.next(function(t){if(null==t)return null;var e=t[r];return e.push(i),t[r]=e,t})},t.prototype._removeFromCurrentWidgetArrayProperty=function(e,r){this._currentWidgetUpdate.next(function(t){return t[e].splice(r,1),t})},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:void 0,decorators:[{type:i.Optional},{type:i.Inject,args:[F]}]}]},t}(),A=function(){function t(t){this._service=t,this.showActions=!1,this.layoutShow=!1,this.onDragged=!1,this._onDraggedSub=D.Subscription.EMPTY}return t.prototype.addToList=function(t,e,r){this.onDragEndHandler(),t.dragData.fromColumn?this._service.changePositionOnColumn(t,r,e):this._service.addToColumn(t,r,e)},t.prototype.onDragStartHandler=function(){var t=this,e=D.timer(200).subscribe(function(){e.unsubscribe(),t._service.dragStarted()})},t.prototype.onDragEndHandler=function(){this._service.dragEnded()},t.prototype.ngOnInit=function(){var e=this;this._onDraggedSub=this._service.onDragged.subscribe(function(t){e.onDragged=t})},t.prototype.ngOnDestroy=function(){this._onDraggedSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-column",template:'<ng-template [ngIf]="column.content != null"><div class="ajf-column" [ngClass]="{\'ajf-is-on-over\': showActions}" (mouseenter)="showActions = true" (mouseleave)="showActions = false"><mat-list><ng-template ngFor let-widget let-idx="index" [ngForOf]="column.content"><ng-template [ngIf]="!onDragged"><ajf-report-builder-widgets-row-buttons cdkDrag [cdkDragData]="{fromColumn: column, fromIndex: idx, widget: widget, dropZones: [\'widget\']}" [from]="\'column\'" [fromWidget]="column" [widget]="widget" [position]="idx" [child]="true" (cdkDragStarted)="onDragStartHandler()" (cdkDragEnded)="onDragEndHandler()"></ajf-report-builder-widgets-row-buttons></ng-template><ajf-report-builder-renderer-widget [widget]="widget"></ajf-report-builder-renderer-widget></ng-template></mat-list></div></ng-template>',styles:[".ajf-column{max-width:100%;max-height:100%;background:rgba(0,0,0,0);z-index:100}.ajf-column span{flex-direction:row;width:100%}.ajf-column .mat-list{padding:0}.ajf-column:hover span,.ajf-is-on-over span{visibility:visible!important;display:block!important}.ajf-column-drop-zone{margin:10%;height:50px;background-color:#fff;border:9px solid rgba(66,134,244,.6);border-radius:16px}mat-list{height:100%;padding:0}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t.propDecorators={column:[{type:i.Input}]},t}();function B(t){return"widgetType."+t}function z(t){for(t=t.trim();0<t.indexOf("  ");)t=t.replace("  "," ");return t}var V=function(){function t(t){this._service=t,this.isValid=!1,this.names=[],this.conditionText="true",this.operators=["( )","' '","<","<=","==",">=",">","!=","!","&&","||","+","-","*","/","%","true","false"],this._conditionNamesSub=D.Subscription.EMPTY}return t.prototype.extractNames=function(t){for(var e=this.names.length=0;e<t.length;e++)this.names=this.names.concat(t[e].names)},t.prototype.setCurrent=function(t,e){this.currentId=t,this.appendText(this.formsVariables[t].names[e]),this.checkValidation()},t.prototype.validateCondition=function(){return E.AjfCondition.validate(this.conditionText,this.names)},t.prototype.appendText=function(t,e){if(null!=t&&null!=this.conditionTextArea){var r,i=this.conditionTextArea.nativeElement,o=Math.min(i.selectionStart,i.selectionEnd),n=Math.max(i.selectionStart,i.selectionEnd),a=this.conditionText.substr(0,o),s=this.conditionText.substr(n),l=a.length;a=z(a),s=z(s),o+=a.length-l+t.length+(0<a.length?2:1),r=0<a.length?a+" ":"",this.conditionText=""+r+t+" "+s;var d=D.timer(0).subscribe(function(){if(d&&!d.closed&&d.unsubscribe(),i.createTextRange){var t=i.createTextRange();t.move("character",o),t.select()}else i.selectionStart?(i.focus(),i.setSelectionRange(o,o)):i.focus()})}},t.prototype.checkValidation=function(){this.isValid=this.validateCondition(),this.isValid&&this.saveCondition()},t.prototype.saveCondition=function(){this._service.saveCondition(this.conditionText)},t.prototype.hideErrorMessage=function(){this.errorMessage},t.prototype.ngOnInit=function(){var e=this;this.conditionText=this.visibility.condition,this.isValid=!0,"true"==this.conditionText&&(this.conditionText=""),this._conditionNamesSub=this._service.conditionNames.subscribe(function(t){null!=(e.formsVariables=t)&&e.extractNames(e.formsVariables)})},t.prototype.ngOnDestroy=function(){this._conditionNamesSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-condition-editor",template:'<ng-template [ngIf]="formsVariables != null && visibility != null"><mat-card><mat-card-header><mat-card-title>condition of visibility</mat-card-title><mat-card-subtitle><ng-template [ngIf]="visibility">{{visibility.condition}}</ng-template></mat-card-subtitle></mat-card-header><mat-card-content><br><form><mat-select [(ngModel)]="a" [ngModelOptions]="{standalone: true}" placeholder="Select condition"><ng-template ngFor let-form let-id="index" [ngForOf]="formsVariables"><mat-option *ngFor="let label of form.labels;let i = index;" [value]="label" (click)="setCurrent(id, i)">{{ id}}: {{ label }}</mat-option></ng-template></mat-select><mat-select [(ngModel)]="b" [ngModelOptions]="{standalone: true}" placeholder="Select operator"><mat-option *ngFor="let operator of operators" (click)="appendText(operator);">{{ operator }}</mat-option></mat-select></form></mat-card-content><mat-card-actions><ng-template [ngIf]="!isValid"><ng-container translate>Invalid condition! Please check syntax.</ng-container></ng-template><textarea (focus)="hideErrorMessage()" #conditionTextArea [(ngModel)]="conditionText" (keyup)="checkValidation()"> </textarea></mat-card-actions></mat-card></ng-template>',styles:["ajf-report-builder-condition-editor textarea{width:100%}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t.propDecorators={visibility:[{type:i.Input}],conditionTextArea:[{type:i.ViewChild,args:["conditionTextArea"]}],errorMessage:[{type:i.ViewChild,args:["errorMessage"]}]},t}(),N=function(){function t(t,e){this.service=t,this.cdRef=e,this.onDragged=!1,this.fixedZoom=!1,this.onDragEnter={},this.show=!1,this.headerWidgets=[],this.contentWidgets=[],this.footerWidgets=[],this.onOver=!1,this.currentWidget=null,this.showActions=!1,this._onDraggedSub=D.Subscription.EMPTY,this._fixedZoomSub=D.Subscription.EMPTY,this._onDragEnterSub=D.Subscription.EMPTY,this._headerWidgetsSub=D.Subscription.EMPTY,this._contentWidgetsSub=D.Subscription.EMPTY,this._footerWidgetsSub=D.Subscription.EMPTY,this._onOverSub=D.Subscription.EMPTY,this._currentWidgetSub=D.Subscription.EMPTY,this.headerStyles=this.service.headerStyles,this.contentStyles=this.service.contentStyles,this.footerStyles=this.service.footerStyles}return t.prototype.onMouseOver=function(){this.showActions=!0,this.service.overStarted()},t.prototype.onMouseLeave=function(){this.showActions=!1,this.service.overEnded()},t.prototype.canDropPredicate=function(e){return function(t){return t.data.dropZones.forEach(function(t){if(-1<e.indexOf(t))return!0}),!1}},t.prototype.isLayout=function(t){return t instanceof T.AjfReportLayoutWidget},t.prototype.onDragStartHandler=function(){var t=this,e=D.timer(200).subscribe(function(){null!=e&&e.unsubscribe(),t.service.dragStarted()})},t.prototype.onDragEndHandler=function(){this.service.dragEnded()},t.prototype.onDragEnterHandler=function(t,e){this.service.dragEnter(t,e)},t.prototype.onDragLeaveHandler=function(){this.service.dragLeave()},t.prototype.onDragEnterCheck=function(t,e){return t===this.onDragEnter.array&&(e===this.onDragEnter.index||-1===e)},t.prototype.remove=function(t,e){this.service.remove(t,e)},t.prototype.addToList=function(t,e,r){this.onDragEndHandler(),this.service.setOrigin(t);var i=e.item.data;if(null!=i.fromColumn)this.service.removeWidgetToColumn(i.fromColumn,i.fromIndex),this.currentWidget=i.widget;else if(null!=i.widget)this.remove(i.arrayFrom,i.from),this.currentWidget=i.widget;else if(null!=i.json&&""!==i.json)this.currentWidget=T.AjfReportWidget.fromJson(JSON.parse(I.deepCopy(i.json)));else{var o={widgetType:T.AjfReportWidgetType[i.widgetType]};this.currentWidget=T.AjfReportWidget.fromJson(o)}if(this.onDragEndHandler(),null!=this.currentWidget)switch(t){case"header":this.service.addHeaderWidget(this.currentWidget,r);break;case"content":this.service.addContentWidget(this.currentWidget,r);break;case"footer":this.service.addfooterWidget(this.currentWidget,r)}this.onDragLeaveHandler()},t.prototype.ngOnInit=function(){var e=this;this._headerWidgetsSub=this.service.headerWidgets.subscribe(function(t){e.headerWidgets=t.widgets}),this._contentWidgetsSub=this.service.contentWidgets.subscribe(function(t){e.contentWidgets=t.widgets}),this._footerWidgetsSub=this.service.footerWidgets.subscribe(function(t){e.footerWidgets=t.widgets}),this._onDraggedSub=this.service.onDragged.subscribe(function(t){e.onDragged=t}),this._fixedZoomSub=this.service.fixedZoom.subscribe(function(t){e.fixedZoom=t}),this._onDragEnterSub=this.service.onDragEnter.subscribe(function(t){e.onDragEnter=t}),this._onOverSub=this.service.onOver.subscribe(function(t){e.onOver=t})},t.prototype.ngAfterViewChecked=function(){this.cdRef.detectChanges()},t.prototype.ngOnDestroy=function(){[this._headerWidgetsSub,this._contentWidgetsSub,this._footerWidgetsSub,this._currentWidgetSub,this._onDraggedSub,this._fixedZoomSub,this._onOverSub,this._onDragEnterSub].forEach(function(t){t.unsubscribe()})},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-content",template:'<div class="ajf-overlay" [ngClass]="{\'ajf-drag-mode\': onDragged, \'ajf-zoom-mode\': fixedZoom}" [applyStyles]="reportStyles|async" (mouseenter)="show = true" (mouseleave)="show = false"><div class="ajf-header" [ngClass]="{\'ajf-is-on-over\': onDragged || show}" [applyStyles]="(headerStyles|async)"><mat-list *ngFor="let t of headerWidgets; let i = index"><div cdkDropList class="ajf-drop-zone" [ngClass]="{\'ajf-show\': true}" [cdkDropListEnterPredicate]="canDropPredicate([\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'header\', $event, i);" (dragenter)="onDragEnterHandler(\'header\', i)" (dragleave)="onDragLeaveHandler()"></div><ajf-report-builder-widgets-row-buttons cdkDrag [cdkDragData]="{widget: t,fromIndex: i,arrayFrom: \'header\', dropZones: [\'widget\',\'column\']}" [style.display]="(showActions || onDragged)? \'block\' : \'none\'" [from]="\'header\'" [widget]="t" [position]="i" (cdkDragStarted)="onDragStartHandler();" (cdkDragEnded)="onDragEndHandler()"></ajf-report-builder-widgets-row-buttons><ajf-report-builder-renderer-widget [widget]="t" [position]="i" [section]="\'header\'" (currentWidget)="currentWidget"></ajf-report-builder-renderer-widget></mat-list><div cdkDropList class="ajf-drop-zone-container" [ngClass]="{\'ajf-show\': true}" [cdkDropListEnterPredicate]="canDropPredicate([\'header\',\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'header\', $event)" (dragenter)="onDragEnterHandler(\'header\', headerWidgets?.length)" (dragleave)="onDragLeaveHandler()"></div></div><div class="ajf-content" [ngClass]="{\'ajf-is-on-over\': onDragged || show}" [applyStyles]="contentStyles|async"><mat-list *ngFor="let t of contentWidgets; let i = index"><div cdkDropList class="ajf-drop-zone" [ngClass]="{\'ajf-show\': true}" [cdkDropListEnterPredicate]="canDropPredicate([\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'content\', $event, i)" (dragenter)="onDragEnterHandler(\'content\', i)" (dragleave)="onDragLeaveHandler()"></div><ajf-report-builder-widgets-row-buttons cdkDrag [cdkDragData]="{widget: t, fromIndex: i, arrayFrom: \'content\', dropZones: [\'widget\',\'column\']}" [style.display]="showActions ? \'block\' : \'none\'" [from]="\'content\'" [widget]="t" [position]="i" (cdkDragStarted)="onDragStartHandler()" (cdkDragEnded)="onDragEndHandler();"></ajf-report-builder-widgets-row-buttons><ajf-report-builder-renderer-widget [widget]="t" [position]="i" [section]="\'content\'" (currentWidget)="currentWidget"></ajf-report-builder-renderer-widget></mat-list><div cdkDropList class="ajf-drop-zone-container" [ngClass]="{\'ajf-show\': onDragged}" [cdkDropListEnterPredicate]="canDropPredicate([\'content\',\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'content\', $event)" (dragenter)="onDragEnterHandler(\'content\', contentWidgets?.length)" (dragleave)="onDragLeaveHandler()"><label translate>Drop here</label></div></div><div class="ajf-footer" [ngClass]="{\'ajf-is-on-over\': onDragged || show}" [applyStyles]="footerStyles|async"><mat-list *ngFor="let t of footerWidgets; let i = index"><div cdkDropList class="ajf-drop-zone" [ngClass]="{\'ajf-show\': true}" [cdkDropListEnterPredicate]="canDropPredicate([\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'footer\', $event, i)" (dragenter)="onDragEnterHandler(\'footer\', i)" (dragleave)="onDragLeaveHandler()"></div><ajf-report-builder-widgets-row-buttons cdkDrag [cdkDragData]="{widget: t, fromIndex: i, arrayFrom: \'footer\', dropZones: [\'widget\',\'column\']}" [style.display]="showActions ? \'block\' : \'none\'" [from]="\'footer\'" [widget]="t" [position]="i" (cdkDragStarted)="onDragStartHandler()" (cdkDragEnded)="onDragEndHandler()"></ajf-report-builder-widgets-row-buttons><ajf-report-builder-renderer-widget [widget]="t" [position]="i" [section]="\'footer\'" (currentWidget)="currentWidget"></ajf-report-builder-renderer-widget></mat-list><div cdkDropList class="ajf-drop-zone-container" [ngClass]="{\'ajf-show\': onDragged}" [cdkDropListEnterPredicate]="canDropPredicate([\'footer\',\'widget\',\'column\'])" (cdkDropListDropped)="addToList(\'footer\', $event)" (dragenter)="onDragEnterHandler(\'footer\', headerWidgets?.length)" (dragleave)="onDragLeaveHandler()"><label translate>Drop here</label></div></div></div>',styles:["ajf-report-builder-content{text-align:center;display:block;margin-bottom:300px}ajf-report-builder-content .ajf-overlay.ajf-drag-mode{max-height:700px;margin-top:50px;background-color:beige}ajf-report-builder-content .ajf-drag-mode{overflow:scroll;zoom:50%}ajf-report-builder-content .ajf-drag-mode .ajf-content,ajf-report-builder-content .ajf-drag-mode .ajf-footer,ajf-report-builder-content .ajf-drag-mode .ajf-header{margin-bottom:20px;border:23px solid rgba(66,134,244,.2)}ajf-report-builder-content .ajf-drag-mode .ajf-content .ajf-drop-zone,ajf-report-builder-content .ajf-drag-mode .ajf-footer .ajf-drop-zone,ajf-report-builder-content .ajf-drag-mode .ajf-header .ajf-drop-zone{width:auto;background-color:rgba(66,134,244,.2);border:23px solid #fff;position:relative;min-height:50px!important;z-index:0;opacity:1}ajf-report-builder-content .ajf-drag-mode .ajf-content .ajf-drop-zone-container,ajf-report-builder-content .ajf-drag-mode .ajf-footer .ajf-drop-zone-container,ajf-report-builder-content .ajf-drag-mode .ajf-header .ajf-drop-zone-container{background-color:rgba(66,134,244,.2)!important;border:23px solid #fff!important}ajf-report-builder-content .ajf-drag-mode .ajf-footer,ajf-report-builder-content .ajf-drag-mode .ajf-header{border:23px solid rgba(255,102,102,.4)!important}ajf-report-builder-content .ajf-drag-mode .ajf-footer .ajf-drop-zone-container,ajf-report-builder-content .ajf-drag-mode .ajf-header .ajf-drop-zone-container{background-color:rgba(255,102,102,.4)!important}ajf-report-builder-content .ajf-drag-mode .ajf-footer .ajf-drop-zone,ajf-report-builder-content .ajf-drag-mode .ajf-header .ajf-drop-zone{background-color:rgba(255,102,102,.4)!important}ajf-report-builder-content .ajf-drag-mode .ajf-drop-zone-container{background-color:#000;border:16px solid #fff;position:relative;opacity:0;z-index:0;min-height:50px!important;display:none!important}ajf-report-builder-content .ajf-zoom-mode{zoom:50%}ajf-report-builder-content .ajf-content,ajf-report-builder-content .ajf-footer,ajf-report-builder-content .ajf-header{height:100%;min-height:50px;position:relative;text-align:center;display:block}ajf-report-builder-content .ajf-content .mat-list,ajf-report-builder-content .ajf-footer .mat-list,ajf-report-builder-content .ajf-header .mat-list{padding:0}ajf-report-builder-content .ajf-content .ajf-zoom:hover,ajf-report-builder-content .ajf-footer .ajf-zoom:hover,ajf-report-builder-content .ajf-header .ajf-zoom:hover{padding-bottom:100px;overflow-y:scroll}ajf-report-builder-content .ajf-content:hover{background-color:rgba(66,134,244,.2)!important}ajf-report-builder-content .ajf-footer:hover,ajf-report-builder-content .ajf-header:hover{background-color:rgba(255,102,102,.4)}ajf-report-builder-content .ajf-content:hover,ajf-report-builder-content .ajf-footer:hover,ajf-report-builder-content .ajf-header:hover,ajf-report-builder-content .ajf-is-on-over{border:3px dotted #3a7999}ajf-report-builder-content .ajf-content:hover label,ajf-report-builder-content .ajf-footer:hover label,ajf-report-builder-content .ajf-header:hover label,ajf-report-builder-content .ajf-is-on-over label{visibility:visible!important;opacity:.4;display:block!important}ajf-report-builder-content .ajf-content:hover .ajf-drop-zone-container,ajf-report-builder-content .ajf-footer:hover .ajf-drop-zone-container,ajf-report-builder-content .ajf-header:hover .ajf-drop-zone-container,ajf-report-builder-content .ajf-is-on-over .ajf-drop-zone-container{display:block!important}ajf-report-builder-content .ajf-content:hover mat-list button,ajf-report-builder-content .ajf-footer:hover mat-list button,ajf-report-builder-content .ajf-header:hover mat-list button,ajf-report-builder-content .ajf-is-on-over mat-list button{display:inline}ajf-report-builder-content .ajf-my-content{width:100%;white-space:nowrap;overflow-y:auto}ajf-report-builder-content .ajf-on-drag-over,ajf-report-builder-content .ajf-show{opacity:1!important;z-index:10}ajf-report-builder-content mat-list{position:relative;display:block}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush,host:{"(mouseover)":"onMouseOver()","(mouseleave)":"onMouseLeave()"}}]}],t.ctorParameters=function(){return[{type:L},{type:i.ChangeDetectorRef}]},t}(),U=function(){function t(t,e){this.service=t,this._dialogRef=e}return t.prototype.changeLabel=function(){this.service.changeLabelCustomWidget(this.label,this.position),this._dialogRef.close()},t.decorators=[{type:i.Component,args:[{selector:"custom-widget-dialog",template:'<h3 matDialogTitle>set the label widget</h3><mat-form-field><input matInput placeholder="add the label of this custom widget" [(ngModel)]="label"></mat-form-field><button matDialogClose (click)="changeLabel()">Ok</button>',encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialogRef}]},t.propDecorators={label:[{type:i.Input}],position:[{type:i.Input}]},t}(),H=function(){function t(t){this._service=t,this.customWidgets=[]}return t.prototype.remove=function(){this._service.remove("customWidgets",this.position)},t.prototype.ngOnInit=function(){this.widgetIcon="widget-"+this.widgetType.toLowerCase(),this.widgetLabel=B(this.widgetType)},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-custom-widget-toolbar-button",inputs:["widgetType","position"],template:'<a mat-button>{{ widgetType}} <i class="material-icons" (click)="remove()">remove_circle_outline</i></a>',styles:["ajf-report-builder-custom-widget-toolbar-button{margin-right:20px}ajf-report-builder-custom-widget-toolbar-button a{min-height:60px;margin-top:20px}ajf-report-builder-custom-widget-toolbar-button a i{display:none}ajf-report-builder-custom-widget-toolbar-button a:hover i{display:inline;position:absolute!important;margin-left:5px!important;z-index:5}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t}(),q=function(){function t(t,e){this.service=t,this.dialog=e,this.customWidgets=[],this._customWidgetsSub=D.Subscription.EMPTY,this._threeColumnsLayout='{"widgetType":0,"content":[],"styles":{},"visibility":{"condition":"true"},"columns":[0.34,0.33,0.33],"content":[{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]},{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]},{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]}]}',this._fourColumnsLayout='{"widgetType":0,"content":[],"styles":{},"visibility":{"condition":"true"},"columns":[0.25,0.25,0.25,0.25],"content":[{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]},{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]},{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]},{"widgetType":7,"content":[],"styles":{},"visibility":{"condition":"true"},"content":[]}]}'}return t.prototype.openDialog=function(t){this._dialogRef=this.dialog.open(U),this._dialogRef.componentInstance.label=this.customWidgets[t].type,this._dialogRef.componentInstance.position=t},t.prototype.onDragStartHandler=function(){var t=this,e=D.timer(200).subscribe(function(){null!=e&&e.unsubscribe(),t.service.dragStarted()})},t.prototype.onDragEndHandler=function(){this.service.dragEnded()},t.prototype.onDragEnterHandler=function(t,e){this.service.dragEnter(t,e)},t.prototype.onDragLeaveHandler=function(){this.service.dragLeave()},t.prototype.ngOnInit=function(){var e=this;this._customWidgetsSub=this.service.customWidgets.subscribe(function(t){e.customWidgets=t,0<e.customWidgets.length&&""==e.customWidgets[e.customWidgets.length-1].type&&e.openDialog(e.customWidgets.length-1)}),this.service.addCustomWidgets({json:this._threeColumnsLayout,type:"LayoutWidgetWith3Columns"}),this.service.addCustomWidgets({json:this._fourColumnsLayout,type:"LayoutWidgetWith4Columns"})},t.prototype.ngOnDestroy=function(){this._customWidgetsSub.unsubscribe(),this.service.resetCustomWidgets()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-custom-widgets-toolbar",styles:["ajf-report-builder-custom-widgets-toolbar .mat-toolbar{background-color:rgba(144,238,144,.6);border-radius:16px}ajf-report-builder-custom-widgets-toolbar .ajf-hide{display:none}ajf-report-builder-custom-widgets-toolbar .ajf-show{display:block}ajf-report-builder-custom-widgets-toolbar a{margin-right:10px}"],template:'<mat-toolbar><ng-template ngFor let-t [ngForOf]="customWidgets" let-i="index"><ajf-report-builder-custom-widget-toolbar-button cdkDrag [cdkDragData]="t" [widgetType]="t.type" [position]="i" (cdkDragStarted)="onDragStartHandler()" (cdkDragEnded)="onDragEndHandler();" (click)="openDialog(i)"></ajf-report-builder-custom-widget-toolbar-button></ng-template></mat-toolbar>',encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialog}]},t}(),Y=function(){function t(t,e,r){var i=this;this._service=t,this._dialogRef=e,this.aggregationTypes=I.sizedEnumToStringArray(T.AjfAggregationType),this.operators=["true","false","( )","' '","<","<=",">=",">","!=","!","&&","||","+","-","*","/","%","=="],this.formulaText="",this.formulaDate="",this.safeFormulaText="",this.label="",this.condition="",this.aggregationType=T.AjfAggregationType.Sum,this.currentId=0,this.currentIndex=0,this.labels=[],this.currentWidget=null,this.formsVariablesName=[],this.formsVariablesType=[],this._formAnalyzerSub=D.Subscription.EMPTY,this._currentWidgetSub=D.Subscription.EMPTY,this._first=!0,0==this.init&&(this.formulaText="",this.aggregationType=T.AjfAggregationType.Sum),this._currentWidgetSub=this._service.currentWidget.subscribe(function(t){if(null!=t&&(i.currentWidget=t,2==i.currentWidget.widgetType)){var e=i.currentWidget;e.imageType==P.AjfImageType.Flag?i.formula=e.flag?e.flag.formula:"":i.formula=e.icon?e.icon.formula:""}}),this._formAnalyzerSub=this._service.formsVariables.subscribe(function(t){null!=t&&(i.formsVariables=t)})}return t.prototype.onEditorInit=function(){monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES2015,allowNonTsExtensions:!0,allowJs:!0,module:monaco.languages.typescript.ModuleKind.None});try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-variables.d.ts")}catch(t){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=""}try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-functions.d.ts")}catch(t){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=""}this._initFormsVariablesNames(),this._updateVariables(),this._updateFunctions()},t.prototype._initFormsVariablesNames=function(){var e=this;this.formsVariables.forEach(function(t){t.names.forEach(function(t){e.formsVariablesName.push(t)}),t.types.forEach(function(t){e.formsVariablesType.push(e._fieldVarType(t)||"")})})},t.prototype._updateVariables=function(){if(null!=this.formsVariables)try{for(var t="",e=0;e<this.formsVariablesName.length;e++)t+="declare const "+this.formsVariablesName[e]+": "+this.formsVariablesType[e]+";";t+="\n",monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=t}catch(t){}},t.prototype._updateFunctions=function(){try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=E.AjfValidatedProperty.UTIL_FUNCTIONS}catch(t){}},t.prototype._fieldVarType=function(t){switch(t){case M.AjfFieldType.Boolean:return"boolean";case M.AjfFieldType.Date:case M.AjfFieldType.DateInput:case M.AjfFieldType.Time:return"Date";case M.AjfFieldType.Empty:return"void";case M.AjfFieldType.Formula:return"number";case M.AjfFieldType.MultipleChoice:case M.AjfFieldType.SingleChoice:return"any";case M.AjfFieldType.Number:return"number";case M.AjfFieldType.Table:return"Array";case M.AjfFieldType.String:case M.AjfFieldType.Text:return"string"}return null},t.prototype.setCurrent=function(t,e,r){this.init||(this.label=e,this.init=!0),this.insertVariable(this.formsVariables[t].names[r]||"")},t.prototype.setCurrentId=function(t){this.currentId=t,this.labels=this.formsVariables[t].labels,this._updateVariables()},t.prototype.setAggregationType=function(t){this.aggregationType=t},t.prototype.checkValidation=function(){this.validateFormula()?(this.safeFormulaText=this.formulaText,this.isValid=!0):this.isValid=!1,""==this.formulaText&&(this.isValid=!1)},t.prototype.validateFormula=function(){return""==this.formulaText&&(this.init=!1),null!=this.formsVariables&&E.AjfFormula.validate(this.formulaText,this.formsVariablesName)},t.prototype.saveDataset=function(){if(null!=this.currentWidget)switch(this.currentWidget.widgetType){case 2:this.saveImageFormula();case 3:this.saveFormulaHtml();break;case 4:this.saveChartFormula();break;case 5:this.saveTableFormula()}this.close()},t.prototype.saveImageFormula=function(){this._service.saveImageFormula(new E.AjfFormula(this.formulaText))},t.prototype.saveFormulaHtml=function(){this._service.saveFormulaToHtml(this.formulaText,this.reference)},t.prototype.saveChartFormula=function(){this._service.saveChartFormula(this.label,this.level,this.mainIndex,this.index,this.formulaText,this.aggregationType)},t.prototype.saveTableFormula=function(){this._service.saveTableFormula(this.label,this.aggregationType,this.formulaText,this.mainIndex,this.index)},t.prototype.hideErrorMessage=function(){this.errorMessage},t.prototype.insertVariable=function(t){if(null!=this.monacoEditor&&null!=this.monacoEditor.editor){var e=this.monacoEditor.editor,r=e.getValue().split("\n"),i=e.getPosition(),o=i.lineNumber-1,n=r[o],a=i.column-1;n=n.substring(0,a)+t+n.substring(a),r[o]=n,i.column+=t.length,this.monacoEditor.value=r.join("\n"),e.setPosition(i),e.focus(),this.formulaText=e.getValue(),this.checkValidation()}},t.prototype.setVariable=function(t){null!=this.monacoEditor&&null!=this.monacoEditor.editor&&this.monacoEditor.editor.setValue(t)},t.prototype.reset=function(){this.formulaText="",this.aggregationType=T.AjfAggregationType.None},t.prototype.close=function(){this.reset(),this._dialogRef.close()},t.prototype.ngOnInit=function(){this.formulaText=this.formula,this.aggregationType=this.aggregation,this.label=this.labelText,""==this.formulaText||null==this.formulaText?this.isValid=!1:this.isValid=!0},t.prototype.ngAfterViewChecked=function(){this._first&&null!=this.monacoEditor&&null!=this.monacoEditor.editor&&(this.insertVariable(this.formulaText||""),this._first=!1)},t.prototype.ngOnDestroy=function(){this._formAnalyzerSub.unsubscribe(),this._currentWidgetSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"forms-analyzer-dialog",template:'<h3 matDialogTitle>Formula editor</h3><div mat-dialog-content #elem><ng-template [ngIf]="currentWidget != null && formsVariables != null"><div class="ajf-left"><mat-list><mat-list-item *ngFor="let operator of operators"><button mat-button (click)="insertVariable(operator)"><h4 matLine>{{operator}}</h4></button></mat-list-item></mat-list></div><div class="ajf-main"><mat-select *ngIf="!isFormula" placeholder="Select type of agregation" [(ngModel)]="aggregationType"><mat-option [value]="idx" *ngFor="let ag of aggregationTypes; let idx = index">{{ ag }}</mat-option></mat-select><mat-form-field *ngIf="!isFormula"><textarea matInput placeholder="Name field" [(ngModel)]="label"></textarea></mat-form-field><ajf-monaco-editor (init)="onEditorInit()" (valueChange)="formulaText = $event;checkValidation();" [value]="condition" language="javascript"></ajf-monaco-editor></div><div class="ajf-menu"><form><mat-select placeholder="Select form" (change)="setCurrentId($event.value)"><ng-template ngFor let-form let-id="index" [ngForOf]="formsVariables"><mat-option [value]="id">{{ id }}</mat-option></ng-template></mat-select></form><mat-list><h3 matSubheader>Field list</h3><mat-list-item *ngFor="let label of labels;let i = index"><button mat-button (click)="setCurrent(currentId, label, i)"><h4 matLine>{{label}}</h4></button></mat-list-item></mat-list></div></ng-template></div><div mat-dialog-actions><button mat-button (click)="saveDataset()" [disabled]="!isValid">Save</button></div>',styles:["forms-analyzer-dialog{height:512px}forms-analyzer-dialog h4[matLine]{font-size:xx-small}forms-analyzer-dialog [mat-dialog-content]{flex-direction:row;display:flex;align-items:stretch;min-width:1000px}forms-analyzer-dialog [mat-dialog-content] .ajf-left{flex:1 0 10%;width:10%;overflow-y:auto}forms-analyzer-dialog [mat-dialog-content] .ajf-left form>mat-select{width:90%;margin-left:10px;margin-right:10px}forms-analyzer-dialog [mat-dialog-content] .ajf-main{flex:1 0 55%;min-width:512px}forms-analyzer-dialog [mat-dialog-content] .ajf-main monaco-editor{height:450px;min-width:300px}forms-analyzer-dialog [mat-dialog-content] .ajf-main mat-select{width:80%}forms-analyzer-dialog [mat-dialog-content] .ajf-main mat-form-field{width:80%}forms-analyzer-dialog [mat-dialog-content] .ajf-main mat-form-field textarea{width:auto;height:auto}forms-analyzer-dialog [mat-dialog-content] .ajf-main textarea{width:80%;height:75px}forms-analyzer-dialog [mat-dialog-content] .ajf-menu{flex:1 0 30%;overflow-y:auto;min-width:350px}forms-analyzer-dialog [mat-dialog-content] .ajf-menu form>mat-select{width:90%;margin-left:10px;margin-right:10px}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialogRef},{type:M.AjfValidationService}]},t.propDecorators={formula:[{type:i.Input}],isFormula:[{type:i.Input}],labelText:[{type:i.Input}],aggregation:[{type:i.Input}],init:[{type:i.Input}],level:[{type:i.Input}],index:[{type:i.Input}],mainIndex:[{type:i.Input}],reference:[{type:i.Input}],formulaTextArea:[{type:i.ViewChild,args:["formulaTextArea"]}],errorMessage:[{type:i.ViewChild,args:["errorMessage"]}],monacoEditor:[{type:i.ViewChild,args:[C.AjfMonacoEditor]}]},t}(),$=function(){function t(t,e){var r=this;this._service=t,this.dialog=e,this.currentWidget=null,this.forms=[],this.choicesOrigins={},this.currentMainDataIndex=-1,this._dataset=[],this._currentWidgetSub=D.Subscription.EMPTY,this._formAnalyzerSub=D.Subscription.EMPTY,this._currentWidgetSub=this._service.currentWidget.subscribe(function(t){r.currentWidget=null!=t?t:null}),this._formAnalyzerSub=this._service.formsVariables.subscribe(function(t){null!=t&&(r.formsVariables=t)})}return t.prototype.setCurrentIndex=function(t){this.currentMainDataIndex=t},t.prototype.isSelected=function(t){return t===this.currentMainDataIndex?"primary":""},t.prototype.getMainData=function(){if(null==this._dataset[0])return[];for(var t=[],e=0;e<this._dataset[0].length;e++)t.push(this._dataset[0][e].label);return t},t.prototype.getDataset=function(){var t=[];if(null==this._dataset[0])return[];for(var e=1;e<this._dataset.length;e++)t.push(this._dataset[e][0].label);return t},t.prototype.getRelatedData=function(){if(null==this._dataset[this.currentMainDataIndex+1])return[];for(var t=[],e=1;e<this._dataset[this.currentMainDataIndex+1].length;e++)t.push(this._dataset[this.currentMainDataIndex+1][e].label);return t},t.prototype.getTableHeader=function(){var t=[];if(null!=this._dataset)for(var e=0;e<this._dataset.length;e++)null!=this._dataset[e][0]&&t.push(this._dataset[e][0].label);return t},t.prototype.getTableData=function(){if(null==this._dataset[this.currentMainDataIndex])return[];for(var t=[],e=1;e<this._dataset[this.currentMainDataIndex].length;e++)null!=this._dataset[this.currentMainDataIndex][e]&&t.push(this._dataset[this.currentMainDataIndex][e].label);return t},t.prototype.needMainData=function(){var t=this.currentWidget;return t.chartType!==T.AjfChartType.Scatter&&t.chartType!==T.AjfChartType.Bubble},t.prototype.removeMainData=function(t){this._service.removeMainData(t)},t.prototype.removeDataset=function(t){this.currentMainDataIndex=t,this._service.removeRelatedData(this.currentMainDataIndex,-1)},t.prototype.removeTableMainData=function(t){this._service.removeTableMainData(t)},t.prototype.removeRelatedData=function(t){this._service.removeRelatedData(this.currentMainDataIndex,t)},t.prototype.removeData=function(t,e){this._service.removeData(t,e)},t.prototype.openDialog=function(t,e,r,i){this.dialogRef=this.dialog.open(Y),this.dialogRef.componentInstance.aggregation=i?(1===t&&-1===r&&(r=0),1===t&&(null!=this.currentWidget&&this.currentWidget.widgetType==T.AjfReportWidgetType.Chart&&e++,r++),this.dialogRef.componentInstance.labelText=this._dataset[e]&&this._dataset[e][r].label||"",this._dataset[e]&&this._dataset[e][r].aggregation.aggregation||T.AjfAggregationType.None):(this.dialogRef.componentInstance.labelText="",this.dialogRef.componentInstance.formula="",0),this.dialogRef.componentInstance.currentWidget=this.currentWidget,this.dialogRef.componentInstance.level=t,this.dialogRef.componentInstance.mainIndex=e,this.dialogRef.componentInstance.index=r,this.dialogRef.componentInstance.init=!1},t.prototype.openDialogAddMainData=function(){this.openDialog(0,-1,-1,!1)},t.prototype.openDialogChartEditMainData=function(){this.openDialog(0,0,this.currentMainDataIndex,!0)},t.prototype.openDialogTableEditMainData=function(){this.openDialog(0,this.currentMainDataIndex,0,!0)},t.prototype.openDialogChartAddDataset=function(){this.openDialog(1,-1,-1,!1)},t.prototype.openDialogTableAddDataset=function(){this.openDialog(1,this.currentMainDataIndex,-1,!1)},t.prototype.openDialogChartAddDataOfDataset=function(){this.openDialog(1,this.currentMainDataIndex,-1,!1)},t.prototype.openDialogChartEditDataset=function(){this.openDialog(1,this.currentMainDataIndex,-1,!0)},t.prototype.openDialogTableEditDataset=function(t){this.openDialog(1,this.currentMainDataIndex,t,!0)},t.prototype.openDialogChartEditDataOfDataset=function(t){this.openDialog(1,this.currentMainDataIndex,t,!0)},t.prototype.ngOnDestroy=function(){this._currentWidgetSub.unsubscribe(),this._formAnalyzerSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-forms-analyzer",template:'<ng-template [ngIf]="currentWidget != null && formsVariables != null"><ng-template [ngIf]="currentWidget.widgetType == 4"><ng-template [ngIf]="needMainData()"><mat-tab-group><mat-tab [label]="\'Main Data\' | translate"><button mat-button (click)="openDialogAddMainData()" style="width:100%;">Add Main Data</button><mat-grid-list rowHeight="50px" cols="3"><ng-template ngFor let-label [ngForOf]="getMainData()" let-idx="index"><mat-grid-tile>{{ label }}</mat-grid-tile><mat-grid-tile><button mat-button translate (click)="setCurrentIndex(idx);openDialogChartEditMainData()">Edit</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="removeMainData(idx)">Remove</button></mat-grid-tile></ng-template></mat-grid-list><div class="ajf-ui ajf-divider"></div></mat-tab></mat-tab-group></ng-template><mat-tab-group><mat-tab label="dataset"><button mat-button (click)="openDialogChartAddDataset()" style="width:100%">add dataset</button><mat-grid-list rowHeight="50px" cols="4"><ng-template ngFor let-label [ngForOf]="getDataset()" let-idx="index"><mat-grid-tile><button mat-button color="{{isSelected(idx)}}" (click)="setCurrentIndex(idx)">{{ label }}</button></mat-grid-tile><mat-grid-tile><button mat-button (click)="setCurrentIndex(idx);openDialogChartAddDataOfDataset()" style="width:100%">add data</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="setCurrentIndex(idx);openDialogChartEditDataset()">Edit</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="removeDataset(idx)">Remove</button></mat-grid-tile></ng-template></mat-grid-list></mat-tab><mat-tab label="data"><mat-grid-list rowHeight="50px" cols="3"><ng-template ngFor let-label [ngForOf]="getRelatedData()" let-idx="index"><mat-grid-tile>{{ label }}</mat-grid-tile><mat-grid-tile><button mat-button translate (click)="openDialogChartEditDataOfDataset(idx)">Edit</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="removeRelatedData(idx)">Remove</button></mat-grid-tile></ng-template></mat-grid-list><div class="ajf-ui ajf-divider"></div></mat-tab></mat-tab-group></ng-template><ng-template [ngIf]="currentWidget.widgetType == 5"><ng-template [ngIf]="needMainData()"><mat-tab-group><mat-tab [label]="\'Main Data\' | translate"><button mat-button (click)="openDialogAddMainData()" translate style="width:100%;">Add Main Data</button><mat-grid-list rowHeight="50px" cols="4"><ng-template ngFor let-label [ngForOf]="getTableHeader()" let-idx="index"><mat-grid-tile><button mat-button color="{{isSelected(idx)}}" (click)="setCurrentIndex(idx)">{{ label }}</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="setCurrentIndex(idx);openDialogTableAddDataset()" style="width:100%">add data</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="setCurrentIndex(idx);openDialogTableEditMainData()">Edit</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="removeTableMainData(idx)">Remove</button></mat-grid-tile></ng-template></mat-grid-list><div class="ajf-ui ajf-divider"></div></mat-tab><mat-tab [label]="\'data\' | translate"><mat-grid-list rowHeight="50px" cols="3"><ng-template ngFor let-label [ngForOf]="getTableData()" let-idx="index"><mat-grid-tile>{{ label }}</mat-grid-tile><mat-grid-tile><button mat-button translate (click)="openDialogTableEditDataset(idx)">Edit</button></mat-grid-tile><mat-grid-tile><button mat-button translate (click)="removeData(currentMainDataIndex, idx + 1)">Remove</button></mat-grid-tile></ng-template></mat-grid-list><div class="ajf-ui ajf-divider"></div></mat-tab></mat-tab-group></ng-template></ng-template></ng-template>',styles:["ajf-report-builder-forms-analyzer{min-height:512px}ajf-report-builder-forms-analyzer .ajf-editor{flex:.75 0 auto;display:flex;flex-direction:row;align-items:stretch}ajf-report-builder-forms-analyzer .ajf-editor monaco-editor{flex:1 0 auto;min-width:512px;min-height:256px}ajf-report-builder-forms-analyzer mat-dialog-container{flex:1 0 auto;min-width:512px;min-height:256px}ajf-report-builder-forms-analyzer .ajf-editor-panel{flex:.25 0 auto;overflow-y:auto}ajf-report-builder-forms-analyzer .mat-list-item-content{position:normal!important;display:block!important;height:350px!important}ajf-report-builder-forms-analyzer mat-tab-group .mat-list-item-content,ajf-report-builder-forms-analyzer mat-tab-group .mat-tab-body-wrapper{position:normal!important;display:block!important;height:350px!important}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialog}]},t}(),J=function(){function t(){}return t.prototype.transform=function(t,e){return t.filter(function(t){return 0===e.length||t.info.toLowerCase().includes(e.toLowerCase())})},t.decorators=[{type:i.Pipe,args:[{name:"ajfImageFilter"}]},{type:i.Injectable}],t}(),Z=function(){function t(t){this._service=t,this._icon=null,this._classes="",this.open=!1,this.valueToSearch="",this.formulaClick=new i.EventEmitter}return Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classes",{get:function(){return this._classes},enumerable:!0,configurable:!0}),t.prototype.setIcon=function(t,e){this._icon={fontSet:t,fontIcon:e},this._service.setIcon(this._icon)},t.prototype.setFlag=function(t){this._classes=t,this._service.setFlag(t)},t.prototype.setSearch=function(t){this.valueToSearch=t.currentTarget.value},t.prototype.emitFormula=function(){this.formulaClick.emit()},t.prototype.getFlag=function(t){for(var e="",r=0;r<this.data.class.length;r++)e+=this.data.class[r]+" ";return e+=this.data.prefixClass+t},t.prototype.toggle=function(){this.open=!this.open},t.decorators=[{type:i.Component,args:[{selector:"ajf-image-group",template:'<ng-template [ngIf]="data != null"><button mat-button (click)="toggle()" style="width:100%">{{data.title}}</button><ng-template [ngIf]="open"><button mat-button (click)="emitFormula()">Set formula</button><mat-card *ngIf="data.icon === \'true\'"><mat-card-header>{{data.title}}</mat-card-header><mat-card-content><mat-grid-list cols="3" rowHeight="100px"><ng-container *ngFor="let value of data.data"><mat-grid-tile *ngFor="let icon of value.icons" [colspan]="1" [rowspan]="1"><button style="height:100%" (click)="setIcon(value.name, icon.name)" [matTooltip]="icon.label" matTooltipPosition="above" mat-button><mat-icon [fontSet]="value.name" [fontIcon]="icon.name"></mat-icon></button></mat-grid-tile></ng-container></mat-grid-list></mat-card-content></mat-card><mat-card *ngIf="data.icon === \'false\'"><mat-card-header><mat-card-title>{{data.title}}</mat-card-title><mat-card-subtitle><mat-form-field><input matInput placeholder="{{data.title}} to search" [(ngModel)]="valueToSearch"></mat-form-field></mat-card-subtitle></mat-card-header><mat-card-content><div class="ajf-image-group-container"><mat-grid-list cols="3"><mat-grid-tile *ngFor="let value of data.data | ajfImageFilter: valueToSearch" [colspan]="1" [rowspan]="1"><button style="height:100%" (click)="setFlag(getFlag(value.class))" matTooltip="{{value.info}}" [matTooltipPosition]="\'above\'" mat-button><span class="{{getFlag(value.class)}}" style="width: 100%;height: 100%;"></span></button></mat-grid-tile></mat-grid-list></div></mat-card-content></mat-card><ajf-report-builder-forms-analyzer></ajf-report-builder-forms-analyzer></ng-template></ng-template>',styles:["ajf-image-group mat-grid-list{height:300px!important;overflow-y:auto}ajf-image-group .mat-grid-list{height:300px!important}ajf-image-group mat-card>mat-card-content>.ajf-image-group-container{overflow-y:scroll;height:300px}ajf-image-group mat-icon{font-size:30px}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t.propDecorators={data:[{type:i.Input}],formulaClick:[{type:i.Output}]},t}(),G=function(){function t(t,e){var r=this;this._dialog=t,this.service=e,this.initChartType=!1,this.currentWidget=null,this.forms=[],this.colors=[],this.formsJson={forms:[]},this.widgetName="",this.marginExpanded=!1,this.paddingExpanded=!1,this.borderWidthExpanded=!1,this.borderRadiusExpanded=!1,this.backgroundColor="#127bdc",this.styleBackgroundColor="rgb(255,255,255,0)",this.borderColor="#127bdc",this.styleColor="rgb(0,0,0,0)",this.align=[!1,"center","right","justify"],this.fonts=[!1,"blackr","black-italic","bold","bold-condensed","bold-condensed-italic","bold-italic","condensed","condensed-italic","italic","light","light-italic","medium","medium-italic","thinr","thin-italic"],this.currentModule={},this.quillModules={toolbar:[["formula"],["bold","italic","underline","strike"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:this.colors},{background:this.colors}],[{font:this.fonts}],[{align:this.align}],["clean"]]},this.chartBorderColor=[],this.chartBorderWidth=3,this.imageUrl="https://angular.io/resources/images/logos/angular2/angular.png",this.htmlText="",this.reportStyles=!1,this.sectionStyles=!1,this.widgetStyles=!0,this.sectionColor=!1,this.widgetColor=!1,this.visibilitySection=!1,this.currentColor="",this._icon=null,this.iconSet={icon:"true",title:"report",data:null},this.flagSet={icon:"false",class:["flag-icon"],prefixClass:"flag-icon-",title:"flags",data:[{class:"dz",info:"Algeria"},{class:"ao",info:"Angola"},{class:"bj",info:"Benin"},{class:"bw",info:"Botswana"},{class:"bf",info:"Burkina Faso"},{class:"bi",info:"Burundi"},{class:"cm",info:"Cameroon"},{class:"cv",info:"Cabo Verde"},{class:"cf",info:"The Central African Republic"},{class:"td",info:"Chad"},{class:"km",info:"The Comoros"},{class:"ci",info:"Cote D'avoire"},{class:"cd",info:"The Democratic Republic of Congo"},{class:"dj",info:"Dijibouti"},{class:"eg",info:"Egypt"},{class:"gq",info:"Equatorial Guinea"},{class:"er",info:"Eritrea"},{class:"et",info:"Ethiopia"},{class:"tf",info:"French Southern Territories"},{class:"ga",info:"Gabon"},{class:"gm",info:"The Gambia"},{class:"gh",info:"Ghana"},{class:"gn",info:"Guinea"},{class:"gw",info:"Guinea-Bissau"},{class:"ke",info:"Kenya"},{class:"ls",info:"Leshotho"},{class:"lr",info:"Liberia"},{class:"ly",info:"Libya"},{class:"mg",info:"Madagascar"},{class:"mw",info:"Malawy"},{class:"ml",info:"Mali"},{class:"mr",info:"Mauritania"},{class:"mu",info:"Mauritius"},{class:"yt",info:"Mayotte"},{class:"ma",info:"Marocco"},{class:"mz",info:"Mozambique"},{class:"na",info:"Namibia"},{class:"ne",info:"Niger"},{class:"ng",info:"Nigeria"},{class:"cg",info:"Republic of the Congo"},{class:"rw",info:"Rwnda"},{class:"re",info:"runion"},{class:"sh",info:"Saint Helena, Ascension and Tristan da Cunha"},{class:"st",info:"Sao Tome and Principe"},{class:"sn",info:"Senegal"},{class:"sc",info:"Seychelles"},{class:"sl",info:"Sierra Leone"},{class:"so",info:"Somalia"},{class:"za",info:"South Africa"},{class:"ss",info:"South Sudan"},{class:"sd",info:"Sudan"},{class:"sz",info:"Swaziland"},{class:"tz",info:"Tanzania"},{class:"tg",info:"Togo"},{class:"tn",info:"Tunisia"},{class:"ug",info:"Uganda"},{class:"eh",info:"Western Sahara"},{class:"zm",info:"Zambia"},{class:"zw",info:"Zimbawe"},{class:"iq",info:"Iraq"},{class:"lb",info:"Lebanon"},{class:"bd",info:"Bangladesh"},{class:"ir",info:"Iran (Islamic Republic of)"},{class:"my",info:"Malaysia"},{class:"np",info:"Nepal"},{class:"pk",info:"Pakistan"},{class:"th",info:"Thailand"},{class:"jo",info:"Jordan"},{class:"ye",info:"Yemen"}]},this._currentWidgetSub=D.Subscription.EMPTY,this._formsSub=D.Subscription.EMPTY,this._colorSub=D.Subscription.EMPTY,this._headerStyleSub=D.Subscription.EMPTY,this._contentStylesSub=D.Subscription.EMPTY,this._footerStylesSub=D.Subscription.EMPTY,this._originSub=D.Subscription.EMPTY,this._stylesUpdatesSubs=D.Subscription.EMPTY,this._updateWidgetMarginEvt=new i.EventEmitter,this._updateWidgetPaddingEvt=new i.EventEmitter,this._updateWidgetBorderWidthEvt=new i.EventEmitter,this._updateWidgetBorderRadiusEvt=new i.EventEmitter,this.tabValue="backgroundColor",this.setForms(),this.iconSet.data=Object.keys(e.iconSets).filter(function(t){return"ajf-icon"!=t}).map(function(t){return{name:t,icons:e.iconSets[t]}}),this._headerStyleSub=this.service.headerStyles.subscribe(function(t){null!=t["background-color"]&&(r.styleBackgroundColor=t["background-color"])}),this._contentStylesSub=this.service.contentStyles.subscribe(function(t){null!=t["background-color"]&&(r.styleBackgroundColor=t["background-color"])}),this._footerStylesSub=this.service.footerStyles.subscribe(function(t){null!=t["background-color"]&&(r.styleBackgroundColor=t["background-color"])}),this._originSub=this.service.origin.subscribe(function(t){r.origin=t})}return Object.defineProperty(t.prototype,"currentLayoutWidget",{get:function(){return this.currentWidget},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTextWidget",{get:function(){return this.currentWidget},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},enumerable:!0,configurable:!0}),t.prototype.toNumber=function(t){if(null==t)return 0;var e=t.match(/^(-)?\d+/g);return null==e||0==e.length?0:Number(e[0])},t.prototype.toNumberArray=function(t){var e=this;return null==t?[]:(t||"").replace("px","").split(" ").filter(function(t){return""!==t&&null!=t}).map(function(t){return e.toNumber(t)})},t.prototype.fillPxNumberArray=function(t){switch(t.length){case 0:return[0,0,0,0];case 1:var e=t[0];return[e,e,e,e];case 2:var r=t[0],i=t[1];return[r,i,r,i];case 3:var o=t[0],n=t[1];return[o,n,t[2],n];default:return t}},t.prototype.percent=function(t){return this.roundTo(100*t,3)},t.prototype.roundTo=function(t,e){var r=t*Math.pow(10,e);return(r=Math.floor(r))/Math.pow(10,e)},t.prototype.setForms=function(){var t=[];try{for(var e=0;e<this.formsJson.forms.length;e++)t.push(M.AjfForm.fromJson(this.formsJson.forms[e]));this.service.setReportForms(t)}catch(t){}},t.prototype.instantColumnValue=function(t,e){this.service.instantColumnValue(t,e)},t.prototype.setStyle=function(){null!=this.currentWidget&&(this.currentWidget.styles=I.deepCopy(this.currentWidget.styles),this.service.updateCurrentWidget(this.currentWidget))},t.prototype.setWidgetStyles=function(t,e){this.service.setWidgetStyles(t,e),this.currentColor=e,this.setStyle()},t.prototype.setWidgetMargin=function(t,e){this._updateWidgetMarginEvt.emit({idx:t,value:e})},t.prototype.setWidgetPadding=function(t,e){this._updateWidgetPaddingEvt.emit({idx:t,value:e})},t.prototype.setWidgetBorderWidth=function(t,e){this._updateWidgetBorderWidthEvt.emit({idx:t,value:e})},t.prototype.setWidgetBorderRadius=function(t,e){this._updateWidgetBorderRadiusEvt.emit({idx:t,value:e})},t.prototype.setSectionStyles=function(t,e){this.service.setSectionStyles(this.origin,t,e),this.styleColor=e},t.prototype.setReportStyles=function(t,e){this.service.setReportStyles(t,e),this.styleBackgroundColor=e},t.prototype.addCustomColor=function(){this.service.addCustomColor(this.currentColor),this.service.updateCurrentWidget(this.currentWidget)},t.prototype.getModule=function(){return this.quillModules},t.prototype.isChartTypeSelected=function(t){return 0!=this.initChartType&&t===this.currentWidget.chartType},t.prototype.addColumn=function(){this.service.addColumn()},t.prototype.fixedColumn=function(t){this.service.fixedColumn(t)},t.prototype.unfixedColumn=function(t){this.service.remove("unfixedColumn",t)},t.prototype.setImageUrl=function(){this.service.setImageUrl(this.imageUrl)},t.prototype.setIcon=function(t){this._icon=t,this.service.setIcon(t)},t.prototype.setChartType=function(t){this.initChartType=!0,this.service.setChartType(t)},t.prototype.setChartBorderColor=function(t){this.service.setChartBorderWidth(t)},t.prototype.setTab=function(t){0===t.index?this.tabValue="backgroundColor":this.tabValue="borderColor"},t.prototype.removeChartBackgroundColor=function(t){this.service.removeChartBackgroundColor(t)},t.prototype.removeChartBorderColor=function(t){this.service.removeChartBorderColor(t)},t.prototype.hideMenu=function(){this.service.updateCurrentWidget(null)},t.prototype.openFormulaDialog=function(t){this.dialogRef=this._dialog.open(Y),this.dialogRef.componentInstance.aggregation=T.AjfAggregationType.None,this.dialogRef.componentInstance.isFormula=!0,null!=t&&null!=t.reference&&(this.dialogRef.componentInstance.formula=t.formula,this.dialogRef.componentInstance.reference=t.reference)},t.prototype.ngOnInit=function(){var o=this;this._formsSub=this.service.reportForms.subscribe(function(t){o.forms=t||[]}),this._currentWidgetSub=this.service.currentWidget.subscribe(function(t){null!=t?o.currentWidget!==t&&(o.currentWidget=t,o.widgetName=T.AjfReportWidgetType[t.widgetType],o.reportStyles=!1,o.sectionStyles=!1,o.widgetStyles=!1,o.sectionColor=!1,o.widgetColor=!1,o.visibilitySection=!1):(o.currentWidget=null,o.widgetName="")}),this._colorSub=this.service.colors.subscribe(function(t){t&&0<t.length&&(o.colors=t,o.quillModules={toolbar:[["bold","italic","underline","strike"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:o.colors},{background:o.colors}],[{font:o.fonts}],[{align:o.align}],["formula"],["clean"]]})}),this.getHTML=this.service.currentWidget.pipe(k.map(function(t){return null==t?"":o.currentWidget.htmlText}),k.distinctUntilChanged(),k.startWith("<p><br></p>")),this.getHeightWidget=this.service.currentWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){if(null!=t){var e=o.toNumber(t.styles.height);if(null!=e||null!=e)return e}}),k.distinctUntilChanged()),this.getFontSizeWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t)return o.toNumber(t.styles["font-size"])||12}),k.distinctUntilChanged()),this.getFontAlignWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t)return t.styles["text-align"]||"center"}),k.distinctUntilChanged()),this.getBorderWidthWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t)return o.fillPxNumberArray(o.toNumberArray(t.styles["border-width"]))}),k.distinctUntilChanged(),k.startWith([0,0,0,0])),this.getBorderWidthWidgetTop=this.getBorderWidthWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[0]})),this.getBorderWidthWidgetRight=this.getBorderWidthWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[1]})),this.getBorderWidthWidgetBottom=this.getBorderWidthWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[2]})),this.getBorderWidthWidgetLeft=this.getBorderWidthWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[3]})),this.getBorderRadiusWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t)return o.fillPxNumberArray(o.toNumberArray(t.styles["border-radius"]))}),k.distinctUntilChanged(),k.startWith([0,0,0,0])),this.getBorderRadiusWidgetTopLeft=this.getBorderRadiusWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[0]})),this.getBorderRadiusWidgetTopRight=this.getBorderRadiusWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[1]})),this.getBorderRadiusWidgetBottomRight=this.getBorderRadiusWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[2]})),this.getBorderRadiusWidgetBottomLeft=this.getBorderRadiusWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[3]})),this.getMarginWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t&&null!=t.styles&&null!=t.styles.margin)return o.fillPxNumberArray(o.toNumberArray(t.styles.margin))}),k.distinctUntilChanged(),k.startWith([0,0,0,0])),this.getMarginWidgetTop=this.getMarginWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[0]})),this.getMarginWidgetRight=this.getMarginWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[1]})),this.getMarginWidgetBottom=this.getMarginWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[2]})),this.getMarginWidgetLeft=this.getMarginWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[3]})),this.getPaddingWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t&&null!=t.styles&&null!=t.styles.padding)return o.fillPxNumberArray(o.toNumberArray(t.styles.padding))}),k.distinctUntilChanged()),this.getPaddingWidgetTop=this.getPaddingWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[0]})),this.getPaddingWidgetRight=this.getPaddingWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[1]})),this.getPaddingWidgetBottom=this.getPaddingWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[2]})),this.getPaddingWidgetLeft=this.getPaddingWidget.pipe(k.filter(function(t){return null!=t}),k.map(function(t){return t[3]})),this.getBackgroundColorWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t&&null!=t.styles)return t.styles.backgroundColor||""}),k.distinctUntilChanged()),this.getColorWidget=this.service.currentWidget.pipe(k.map(function(t){if(null!=t&&null!=t.styles)return t.styles.color||""}),k.distinctUntilChanged()),this._stylesUpdatesSubs=this._updateWidgetMarginEvt.pipe(k.withLatestFrom(this.getMarginWidget)).subscribe(function(t){if(null!=t){var e=t[0].idx,r=t[0].value,i=t[1]||[0,0,0,0];null==i||i.length<e||(i[e]=r,o.setWidgetStyles("margin",i))}}),this._stylesUpdatesSubs.add(this._updateWidgetPaddingEvt.pipe(k.withLatestFrom(this.getPaddingWidget)).subscribe(function(t){if(null!=t){var e=t[0].idx,r=t[0].value,i=t[1]||[0,0,0,0];null==i||i.length<e||(i[e]=r,o.setWidgetStyles("padding",i))}})),this._stylesUpdatesSubs.add(this._updateWidgetBorderWidthEvt.pipe(k.withLatestFrom(this.getBorderWidthWidget)).subscribe(function(t){if(null!=t){var e=t[0].idx,r=t[0].value,i=t[1]||[0,0,0,0];null==i||i.length<e||(i[e]=r,o.setWidgetStyles("border-width",i))}})),this._stylesUpdatesSubs.add(this._updateWidgetBorderRadiusEvt.pipe(k.withLatestFrom(this.getBorderRadiusWidget)).subscribe(function(t){if(null!=t){var e=t[0].idx,r=t[0].value,i=t[1]||[0,0,0,0];null==i||i.length<e||(i[e]=r,o.setWidgetStyles("border-radius",i))}}))},t.prototype.ngOnChanges=function(t){this.currentWidget=t.widget.currentValue,null!=this.currentWidget&&(this.widgetName=T.AjfReportWidgetType[this.currentWidget.widgetType])},t.prototype.ngOnDestroy=function(){this._currentWidgetSub.unsubscribe(),this._formsSub.unsubscribe(),this._colorSub.unsubscribe(),this._headerStyleSub.unsubscribe(),this._contentStylesSub.unsubscribe(),this._footerStylesSub.unsubscribe(),this._originSub.unsubscribe(),this._stylesUpdatesSubs.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-properties",template:'<ng-template [ngIf]="currentWidget != null"><div class="ajf-content"><button mat-button class="ajf-hide-menu" matTooltip="hide-menu" (click)="hideMenu()" [matTooltipPosition]="\'above\'"><mat-icon>remove_circle_outline</mat-icon></button><mat-button-toggle-group class="ajf-menu-css"><mat-button-toggle (click)="reportStyles = !reportStyles; sectionStyles = false; widgetStyles = false" value="left" [ngClass]="{\'ajf-selected\': reportStyles}">report<ng-container translate>CSS style</ng-container></mat-button-toggle><mat-button-toggle (click)="sectionStyles = !sectionStyles; reportStyles = false; widgetStyles = false" [ngClass]="{\'ajf-selected\': sectionStyles}">{{ origin }}<ng-container translate>CSS style</ng-container></mat-button-toggle><mat-button-toggle (click)="widgetStyles = !widgetStyles; sectionStyles = false; reportStyles = false" [ngClass]="{\'ajf-selected\': widgetStyles}">{{ widgetName }}<ng-container translate>CSS style</ng-container></mat-button-toggle></mat-button-toggle-group><div class="ajf-style-container" *ngIf="(reportStyles) ? true : false "><mat-tab-group><mat-tab label="Background Color"><div class="ajf-style-panel"><ajf-theme-color [section]="\'report\'" [label]="\'color\'"></ajf-theme-color></div></mat-tab></mat-tab-group></div><div class="ajf-style-container" *ngIf="(sectionStyles) ? true : false "><mat-tab-group><mat-tab label="Background Color"><div class="ajf-style-panel"><ajf-theme-color [section]="\'section\'" [label]="\'color\'"></ajf-theme-color></div></mat-tab></mat-tab-group></div><div class="ajf-style-container" *ngIf="(widgetStyles) ? true : false "><mat-tab-group *ngIf="(currentWidget.widgetType != 4)"><mat-tab label="Color"><div class="ajf-style-panel"><ajf-theme-color [section]="\'widget\'" [label]="\'color\'" [init]="\'icon\'"></ajf-theme-color></div></mat-tab><mat-tab label="Background Color"><div class="ajf-style-panel"><ajf-theme-color [section]="\'widget\'" [label]="\'background-color\'"></ajf-theme-color></div></mat-tab></mat-tab-group><div class="properties-container" *ngIf="(currentWidget.widgetType !== 8)"><div class="ajf-layout-preview"><div class="ajf-vbottom"><div translate>height</div><div>{{ getHeightWidget|async }}</div></div><div class="ajf-margin-box"><div class="ajf-top-label" translate>margin</div><div class="ajf-vtop">{{ getMarginWidgetTop|async }}</div><div class="ajf-vright">{{ getMarginWidgetRight|async }}</div><div class="ajf-vbottom">{{ getMarginWidgetBottom|async }}</div><div class="ajf-vleft">{{ getMarginWidgetLeft|async }}</div><div class="ajf-border-box"><div class="ajf-vtop">{{ getBorderWidthWidgetTop|async }}</div><div class="ajf-vright">{{ getBorderWidthWidgetRight|async }}</div><div class="ajf-vbottom">{{ getBorderWidthWidgetBottom|async }}</div><div class="ajf-vleft">{{ getBorderWidthWidgetLeft|async }}</div><div class="ajf-vtl">{{ getBorderRadiusWidgetTopLeft|async }}</div><div class="ajf-vtr">{{ getBorderRadiusWidgetTopRight|async }}</div><div class="ajf-vbr">{{ getBorderRadiusWidgetBottomRight|async }}</div><div class="ajf-vbl">{{ getBorderRadiusWidgetBottomLeft|async }}</div><div class="ajf-top-label" translate>border</div><div class="ajf-padding-box"><div class="ajf-top-label" translate>padding</div><div class="ajf-vtop">{{ getPaddingWidgetTop|async }}</div><div class="ajf-vright">{{ getPaddingWidgetRight|async }}</div><div class="ajf-vbottom">{{ getPaddingWidgetBottom|async }}</div><div class="ajf-vleft">{{ getPaddingWidgetLeft|async }}</div><div class="ajf-content-box" translate>content</div></div></div></div></div><mat-grid-list rowHeight="2em" cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4"><span>height</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetStyles(\'height\', $event.value)" min="0" max="200" step="1" [value]="getHeightWidget|async" tickInterval="1" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile><mat-icon *ngIf="!marginExpanded" (click)="marginExpanded = !marginExpanded">keyboard_arrow_right</mat-icon><mat-icon *ngIf="marginExpanded" (click)="marginExpanded = !marginExpanded">keyboard_arrow_down</mat-icon></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4"><span translate>margin</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider [disabled]="marginExpanded" (change)="setWidgetStyles(\'margin\', $event.value)" min="-50" max="50" step="1" [value]="getMarginWidgetTop|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><ng-template [ngIf]="marginExpanded"><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>margin top</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetMargin(0, $event.value)" min="-50" max="50" step="1" [value]="getMarginWidgetTop|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>margin right</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetMargin(1, $event.value)" min="-50" max="50" step="1" [value]="getMarginWidgetRight|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>margin bottom</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetMargin(2, $event.value)" min="-50" max="50" step="1" [value]="getMarginWidgetBottom|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>margin left</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetMargin(3, $event.value)" min="-50" max="50" step="1" [value]="getMarginWidgetLeft|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list></ng-template><mat-grid-list cols="12"><mat-grid-tile><mat-icon *ngIf="!paddingExpanded" (click)="paddingExpanded = !paddingExpanded">keyboard_arrow_right</mat-icon><mat-icon *ngIf="paddingExpanded" (click)="paddingExpanded = !paddingExpanded">keyboard_arrow_down</mat-icon></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4"><span translate>padding</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetStyles(\'padding\', $event.value)" min="-50" max="50" step="1" [value]="getPaddingWidgetTop|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><ng-template [ngIf]="paddingExpanded"><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>padding top</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetPadding(0, $event.value)" min="-50" max="50" step="1" [value]="getPaddingWidgetTop|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>padding right</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetPadding(1, $event.value)" min="-50" max="50" step="1" [value]="getPaddingWidgetRight|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>padding bottom</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetPadding(2, $event.value)" min="-50" max="50" step="1" [value]="getPaddingWidgetBottom|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>padding left</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetPadding(3, $event.value)" min="-50" max="50" step="1" [value]="getPaddingWidgetLeft|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list></ng-template><mat-grid-list cols="12"><mat-grid-tile><mat-icon *ngIf="!borderWidthExpanded" (click)="borderWidthExpanded = !borderWidthExpanded">keyboard_arrow_right</mat-icon><mat-icon *ngIf="borderWidthExpanded" (click)="borderWidthExpanded = !borderWidthExpanded">keyboard_arrow_down</mat-icon></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4"><span translate>border width</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetStyles(\'border-width\', $event.value)" min="0" max="10" step="1" [value]="getBorderWidthWidgetTop|async" tickInterval="1" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><ng-template [ngIf]="borderWidthExpanded"><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border width top</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderWidth(0, $event.value)" min="1" max="10" step="1" [value]="getBorderWidthWidgetTop|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border width right</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderWidth(1, $event.value)" min="1" max="10" step="1" [value]="getBorderWidthWidgetRight|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border width bottom</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderWidth(2, $event.value)" min="1" max="10" step="1" [value]="getBorderWidthWidgetBottom|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border width left</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderWidth(3, $event.value)" min="1" max="10" step="1" [value]="getBorderWidthWidgetLeft|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list></ng-template><mat-grid-list cols="12"><mat-grid-tile><mat-icon *ngIf="!borderRadiusExpanded" (click)="borderRadiusExpanded = !borderRadiusExpanded">keyboard_arrow_right</mat-icon><mat-icon *ngIf="borderRadiusExpanded" (click)="borderRadiusExpanded = !borderRadiusExpanded">keyboard_arrow_down</mat-icon></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4"><span translate>border radius</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetStyles(\'border-radius\', $event.value)" min="0" max="100" step="1" [value]="getBorderRadiusWidget|async" tickInterval="10" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><ng-template [ngIf]="borderRadiusExpanded"><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border radius top left</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderRadius(0, $event.value)" min="1" max="100" step="1" [value]="getBorderRadiusWidgetTopLeft|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border radius top right</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderRadius(1, $event.value)" min="1" max="100" step="1" [value]="getBorderRadiusWidgetTopRight|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border radius bottom left</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderRadius(2, $event.value)" min="1" max="100" step="1" [value]="getBorderRadiusWidgetBottomLeft|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="4">&nbsp;&nbsp;<span translate>border radius bottom right</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetBorderRadius(3, $event.value)" min="1" max="100" step="1" [value]="getBorderRadiusWidgetBottomRight|async" tickInterval="auto" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list></ng-template></div><div class="properties-container" *ngIf="currentWidget.widgetType === 2"><mat-grid-list cols="12"><mat-grid-tile></mat-grid-tile><mat-grid-tile class="ajf-lal" colspan="3"><span translate>font size</span></mat-grid-tile><mat-grid-tile colspan="7"><mat-slider (change)="setWidgetStyles(\'font-size\', $event.value);" min="1" max="150" step="1" [value]="getFontSizeWidget|async" tickInterval="1" thumbLabel></mat-slider></mat-grid-tile></mat-grid-list></div><ng-template [ngIf]="currentWidget.widgetType === 5"><br><form><mat-form-field><input matInput [placeholder]="\'Font size\' | translate" [value]="getFontSizeWidget|async" [(ngModel)]="fontSize" [ngModelOptions]="{standalone: true}" (change)="setWidgetStyles(\'font-size\', fontSize)"></mat-form-field><mat-select (change)="setWidgetStyles(\'font-style\', $event.value)" [placeholder]="\'Font style\' | translate"><mat-option translate value="normal">Normal</mat-option><mat-option translate value="italic">Italic</mat-option><mat-option translate value="oblique">Oblique</mat-option></mat-select><mat-select (change)="setWidgetStyles(\'text-align\', $event.value)" [placeholder]="\'Align\' | translate"><mat-option translate value="center">Center</mat-option><mat-option translate value="left">Left</mat-option><mat-option translate value="right">Right</mat-option></mat-select></form></ng-template><h1><ng-container translate>properties of</ng-container>{{ widgetName }}</h1></div><div [ngSwitch]="currentWidget.widgetType"><ng-template [ngSwitchCase]="0"><h1 translate>Column</h1><ng-template ngFor let-col [ngForOf]="currentLayoutWidget.columns" let-idx="index"><mat-toolbar><mat-toolbar-row *ngIf="col !== -1"><mat-grid-list cols="12"><mat-grid-tile colspan="1">{{idx + 1}}</mat-grid-tile><mat-grid-tile colspan="9"><mat-slider style="width:90%" min="0.1" max="1" step="0.01" value="{{col}}" thumb-label="true" tick-interval="true" (change)="instantColumnValue($event.value,idx)"></mat-slider>{{percent(col)}}%</mat-grid-tile><mat-grid-tile colspan="2"><button style="width:5%" mat-button (click)="fixedColumn(idx)">fixed</button></mat-grid-tile></mat-grid-list></mat-toolbar-row><mat-toolbar-row *ngIf="col == -1"><mat-grid-list cols="12"><mat-grid-tile colspan="1">{{idx + 1}}</mat-grid-tile><mat-grid-tile colspan="11"><button style="width:90%" mat-button (click)="unfixedColumn(idx)">percent</button></mat-grid-tile></mat-grid-list></mat-toolbar-row></mat-toolbar></ng-template><mat-toolbar><mat-toolbar-row><button mat-button translate (click)="addColumn()" *ngIf="currentLayoutWidget.columns.length < 10">Add column</button></mat-toolbar-row></mat-toolbar></ng-template><ng-template [ngSwitchCase]="2"><ajf-image-group (formulaClick)="openFormulaDialog($event)" [data]="iconSet"></ajf-image-group><ajf-image-group (formulaClick)="openFormulaDialog($event)" [data]="flagSet"></ajf-image-group><ajf-report-builder-forms-analyzer></ajf-report-builder-forms-analyzer><input mat-input [placeholder]="\'paste a link\' | translate" style="width: 100%" [(ngModel)]="imageUrl"> <button mat-button (click)="setImageUrl()" translate>Set image</button></ng-template><ng-template [ngSwitchCase]="3"><div style="width:500px"><ajf-quill-editor [(ngModel)]="currentTextWidget.htmlText" [modules]="getModule()" [maxLength]="200" [theme]="bubble" [initHTML]="(getHTML|async)" (formulaClick)="openFormulaDialog($event)"></ajf-quill-editor></div></ng-template><ng-template [ngSwitchCase]="4"><h3 translate>Choose type of Chart</h3><mat-button-toggle-group class="ajf-chart-buttons"><div class="ajf-row"><mat-button-toggle value="reportbuilder-linechart" (click)="setChartType(0)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-linechart"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-barchartvertical" (click)="setChartType(1)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-barchartvertical"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-bubblechart" (click)="setChartType(8)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-bubblechart"></mat-icon></mat-button-toggle></div><div class="row"><mat-button-toggle value="reportbuilder-barcharthorizontal" (click)="setChartType(2)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-barcharthorizontal"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-radarchart" (click)="setChartType(3)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-radarchart"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-barchartvertical" (click)="setChartType(1)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-barchartvertical"></mat-icon></mat-button-toggle></div><div class="ajf-row"><mat-button-toggle value="reportbuilder-scatterchart" (click)="setChartType(4)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-scatterchart"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-polarareachart" (click)="setChartType(5)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-polarareachart"></mat-icon></mat-button-toggle></div><div class="ajf-row"><mat-button-toggle value="reportbuilder-piechart" (click)="setChartType(6)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-piechart"></mat-icon></mat-button-toggle><mat-button-toggle value="reportbuilder-donoughtchart" (click)="setChartType(7)"><mat-icon fontSet="ajf-icon" fontIcon="reportbuilder-donoughtchart"></mat-icon></mat-button-toggle></div></mat-button-toggle-group><h3 translate>Labels</h3><ajf-report-builder-forms-analyzer></ajf-report-builder-forms-analyzer><ajf-theme-color [section]="\'chart\'" [label]="tabValue"></ajf-theme-color><mat-card><mat-card-header><mat-card-title>Border width</mat-card-title></mat-card-header><mat-card-content><mat-slider min="1" max="100" style="width:99%" step="1" (change)="setChartBorderColor($event.value)" [value]="chartBorderWidth" tickInterval="auto" thumbLabel></mat-slider></mat-card-content></mat-card><mat-tab-group (selectChange)="setTab($event)"><mat-tab label="Background"><mat-list><ng-template ngFor let-color [ngForOf]="(getChartBackgroundColor|async)" let-idx="index"><mat-list-item><span [style.background]="color">{{ color }} </span><button mat-button translate (click)="removeChartBackgroundColor(idx)">Remove</button></mat-list-item></ng-template></mat-list></mat-tab><mat-tab label="Border"><mat-list><ng-template ngFor let-color [ngForOf]="(getChartBorderColor|async)" let-idx="index"><mat-list-item><span [style.background]="color">{{ color }} </span><button mat-button (click)="removeChartBorderColor(idx)">remove</button></mat-list-item></ng-template></mat-list></mat-tab></mat-tab-group></ng-template><ng-template [ngSwitchCase]="5"><ajf-report-builder-forms-analyzer></ajf-report-builder-forms-analyzer></ng-template></div><button mat-button (click)="visibilitySection = !visibilitySection" [ngClass]="{\'ajf-selected\': visibilitySection}">{{ widgetName }}<ng-container translate>Visibility</ng-container></button><div [style.display]="visibilitySection ? \'block\' : \'none\'"><ajf-report-builder-condition-editor [visibility]="currentWidget.visibility"></ajf-report-builder-condition-editor></div></div></ng-template>',styles:["ajf-report-builder-properties .ajf-selected{background-color:#8b0000;color:#fff}ajf-report-builder-properties .ajf-style-container{height:auto;width:100%;position:relative;margin-bottom:60px;text-align:center}ajf-report-builder-properties .ajf-style-container mat-tab-group .ajf-style-panel{min-height:350px}ajf-report-builder-properties .ajf-style-container .ajf-style-background,ajf-report-builder-properties .ajf-style-container .ajf-style-color{width:100%;height:350px;position:relative;margin:30px}ajf-report-builder-properties .ajf-style-container .mat-list-item-content{position:normal!important;display:block!important;height:350px!important}ajf-report-builder-properties .ajf-style-container mat-tab-group .mat-list-item-content,ajf-report-builder-properties .ajf-style-container mat-tab-group .mat-tab-body-wrapper{position:normal!important;display:block!important;height:350px!important}ajf-report-builder-properties .ajf-content{margin-top:10px;margin-right:15px;margin-bottom:290px;margin-left:15px}ajf-report-builder-properties .ajf-content .ajf-menu-css{width:100%!important;font-size:10px!important}ajf-report-builder-properties .ajf-content .ajf-menu-css mat-button-toggle{width:33%!important}ajf-report-builder-properties .ajf-content mat-button-toggle-group{width:100%!important}ajf-report-builder-properties .ajf-content mat-button-toggle-group mat-button-toggle{width:auto!important}ajf-report-builder-properties .ajf-content mat-button-toggle-group mat-button-toggle mat-icon{margin:15px}ajf-report-builder-properties button{width:100%;margin-bottom:30px}ajf-report-builder-properties .ajf-hide-menu{width:auto!important}ajf-report-builder-properties h1,ajf-report-builder-properties h3,ajf-report-builder-properties h5{text-align:center}ajf-report-builder-properties .ajf-row{display:flex;flex-direction:column;width:100%}ajf-report-builder-properties .mat-tab-body.mat-tab-active{min-height:600px}ajf-report-builder-properties mat-grid-list{width:100%}ajf-report-builder-properties mat-grid-tile{overflow:visible!important}ajf-report-builder-properties mat-grid-tile.ajf-lal{text-align:left}ajf-report-builder-properties .ajf-chart-buttons mat-icon{font-size:15px}ajf-report-builder-properties .ajf-layout-preview{background-color:#fff;width:100%;font-size:.9em;box-sizing:border-box;position:relative}ajf-report-builder-properties .ajf-layout-preview .ajf-top-label{position:absolute;top:1em;left:1em;text-align:left}ajf-report-builder-properties .ajf-layout-preview .ajf-vtop{position:absolute;top:1em;right:0;left:0}ajf-report-builder-properties .ajf-layout-preview .ajf-vbottom{position:absolute;bottom:0;right:0;left:0}ajf-report-builder-properties .ajf-layout-preview .ajf-vright{position:absolute;top:50%;right:1em;margin-top:.5em}ajf-report-builder-properties .ajf-layout-preview .ajf-vleft{position:absolute;top:50%;left:1em;margin-top:.5em}ajf-report-builder-properties .ajf-layout-preview .ajf-vtl{position:absolute;top:1em;left:1em}ajf-report-builder-properties .ajf-layout-preview .ajf-vtr{position:absolute;top:1em;right:1em}ajf-report-builder-properties .ajf-layout-preview .ajf-vbl{position:absolute;bottom:1em;left:1em}ajf-report-builder-properties .ajf-layout-preview .ajf-vbr{position:absolute;bottom:1em;right:1em}ajf-report-builder-properties .ajf-layout-preview .ajf-margin-box{background-color:#fff;padding:3em;position:relative;border:solid 1px #ccc}ajf-report-builder-properties .ajf-layout-preview .ajf-margin-box .ajf-border-box{background-color:#ddd;padding:3em;position:relative;box-sizing:border-box}ajf-report-builder-properties .ajf-layout-preview .ajf-margin-box .ajf-border-box>.ajf-top-label{left:4em}ajf-report-builder-properties .ajf-layout-preview .ajf-margin-box .ajf-border-box .ajf-padding-box{padding:3em;background-color:#aaa;position:relative;box-sizing:border-box}ajf-report-builder-properties .ajf-layout-preview .ajf-margin-box .ajf-border-box .ajf-padding-box .ajf-content-box{background-color:#888;padding:2em;text-align:center;box-sizing:border-box}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:l.MatDialog},{type:L}]},t}(),K=function(){function t(t,e,r){var s=this;this.elementRef=t,this.renderer=e,this._service=r,this.emptyArray=[],this._init=!1,this.dateFormats=[{label:"June 23rd 2017, 12:39:12 pm",value:"MMMM Do YYYY, h:mm:ss a",validator:"MMMMDoYYYYhmmssa"},{label:"Friday",value:"dddd",validator:"dddd"},{label:"Jun 23rd 17",value:"MMM Do YY",validator:"MMMDoYY"}],this.fonts=[!1,"blackr","black-italic","bold","bold-condensed","bold-condensed-italic","bold-italic","condensed","condensed-italic","italic","light","light-italic","medium","medium-italic","thinr","thin-italic"],this.defaultModules={formula:!0,toolbar:[["formula"],["bold","italic","underline","strike"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:this.emptyArray.slice()},{background:this.emptyArray.slice()}],[{font:this.fonts}],[{align:this.emptyArray.slice()}],["clean"]]},this.font=R.import("formats/font"),this.editorCreated=new i.EventEmitter,this.contentChanged=new i.EventEmitter,this.selectionChanged=new i.EventEmitter,this.formulaClick=new i.EventEmitter,this.onModelChange=function(){},this.onModelTouched=function(){},this._formulas=[],this._formulaTextSub=D.Subscription.EMPTY,this.font.whitelist=this.fonts,this.font.whitelist.push("regular"),this._formulaTextSub=this._service.getFormulaToHtmlEvent().subscribe(function(r){if(void 0!==r.reference){r.reference.innerHTML=r.formula,s.renderer.setAttribute(r.reference,"formula",r.formula);var t=s._formulas.filter(function(t){return t.formula===r.reference}),e=void 0,i=void 0;0<t.length?null!=(i=(e=t[0]).unlisten)&&i():(e={formula:r.reference,unlisten:null},s._formulas.push(e)),e.unlisten=s.renderer.listen(r.reference,"click",function(){var t={formula:r.formula,reference:r.reference};s.formulaClick.emit(t)})}else{var o=s.elementRef.nativeElement.querySelector(".ajf-ql-editor"),n=s.renderer.createElement("a");s.renderer.setAttribute(n,"href","javascript:void(0)"),s.renderer.setStyle(n,"cursor","pointer"),s.renderer.setAttribute(n,"formula",s.check(r.formula));var a=s.renderer.createText(r.formula);s.renderer.appendChild(n,a);i=s.renderer.listen(n,"click",function(t){var e={formula:s.check(r.formula),reference:n};s.formulaClick.emit(e)});s.renderer.appendChild(o,n),s._formulas.push({unlisten:i,formula:n})}})}return t.prototype.check=function(e){return this.dateFormats.forEach(function(t){if(t.value==e)return t.validator}),e},t.prototype.setHTML=function(){this.writeValue(this.initHTML)},t.prototype.ngAfterViewInit=function(){var n=this,t=this.elementRef.nativeElement.querySelector("[ajf-quill-editor-toolbar]"),e=this.modules||this.defaultModules;R.register(this.font,!0),t&&(e.toolbar=t,e.formula=!0),this.elementRef.nativeElement.insertAdjacentHTML("beforeend","<div quill-editor-element></div>"),this.editorElem=this.elementRef.nativeElement.querySelector("[quill-editor-element]"),this.quillEditor=new R(this.editorElem,{modules:e,placeholder:this.placeholder||"Insert text here ...",readOnly:this.readOnly||!1,theme:this.theme||"snow",formats:this.formats}),this.editorCreated.emit(this.quillEditor),this.setHTML(),this.quillEditor.on("selection-change",function(t,e,r){n.selectionChanged.emit({editor:n.quillEditor,range:t,oldRange:e,source:r}),t||n.onModelTouched()}),this.quillEditor.on("text-change",function(t,e,r){var i=n.editorElem.children[0].innerHTML,o=n.quillEditor.getText();"<p><br></p>"===i&&(i=null),n.onModelChange(i),n.contentChanged.emit({editor:n.quillEditor,html:i,text:o,delta:t,oldDelta:e,source:r})});var r=this.elementRef.nativeElement.querySelector(".ajf-ql-formula");this.listenFunc=this.renderer.listen(r,"click",function(t){n.formulaClick.emit()})},t.prototype.writeValue=function(t){var i=this;if(this.content=t,this.quillEditor){if(t){if(t!=this.initHTML||this._init)t!=this.initHTML&&this.quillEditor.pasteHTML(t);else this.elementRef.nativeElement.querySelector(".ajf-ql-editor").innerHTML=this.initHTML,this.elementRef.nativeElement.querySelectorAll("[formula]").forEach(function(r){var t=i.renderer.listen(r,"click",function(t){var e={formula:i.check(r.innerText),reference:r};i.formulaClick.emit(e)});i.renderer.setStyle(r,"cursor","pointer"),i._formulas.push({unlisten:t,formula:r}),i._init=!0});return}this.quillEditor.setText("")}},t.prototype.registerOnChange=function(t){this.onModelChange=t},t.prototype.registerOnTouched=function(t){this.onModelTouched=t},t.prototype.validate=function(t){if(!this.quillEditor)return null;var e={},r=!0,i=this.quillEditor.getText().trim().length;return this.minLength&&(e.minLengthError={given:i,minLength:this.minLength},r=i>=this.minLength||!i),this.maxLength&&(e.maxLengthError={given:i,maxLength:this.maxLength},r=i<=this.maxLength&&r),r?null:e},t.prototype.ngOnChanges=function(t){t.readOnly&&this.quillEditor&&this.quillEditor.enable(!t.readOnly.currentValue),t.modules&&this.quillEditor&&(R.register(this.font,!0),this.quillEditor=new R(this.editorElem,{modules:t.modules.currentValue,placeholder:this.placeholder||"Insert text here ...",readOnly:this.readOnly||!1,theme:this.theme||"snow",formats:this.formats}),this.elementRef.nativeElement.children[0].remove())},t.prototype.ngOnDestroy=function(){for(var t=0;t<this._formulas.length;t++){var e=this._formulas[t].unlisten;null!=e&&e()}this._formulaTextSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-quill-editor",template:'\n    <ng-content select="[ajf-quill-editor-toolbar]"></ng-content>\n  ',providers:[{provide:r.NG_VALUE_ACCESSOR,useExisting:i.forwardRef(function(){return t}),multi:!0},{provide:r.NG_VALIDATORS,useExisting:i.forwardRef(function(){return t}),multi:!0}],styles:["ajf-quill-editor .ajf-ql-container .ajf-ql-editor{min-height:200px;width:500px!important;padding-bottom:50px}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:i.ElementRef},{type:i.Renderer2},{type:L}]},t.propDecorators={theme:[{type:i.Input}],modules:[{type:i.Input}],readOnly:[{type:i.Input}],placeholder:[{type:i.Input}],maxLength:[{type:i.Input}],minLength:[{type:i.Input}],formats:[{type:i.Input}],initHTML:[{type:i.Input}],editorCreated:[{type:i.Output}],contentChanged:[{type:i.Output}],selectionChanged:[{type:i.Output}],formulaClick:[{type:i.Output}]},t}(),Q=function(){function t(t){this.service=t,this.onDragged=!1,this.currentContentWidget=null,this._onDraggedSub=D.Subscription.EMPTY}return Object.defineProperty(t.prototype,"widgetTypes",{get:function(){return T.AjfReportWidgetType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutWidget",{get:function(){return this.widget},enumerable:!0,configurable:!0}),t.prototype.canDropPredicate=function(t){return t.data.dropZones.forEach(function(t){if(-1<["header","widget"].indexOf(t))return!0}),!1},t.prototype.onDragStartHandler=function(){var t=this,e=D.timer(200).subscribe(function(){e.unsubscribe(),t.service.dragStarted()})},t.prototype.onDragEndHandler=function(){this.service.dragEnded()},t.prototype.getColumnContent=function(){return this.widget.content},t.prototype.getIcon=function(){var t=this.widget;return null==t.icon?null:t.icon.evaluate({})||{fontSet:"",fontIcon:""}},t.prototype.getFlag=function(){var t=this.widget;return null==t.flag?null:t.flag.evaluate({})||"ch"},t.prototype.getPercent=function(t){return(100*this.widget.columns[t]).toString()+"%"},t.prototype.getImageUrl=function(){var t=this.widget;return null==t.url?null:t.url.evaluate({})||""},t.prototype.getImageType=function(){return null!=this.widget?this.widget.imageType:P.AjfImageType.Image},t.prototype.getHtmlText=function(){var t;return""===(t=this.widget).htmlText?"...":t.htmlText},t.prototype.getCoordinate=function(){var t;return null==(t=this.widget).coordinate?[51.505,-.09,13]:t.coordinate},t.prototype.getTileLayer=function(){var t;return""===(t=this.widget).tileLayer?"http://{s}.tile.osm.org/{z}/{x}/{y}.png":t.tileLayerMap},t.prototype.getAttribution=function(){var t;return""===(t=this.widget).attribution?"&copy; <a href='http://osm.org/copyright'>O</a> contributors":t.attributionMap},t.prototype.addToList=function(t,e){this.onDragEndHandler(),this.service.addToColumn(t,e)},t.prototype.ngOnInit=function(){var n=this;this._onDraggedSub=this.service.onDragged.subscribe(function(t){n.onDragged=t}),this.getChartType=this.service.currentWidget.pipe(k.map(function(t){return null==t?0:n.widget.chartType}),k.distinctUntilChanged(),k.startWith(0)),this.getDataset=this.service.currentWidget.pipe(k.map(function(t){return null==t||null==t.dataset?[]:n.widget.dataset}),k.distinctUntilChanged()),this.getTableTitles=this.service.currentWidget.pipe(k.map(function(t){if(null==t)return[];var e=n.widget;if(null==e.dataset)return[];for(var r=[],i=0;i<e.dataset.length;i++)null!=e.dataset[i][0]&&r.push(e.dataset[i][0].label);return r})),this.getTableContent=this.service.currentWidget.pipe(k.map(function(t){if(null==t)return[];var e=n.widget;if(null!=e.dataset){for(var r=[],i=0;i<e.dataset.length;i++)for(var o=0;o<e.dataset[i].length;o++)null!=e.dataset[i]&&null!=e.dataset[i][o+1]&&(null==r[o]&&(r[o]=[]),null==r[o][i]&&(r[o][i]=" "),r[o].splice(i,1,e.dataset[i][o+1].label));return r}})),this.service.updateCurrentWidget(this.widget)},t.prototype.ngOnChanges=function(t){t.widget&&null!=t.widget.currentValue&&(this.widget=t.widget.currentValue)},t.prototype.ngOnDestroy=function(){this._onDraggedSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-renderer-widget",template:'<div class="ajf-container" [ngSwitch]="widget?.widgetType" [ngClass]="{\'ajf-drag-mode\': (onDragged || fixedZoom)}"><div *ngSwitchCase="widgetTypes.Layout" class="ajf-row ajf-layout" [applyStyles]="widget.styles"><div class="ajf-columns"><ng-template ngFor let-clm [ngForOf]="getColumnContent()" let-idx="index"><div class="ajf-column" [ngClass]="{\'ajf-fixed\': layoutWidget.columns[idx] == -1}" [style.width]="getPercent(idx)" [applyStyles]="widget.content[idx].styles"><ajf-report-builder-widgets-row-buttons [from]="\'layout\'" [fromWidget]="widget" [widget]="clm" [position]="idx" (onDragStart)="onDragStartHandler();" (onDragEnd)="onDragEndHandler();" [child]="true"></ajf-report-builder-widgets-row-buttons><ajf-column [column]="clm" [applyStyles]="widget.styles"></ajf-column><ng-template [ngIf]="onDragged === true"><div cdkDropList [cdkDropListEnterPredicate]="canDropPredicate" [style.display]="onDragged ? \'block\' : \'none\'" (cdkDropListDropped)="addToList($event, clm)" class="ajf-column-drop-zone" (dragover)="layoutShow = true;" (dragleave)="layoutShow = false;"></div></ng-template></div></ng-template></div></div><div *ngSwitchCase="widgetTypes.Image" class="ajf-row"><ajf-image [applyStyles]="widget.styles" [type]="getImageType()" [imageUrl]="getImageUrl()" [icon]="getIcon()" [flag]="getFlag()"></ajf-image></div><div *ngSwitchCase="widgetTypes.Text" class="ajf-row ajf-text"><ajf-text [htmlText]="getHtmlText() | translate" [applyStyles]="widget.styles"></ajf-text></div><div *ngSwitchCase="widgetTypes.Chart" class="ajf-row" [applyStyles]="widget.styles"></div><div *ngSwitchCase="widgetTypes.Table" class="ajf-row" [applyStyles]="widget.styles"><ajf-table [data]="(getTableContent|async)"></ajf-table></div><div *ngSwitchCase="widgetTypes.Map" class="ajf-row" [applyStyles]="widget.styles"><ajf-map [coordinate]="getCoordinate()" [tileLayer]="getTileLayer()" [attribution]="getAttribution()"></ajf-map></div></div>',styles:["ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-layout{border:none!important}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row{border:9px solid #00f;border-radius:36px;height:100%}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row .ajf-columns{border:9px solid red!important;height:100%;margin-bottom:20px;padding-bottom:20px;padding-top:20px}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row .ajf-columns .ajf-fixed{border:9px solid #ff0!important}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row .ajf-columns .ajf-column{border:9px solid #9acd32;margin-left:10px;margin-right:10px;border-radius:36px;height:100%}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row .ajf-columns .ajf-column ajf-report-builder-widgets-row-buttons{visibility:visible!important;display:block!important}ajf-report-builder-renderer-widget .ajf-drag-mode .ajf-row .ajf-columns .ajf-column .ajf-container{min-height:50px}ajf-report-builder-renderer-widget .ajf-container{height:inherit;display:block;min-height:50px}ajf-report-builder-renderer-widget .ajf-row-button{width:100%}ajf-report-builder-renderer-widget .ajf-container:hover{border:3px dotted #00f;border-radius:16px;opacity:1;min-height:50px}ajf-report-builder-renderer-widget .ajf-on-dragged{border:23px dotted #00f}ajf-report-builder-renderer-widget .ajf-selected{background-color:red}ajf-report-builder-renderer-widget .ajf-on-drag-over,ajf-report-builder-renderer-widget .ajf-show{border:33px dotted #00f;opacity:1!important;z-index:10}ajf-report-builder-renderer-widget .ajf-no-obj{max-width:200px;max-height:200px;width:auto;height:auto}ajf-report-builder-renderer-widget .ajf-row{display:flex;flex-direction:column;height:100%}ajf-report-builder-renderer-widget .ajf-columns{display:flex;flex-direction:row}ajf-report-builder-renderer-widget .ajf-column{min-height:50px}ajf-report-builder-renderer-widget .ajf-column ajf-report-builder-widgets-row-buttons{visibility:hidden!important;display:none!important}ajf-report-builder-renderer-widget .ajf-column:hover{border:3px dashed #9acd32;border-radius:16px}ajf-report-builder-renderer-widget .ajf-column:hover ajf-report-builder-widgets-row-buttons{visibility:visible!important;display:block!important}ajf-report-builder-renderer-widget .ajf-column:hover .ajf-container{min-height:50px}ajf-report-builder-renderer-widget .ajf-fixed:hover{border:3px dashed red!important}ajf-report-builder-renderer-widget .ajf-fixed{min-width:100px}ajf-report-builder-renderer-widget .ajf-column-drop-zone{margin:10%;height:50px;background-color:#fff;border:9px solid rgba(66,134,244,.6);border-radius:16px}ajf-report-builder-renderer-widget .ajf-text{min-height:20px}ajf-report-builder-renderer-widget ajf-map{z-index:30}ajf-report-builder-renderer-widget ajf-column{width:100%}ajf-report-builder-renderer-widget button{width:100%}ajf-report-builder-renderer-widget mat-list{height:100%;padding:0}ajf-report-builder-renderer-widget .ajf-ui.ajf-fluid.ajf-image{max-width:100%;height:auto}ajf-report-builder-renderer-widget .ajf-column-right{float:right;width:33%;background-color:#8b4513}ajf-report-builder-renderer-widget .ajf-column-center{display:inline-block;width:33%;background-color:olive}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t.propDecorators={widget:[{type:i.Input}],position:[{type:i.Input}],section:[{type:i.Input}]},t}(),X=function(){function t(t,e){this._service=t,this._dialogRef=e,this.currentWidget=null,this.currentColor="rgb(255,255,255,0)",this.section="color",this._currentWidgetSub=D.Subscription.EMPTY}return t.prototype.setWidgetStyles=function(t){this._service.setWidgetStyles(this.section,t),this.currentColor=t,this.setStyle()},t.prototype.setStyle=function(){null!=this.currentWidget&&(this.currentWidget.styles=I.deepCopy(this.currentWidget.styles),this._service.updateCurrentWidget(this.currentWidget))},t.prototype.addCustomColor=function(){this._service.addCustomColor(this.currentColor),this._service.updateCurrentWidget(this.currentWidget),this._dialogRef.close()},t.prototype.close=function(){this._dialogRef.close()},t.prototype.ngOnInit=function(){var e=this;this._currentWidgetSub=this._service.currentWidget.subscribe(function(t){null!==t?e.currentWidget!==t&&(e.currentWidget=t):e.currentWidget=null})},t.prototype.ngAfterViewInit=function(){this.elem.nativeElement.children[1].firstElementChild.style.position="initial"},t.prototype.ngOnDestroy=function(){this._currentWidgetSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"theme-color-dialog",template:'<div mat-dialog-content #colorpic><input [hidden]="false" [colorPicker]="currentColor" [style.background]="currentColor" [value]="currentColor" [cpDialogDisplay]="\'inline\'" [cpPosition]="\'top\'" [cpToggle]="true" [cpWidth]="\'400px\'" [cpOutputFormat]="\'rgba\'" (colorPickerChange)="setWidgetStyles($event)"></div><div mat-dialog-actions><button mat-button (click)="addCustomColor()">Save color</button></div>',encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialogRef}]},t.propDecorators={elem:[{type:i.ViewChild,args:["colorpic"]}]},t}(),tt=function(){function t(t,e){this._service=t,this.dialog=e,this.currentWidget=null,this.alphaColor=1,this.styleBackgroundColor="rgb(255,255,255,0)",this.styleColor="rgb(0,0,0,0)",this._colorsSub=D.Subscription.EMPTY,this._currentWidgetSub=D.Subscription.EMPTY,this._originSub=D.Subscription.EMPTY,this._headerStyleSub=D.Subscription.EMPTY,this._contentStylesSub=D.Subscription.EMPTY,this._footerStylesSub=D.Subscription.EMPTY}return t.prototype.setStyles=function(t){switch(this.section){case"widget":this.setWidgetStyles(t);break;case"report":this.setReportStyles(t);break;case"section":this.setSectionStyles(t);break;case"chart":this.setChartStyle(t)}},t.prototype.setChartStyle=function(t){"backgroundColor"===this.label?this.addChartBackgroundColor(t):this.addChartBorderColor(t)},t.prototype.setAlphaColor=function(t){t=t.toFixed(2);for(var e=0;e<this.colors.length;e++){var r=this.colors[e].lastIndexOf(",");this.colors[e]=this.colors[e].substring(0,r)+","+t+")"}},t.prototype.setWidgetStyles=function(t){"chart"===this.section?this.setChartStyle(t):(this._service.setWidgetStyles(this.label,t),this.currentColor=t,this.setStyle())},t.prototype.setSectionStyles=function(t){this._service.setSectionStyles(this.origin,this.label,t),this.styleColor=t},t.prototype.setReportStyles=function(t){this._service.setReportStyles(this.label,t),this.styleBackgroundColor=t},t.prototype.addChartBackgroundColor=function(t){this._service.addChartBackgroundColor(t)},t.prototype.addChartBorderColor=function(t){this._service.addChartBorderColor(t)},t.prototype.setStyle=function(){null!=this.currentWidget&&(this.currentWidget.styles=I.deepCopy(this.currentWidget.styles),this._service.updateCurrentWidget(this.currentWidget))},t.prototype.openDialog=function(){this.dialogRef=this.dialog.open(X)},t.prototype.ngOnInit=function(){var e=this;this._colorsSub=this._service.colors.subscribe(function(t){e.colors=t}),this._currentWidgetSub=this._service.currentWidget.subscribe(function(t){null!=t?e.currentWidget!==t&&(e.currentWidget=t):e.currentWidget=null}),this.getColorWidget=this._service.currentWidget.pipe(k.map(function(t){if(null!=t)return t.styles.color||""}),k.distinctUntilChanged()),this._originSub=this._service.origin.subscribe(function(t){e.origin=t}),this._headerStyleSub=this._service.headerStyles.subscribe(function(t){null!=t["background-color"]&&(e.styleBackgroundColor=t["background-color"])}),this._contentStylesSub=this._service.contentStyles.subscribe(function(t){null!=t["background-color"]&&(e.styleBackgroundColor=t["background-color"])}),this._footerStylesSub=this._service.footerStyles.subscribe(function(t){null!=t["background-color"]&&(e.styleBackgroundColor=t["background-color"])})},t.prototype.ngOnDestroy=function(){this._colorsSub.unsubscribe(),this._currentWidgetSub.unsubscribe(),this._originSub.unsubscribe(),this._headerStyleSub.unsubscribe(),this._contentStylesSub.unsubscribe(),this._footerStylesSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-theme-color",template:'<mat-card style="width:90%"><mat-card-header><mat-card-title>{{ label }} Trasparency</mat-card-title></mat-card-header><mat-card-content><mat-slider style="width:90%" (change)="setAlphaColor($event.value)" min="0" max="1" step="0.1" [value]="alphaColor" thumbLabel></mat-slider></mat-card-content></mat-card><mat-card style="width:90%"><mat-card-header><mat-card-title>{{ label }}</mat-card-title></mat-card-header><mat-card-content><mat-grid-list cols="8" rowHeight="25px"><mat-grid-tile *ngFor="let color of colors" [colspan]="1" [rowspan]="1" [style.background]="color"><button style="height:100%" (click)="setStyles(color)" mat-button></button></mat-grid-tile></mat-grid-list></mat-card-content><mat-card-actions><button mat-button (click)="openDialog()" style="width:90%;">Add color</button> <button mat-button (click)="setStyles(\'\')" style="width:90%">Reset</button></mat-card-actions></mat-card>',styles:[""],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialog}]},t.propDecorators={section:[{type:i.Input}],label:[{type:i.Input}],init:[{type:i.Input}]},t}(),et=function(){function t(t,e){this._service=t,this._dialogRef=e}return t.prototype.resetReport=function(){this._service.setReport({header:{content:[],styles:{}},content:{content:[],styles:{}},footer:{content:[],styles:{}},styles:{}}),this._dialogRef.close()},t.prototype.close=function(){this._dialogRef.close()},t.decorators=[{type:i.Component,args:[{selector:"toolbar-dialog",template:'<h1 matDialogTitle>Dialog</h1><div mat-dialog-content>Are you sure you want to erase the report?</div><div mat-dialog-actions><button mat-button (click)="resetReport()">Yes</button> <button mat-button (click)="close()">No</button></div>',encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialogRef}]},t}(),rt=function(){function t(t,e){this._service=t,this.dialog=e,this.addClick=new i.EventEmitter,this.zoom=!1,this.emptyContent=this._service.emptyContent}return t.prototype.canDropPredicate=function(t){return-1<t.data.dropZones.indexOf("widget")},t.prototype.JSONRequest=function(){},t.prototype.onAddClick=function(t){this.addClick.emit(t)},t.prototype.addToList=function(t){null!=t.item.data.widget&&this._service.addCustomWidgets({json:JSON.stringify(t.item.data.widget.toJson()),type:""})},t.prototype.undoLastOperation=function(){try{var t=JSON.parse(this._service.popJsonStack()||"");this._service.setReport(T.AjfReport.fromJson(t))}catch(t){}},t.prototype.isZoomed=function(){this.zoom=!this.zoom,this.zoom?this._service.fixedZoomIn():this._service.fixedZoomOut()},t.prototype.openDialog=function(){this.dialogRef=this.dialog.open(et)},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-toolbar",outputs:["addClick"],styles:["ajf-report-builder-toolbar a{margin-right:10px}ajf-report-builder-toolbar .ajf-custom-widget-drop-zone{position:absolute;right:0;background-color:#90ee90}"],template:'<mat-toolbar><button mat-button (click)="onAddClick($event)" matTooltip="open widget sidebar" [matTooltipPosition]="\'above\'">Open</button> <button mat-button (click)="openDialog()" matTooltip="reset the current report" [matTooltipPosition]="\'above\'">reset</button> <button mat-button (click)="undoLastOperation()" matTooltip="undo the last operation" [disabled]="emptyContent|async" [matTooltipPosition]="\'above\'">Undo</button> <button mat-button class="ajf-custom-widget-drop-zone" cdkDropList [cdkDropListEnterPredicate]="canDropPredicate" (cdkDropListDropped)="addToList($event);" matTooltip="add custom widget on toolbar" [matTooltipPosition]="\'above\'">add custom widget here <i class="material-icons">add_circle_outline</i></button><section class="example-section"><mat-slide-toggle [checked]="zoom" (change)="isZoomed()" matTooltip="apply zoom out" [matTooltipPosition]="\'above\'">zoom out</mat-slide-toggle></section></mat-toolbar>',encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L},{type:l.MatDialog}]},t}(),it=function(){function t(){}return t.prototype.ngOnInit=function(){this.widgetIcon="reportbuilder-"+this.widgetType.toLowerCase()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-widget-toolbar-button",inputs:["widgetType"],template:'<button mat-button matTooltip="{{ widgetType}}" [matTooltipPosition]="\'above\'"><mat-icon fontSet="ajf-icon" fontIcon="{{ widgetIcon }}"></mat-icon></button>',styles:["ajf-report-builder-widget-toolbar-button button mat-icon{font-size:35px;padding-top:10px;padding-bottom:10px;padding-right:20px;color:#3f51b5}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[]},t}(),ot=function(){function t(t){this._service=t,this.currentWidget=null,this.isClicked=!1,this.color=[],this.isOver=!1,this.onDragged=!1,this.onOver=!1,this._currentWidgetSub=D.Subscription.EMPTY,this._onDraggedSub=D.Subscription.EMPTY,this._onOverSub=D.Subscription.EMPTY}return t.prototype.selectedWidget=function(){this.isClicked=!this.isClicked,this._service.setOrigin(this.from),this._service.updateCurrentWidget(this.widget)},t.prototype.remove=function(){null!=this.fromWidget&&this._service.updateCurrentWidget(this.fromWidget),this._service.remove(this.from,this.position)},t.prototype.onFocus=function(){return this.widget===this.currentWidget},t.prototype.changeColumn=function(t){"back"==t?this._service.changeColumn(this.position,this.position-1,this.fromWidget):this._service.changeColumn(this.position,this.position+1,this.fromWidget)},t.prototype.isColumn=function(){return"Column"===this.label},t.prototype.isOneColumn=function(){return!(1<this.fromWidget.columns.length)},t.prototype.ngOnInit=function(){var t,e,r=this;this.label=T.AjfReportWidgetType[this.widget.widgetType],this.widgetIcon=(t=this.widget.widgetType,"reportbuilder-"+T.AjfReportWidgetType[t].toLowerCase()),this.widgetLabel=(e=this.widget.widgetType,B(T.AjfReportWidgetType[e])),this._onDraggedSub=this._service.onDragged.subscribe(function(t){r.onDragged=t}),this._onOverSub=this._service.onOver.subscribe(function(t){r.onOver=t}),this._currentWidgetSub=this._service.currentWidget.subscribe(function(t){(r.currentWidget=t)!==r.widget&&(r.isClicked=!1)})},t.prototype.ngOnDestroy=function(){this._onDraggedSub.unsubscribe(),this._onOverSub.unsubscribe(),this._currentWidgetSub.unsubscribe()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-widgets-row-buttons",inputs:["from","fromWidget","position","widget","child","isOver"],template:'<div class="ajf-container" *ngIf="onOver || onDragged"><div class="ajf-button-row"><ng-template [ngIf]="isColumn() && onDragged == false"><span (click)="changeColumn(\'forward\')" matTooltip="move right" [matTooltipPosition]="\'above\'"><i class="material-icons">arrow_forward</i></span></ng-template><ng-template [ngIf]="(isColumn()== false && onDragged == true) || true"><span mat-button [ngClass]="{\'ajf-selected\': onFocus()}" matTooltip="{{label}}" [matTooltipPosition]="\'above\'" (click)="selectedWidget()"><ng-template [ngIf]="isColumn()"><i class="material-icons">settings</i></ng-template><ng-template [ngIf]="(isColumn()) ? false : true"><mat-icon fontSet="ajf-icon" fontIcon="{{ widgetIcon }}"></mat-icon></ng-template></span><span mat-button matTooltip="remove" (click)="remove()" [matTooltipPosition]="\'above\'"><mat-icon>remove_circle_outline</mat-icon></span></ng-template><ng-template [ngIf]="isColumn() && onDragged == false"><span (click)="changeColumn(\'back\')" matTooltip="move left" [matTooltipPosition]="\'above\'"><i class="material-icons">arrow_back</i></span></ng-template></div></div>',styles:["ajf-report-builder-widgets-row-buttons{position:relative;display:block}ajf-report-builder-widgets-row-buttons .ajf-container{height:30px}ajf-report-builder-widgets-row-buttons .ajf-container .ajf-button-row{margin:0;width:100%!important;padding:0;position:absolute;right:0;display:flex;flex-direction:row-reverse;z-index:50;overflow-x:auto;background-color:rgba(144,238,144,.6);color:#000!important;border-radius:16px}ajf-report-builder-widgets-row-buttons .ajf-container .ajf-button-row button,ajf-report-builder-widgets-row-buttons .ajf-container .ajf-button-row span{flex-flow:wrap row;margin-right:10px;cursor:pointer}ajf-report-builder-widgets-row-buttons .ajf-container .ajf-button-row button mat-icon,ajf-report-builder-widgets-row-buttons .ajf-container .ajf-button-row span mat-icon{margin-top:5px;font-size:20px}ajf-report-builder-widgets-row-buttons .ajf-container .ajf-selected{background-color:#3b623b;color:#81d481}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t}(),nt=function(){function t(t){this.service=t,this.chartTypes=I.sizedEnumToStringArray(T.AjfChartType),this.widgetTypes=I.sizedEnumToStringArray(T.AjfReportWidgetType);var e=this.widgetTypes.indexOf("Column");-1!==e&&this.widgetTypes.splice(e,1)}return t.prototype.onDragStartHandler=function(){var t=this,e=D.timer(200).subscribe(function(){null!=e&&e.unsubscribe(),t.service.dragStarted()})},t.prototype.onDragEndHandler=function(){this.service.dragEnded()},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder-widgets-toolbar",template:"<mat-list><mat-list-item *ngFor=\"let t of widgetTypes\"><ajf-report-builder-widget-toolbar-button ng-if=\"t != 'Column'\" cdkDrag [cdkDragData]=\"{widgetType: t, dropZones: ['header','content','footer','column','widget']}\" [widgetType]=\"t\" (onDragStart)=\"onDragStartHandler();\" (onDragEnd)=\"onDragEndHandler();\"></ajf-report-builder-widget-toolbar-button></mat-list-item></mat-list>",encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t}(),at=function(){function t(t){this._service=t,this._init=!1}return Object.defineProperty(t.prototype,"report",{get:function(){return this._report},set:function(t){null!=t&&(this._report=t,this._init&&this._setCurrentReport())},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){this._setCurrentReport(),this._init=!0},t.prototype._setCurrentReport=function(){this._service.setReportForms(null!=this.report&&this.report.forms||[]),this._service.setReport(this.report)},t.decorators=[{type:i.Component,args:[{selector:"ajf-report-builder",template:'<ajf-report-builder-toolbar (addClick)="start.toggle()"></ajf-report-builder-toolbar><ajf-report-builder-custom-widgets-toolbar (addClick)="start.toggle()"></ajf-report-builder-custom-widgets-toolbar><mat-drawer-container><mat-drawer #start position="start" mode="side" class="ajf-builder-sidebar"><ajf-report-builder-widgets-toolbar></ajf-report-builder-widgets-toolbar></mat-drawer><ajf-report-builder-content></ajf-report-builder-content><mat-drawer #end position="end" mode="side" class="ajf-builder-prop" [opened]="true"><ajf-report-builder-properties></ajf-report-builder-properties></mat-drawer></mat-drawer-container>',styles:["ajf-report-builder{display:block;position:relative;width:100%;height:100%;overflow:hidden}ajf-report-builder mat-sidenav-container{height:100%}ajf-report-builder mat-sidenav-container .ajf-builder-sidebar{max-width:7%}ajf-report-builder mat-sidenav-container .ajf-builder-prop{max-width:30%}"],encapsulation:i.ViewEncapsulation.None,changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:L}]},t.propDecorators={startSidenav:[{type:i.ViewChild,args:[g.MatSidenav]}],report:[{type:i.Input}]},t}(),st=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,r.FormsModule,o.DragDropModule,n.MatButtonModule,a.MatButtonToggleModule,s.MatCardModule,l.MatDialogModule,d.MatGridListModule,c.MatIconModule,u.MatListModule,p.MatSelectModule,g.MatSidenavModule,m.MatSlideToggleModule,f.MatSliderModule,h.MatTabsModule,b.MatToolbarModule,y.MatTooltipModule,v.TranslateModule,j.ColorPickerModule,w.AjfCommonModule,S.AjfImageModule,x.AjfMapModule,C.AjfMonacoEditorModule,W.AjfTableModule,_.AjfTextModule],declarations:[K,A,V,N,U,H,q,Y,$,Z,G,Q,X,tt,et,rt,it,ot,nt,at,J],exports:[at],entryComponents:[Y,X,et],providers:[L]}]}],t}();t.AjfReportBuilderModule=st,t.AjfReportBuilderService=L,t.AjfReportBuilder=at,t.AJF_REPORTS_CONFIG=F,t.b=A,t.c=V,t.d=N,t.e=U,t.f=H,t.g=q,t.i=$,t.h=Y,t.t=J,t.j=Z,t.k=G,t.a=K,t.l=Q,t.n=tt,t.m=X,t.p=rt,t.o=et,t.q=it,t.r=ot,t.s=nt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=material-report-builder.umd.min.js.map
