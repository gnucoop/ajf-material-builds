!function(i,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ajf/material/monaco-editor"),require("@ajf/material/node-icon"),require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/material/autocomplete"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/checkbox"),require("@angular/material/chips"),require("@angular/material/dialog"),require("@angular/material/form-field"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/list"),require("@angular/material/menu"),require("@angular/material/select"),require("@angular/material/sidenav"),require("@angular/material/slider"),require("@angular/material/table"),require("@angular/material/toolbar"),require("@angular/material/tooltip"),require("@ngx-translate/core"),require("@ajf/core/forms"),require("@angular/cdk/collections"),require("rxjs"),require("rxjs/operators"),require("@ajf/core/models"),require("@ajf/core/utils"),require("@angular/cdk/keycodes")):"function"==typeof define&&define.amd?define("@ajf/material/form-builder",["exports","@ajf/material/monaco-editor","@ajf/material/node-icon","@angular/cdk/drag-drop","@angular/common","@angular/core","@angular/forms","@angular/material/autocomplete","@angular/material/button","@angular/material/card","@angular/material/checkbox","@angular/material/chips","@angular/material/dialog","@angular/material/form-field","@angular/material/icon","@angular/material/input","@angular/material/list","@angular/material/menu","@angular/material/select","@angular/material/sidenav","@angular/material/slider","@angular/material/table","@angular/material/toolbar","@angular/material/tooltip","@ngx-translate/core","@ajf/core/forms","@angular/cdk/collections","rxjs","rxjs/operators","@ajf/core/models","@ajf/core/utils","@angular/cdk/keycodes"],e):e(((i=i||self).ajf=i.ajf||{},i.ajf.material=i.ajf.material||{},i.ajf.material.formBuilder={}),i.ng.material.monacoEditor,i.ng.material.nodeIcon,i.ng.cdk.dragDrop,i.ng.common,i.ng.core,i.ng.forms,i.ng.material.autocomplete,i.ng.material.button,i.ng.material.card,i.ng.material.checkbox,i.ng.material.chips,i.ng.material.dialog,i.ng.material.formField,i.ng.material.icon,i.ng.material.input,i.ng.material.list,i.ng.material.menu,i.ng.material.select,i.ng.material.sidenav,i.ng.material.slider,i.ng.material.table,i.ng.material.toolbar,i.ng.material.tooltip,i.ngxTranslate.core,i.ng.core.forms,i.ng.cdk.collections,i.rxjs,i.rxjs.operators,i.ng.core.models,i.ng.core.utils,i.ng.cdk.keycodes)}(this,(function(i,e,t,n,o,r,a,s,l,d,c,u,p,f,h,m,g,b,_,v,y,C,S,j,E,F,D,x,O,w,N,T){"use strict";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var V=function(){function i(i,e){this._el=i,this._renderer=e,this._offset=0,this._height=0}return Object.defineProperty(i.prototype,"offset",{set:function(i){this._offset=i,this._updateOffset()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"color",{set:function(i){this._color=i,this._updateColor()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{set:function(i){this._height=i,this._updateHeight()},enumerable:!1,configurable:!0}),i.prototype._updateHeight=function(){var i=Math.max(0,this._height-25)+"px";this._renderer.setStyle(this._el.nativeElement,"height",i)},i.prototype._updateOffset=function(){var i=4*this._offset+"px";this._renderer.setStyle(this._el.nativeElement,"margin-top",i),this._renderer.setStyle(this._el.nativeElement,"margin-left",i)},i.prototype._updateColor=function(){this._renderer.setStyle(this._el.nativeElement,"border-color",this._color)},i}();V.decorators=[{type:r.Component,args:[{selector:"ajf-fb-branch-line",template:"",encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-branch-line{display:block;position:absolute;top:25px;left:25px;width:25px;border-top:2px solid;border-left:2px solid;border-top-left-radius:6px}\n"]}]}],V.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer2}]},V.propDecorators={offset:[{type:r.Input}],color:[{type:r.Input}],height:[{type:r.Input}]};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var M=function(i,e){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])})(i,e)};function P(i,e){var t="function"==typeof Symbol&&i[Symbol.iterator];if(!t)return i;var n,o,r=t.call(i),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(i){o={error:i}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a}function k(){for(var i=[],e=0;e<arguments.length;e++)i=i.concat(P(arguments[e]));return i}var I=function(i){function e(){var e=i.call(this)||this;return e._choices=new x.BehaviorSubject([]),e._choicesObs=e._choices,e}return function t(i,e){function t(){this.constructor=i}M(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}(e,i),e.prototype.connect=function(){return this._choicesObs},e.prototype.disconnect=function(){},e.prototype.updateChoices=function(i){this._choices.next(i)},e}(D.DataSource),R=function(){function i(){this._displayedColumns=["label","value","delete"],this.editing={},this._choices=new I,this._choicesArr=[]}return Object.defineProperty(i.prototype,"displayedColumns",{get:function(){return this._displayedColumns},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},set:function(i){this._choicesOrigin=i,this.name=i.name,this.label=i.label,this.canEditChoices=F.isChoicesFixedOrigin(i),this._choicesArr=i.choices,this._choices.updateChoices(this._choicesArr)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choices",{get:function(){return this._choices},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choicesArr",{get:function(){return this._choicesArr},enumerable:!1,configurable:!0}),i.prototype.updateValue=function(i,e,t,n){this.editing[n+"-"+e]=!1,this._choicesArr[n][e]=i.target.value,this._choices.updateChoices(this._choicesArr)},i.prototype.deleteRow=function(i){this._choicesArr.splice(i,1),this._choices.updateChoices(this._choicesArr)},i.prototype.addRow=function(){this._choicesArr.push({label:"",value:""}),this._choices.updateChoices(this._choicesArr)},i}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function A(i,e){if(i.nodes.indexOf(e)>-1)return i;for(var t=i.nodes.filter((function(i){return F.isContainerNode(i)})),n=t.length,o=0;o<n;o++){var r=A(t[o],e);if(null!=r)return r}return null}function B(i,e,t){void 0===t&&(t=!1);var n=i.filter((function(i){return i.parent===e.id})).sort((function(i,e){return i.parentNode-e.parentNode})).map((function(e){var t=B(i,e);return 0===t.length&&t.push({parent:e,parentNode:0}),{node:e,children:t,content:L(0,e)}}));if(!t)for(var o=e.conditionalBranches.length,r=n.length;r<o;r++)n.push({parent:e,parentNode:r});return n}function L(i,e){return F.isContainerNode(e)?B(e.nodes,e,!0):[]}function W(i){var e=[];return i.forEach((function(i){F.isContainerNode(i)&&(e=e.concat(W(i.nodes))),e.push(i)})),e}function Y(i,e,t){return void 0===t&&(t=null),i.filter(null!=t?function(i){return i.parent===e.id&&i.parentNode===t}:function(i){return i.parent===e.id})}function U(i,e,t){void 0===t&&(t=null);for(var n=W(i),o=[],r=Y(n,e,t),a=r.length,s=0;s<a;s++)o=o.concat(Y(n,r[s]));return function i(e,t){for(var n=e.length,o=0;o<n;o++){var r=e[o];F.isContainerNode(r)&&(r.nodes=i(r.nodes,t))}return e.filter((function(i){return-1===t.indexOf(i.id)}))}(i,(o=o.concat(r)).map((function(i){return i.id})))}R.decorators=[{type:r.Component,args:[{selector:"ajf-fb-choices-origin-editor",template:'<div>\n  <mat-form-field>\n    <input matInput [(ngModel)]="name"\n        [placeholder]="\'Name\' | translate">\n  </mat-form-field>\n  <mat-form-field>\n    <input matInput [(ngModel)]="label"\n        [placeholder]="\'Label\' | translate">\n  </mat-form-field>\n  <ng-template [ngIf]="canEditChoices">\n    <button (click)="addRow()" mat-button>\n      <mat-icon>add</mat-icon>\n      <span translate>Add value</span>\n    </button>\n    <mat-table [dataSource]="choices">\n      <ng-container matColumnDef="label">\n        <mat-header-cell *matHeaderCellDef translate>Label</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n          <input matInput [(ngModel)]="row.label" type="text">\n        </mat-cell>\n      </ng-container>\n      <ng-container matColumnDef="value">\n        <mat-header-cell *matHeaderCellDef translate>Value</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n          <input matInput [(ngModel)]="row.value" type="text">\n        </mat-cell>\n      </ng-container>\n      <ng-container matColumnDef="delete">\n        <mat-header-cell *matHeaderCellDef translate>Delete</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n            <mat-icon (click)="deleteRow(idx)">delete</mat-icon>\n        </mat-cell>\n      </ng-container>\n\n      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\n      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\n    </mat-table>\n  </ng-template>\n</div>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-choices-origin-editor mat-form-field+mat-form-field{margin-left:1em}ajf-fb-choices-origin-editor mat-table{max-height:300px}ajf-fb-choices-origin-editor mat-table mat-icon{cursor:pointer}\n"]}]}],R.propDecorators={choicesOrigin:[{type:r.Input}]};var q=0,z=function(){function i(){this._availableNodeTypes=[{label:"Slide",icon:{fontSet:"ajf-icon",fontIcon:"field-slide"},nodeType:{node:F.AjfNodeType.AjfSlide},isSlide:!0},{label:"Repeating slide",icon:{fontSet:"ajf-icon",fontIcon:"field-repeatingslide"},nodeType:{node:F.AjfNodeType.AjfRepeatingSlide},isSlide:!0},{label:"String",icon:{fontSet:"ajf-icon",fontIcon:"field-string"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.String}},{label:"Text",icon:{fontSet:"ajf-icon",fontIcon:"field-text"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Text}},{label:"Number",icon:{fontSet:"ajf-icon",fontIcon:"field-number"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Number}},{label:"Boolean",icon:{fontSet:"ajf-icon",fontIcon:"field-boolean"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Boolean}},{label:"Single choice",icon:{fontSet:"ajf-icon",fontIcon:"field-singlechoice"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.SingleChoice}},{label:"Multiple choice",icon:{fontSet:"ajf-icon",fontIcon:"field-multiplechoice"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.MultipleChoice}},{label:"Formula",icon:{fontSet:"ajf-icon",fontIcon:"field-formula"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Formula}},{label:"Date",icon:{fontSet:"ajf-icon",fontIcon:"field-date"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Date}},{label:"Date input",icon:{fontSet:"ajf-icon",fontIcon:"field-dateinput"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.DateInput}},{label:"Time",icon:{fontSet:"ajf-icon",fontIcon:"field-time"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Time}},{label:"Table",icon:{fontSet:"ajf-icon",fontIcon:"field-table"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Table}}],this._form=new x.BehaviorSubject(null),this._formObs=this._form,this._editedNodeEntry=new x.BehaviorSubject(null),this._editedNodeEntryObs=this._editedNodeEntry,this._editedCondition=new x.BehaviorSubject(null),this._editedConditionObs=this._editedCondition,this._editedChoicesOrigin=new x.BehaviorSubject(null),this._editedChoicesOriginObs=this._editedChoicesOrigin,this._beforeNodesUpdate=new r.EventEmitter,this._beforeNodesUpdateObs=this._beforeNodesUpdate,this._afterNodeUpdate=new r.EventEmitter,this._afterNodeUpdateObs=this._afterNodeUpdate,this._nodesUpdates=new x.Subject,this._attachmentsOriginsUpdates=new x.Subject,this._choicesOriginsUpdates=new x.Subject,this._stringIdentifierUpdates=new x.Subject,this._saveNodeEntryEvent=new r.EventEmitter,this._deleteNodeEntryEvent=new r.EventEmitter,this._initChoicesOriginsStreams(),this._initAttachmentsOriginsStreams(),this._initStringIdentifierStreams(),this._initNodesStreams(),this._initFormStreams(),this._initSaveNode(),this._initDeleteNode()}return Object.defineProperty(i.prototype,"availableNodeTypes",{get:function(){return this._availableNodeTypes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"form",{get:function(){return this._formObs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"attachmentsOrigins",{get:function(){return this._attachmentsOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stringIdentifier",{get:function(){return this._stringIdentifier},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flatNodes",{get:function(){return this._flatNodes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flatFields",{get:function(){return this._flatFields},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"editedNodeEntry",{get:function(){return this._editedNodeEntryObs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"editedCondition",{get:function(){return this._editedConditionObs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"editedChoicesOrigin",{get:function(){return this._editedChoicesOriginObs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"beforeNodesUpdate",{get:function(){return this._beforeNodesUpdateObs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"afterNodeUpdate",{get:function(){return this._afterNodeUpdateObs},enumerable:!1,configurable:!0}),i.prototype.setForm=function(i){i!==this._form.getValue()&&this._form.next(i)},i.prototype.editNodeEntry=function(i){this._editedNodeEntry.next(i)},i.prototype.editCondition=function(i){this._editedCondition.next(i)},i.prototype.saveCurrentCondition=function(i){var e=this._editedCondition.getValue();null!=e&&(e.condition=i,this._editedCondition.next(null))},i.prototype.cancelConditionEdit=function(){this._editedChoicesOrigin.next(null)},i.prototype.insertNode=function(i,e,t,n){var o;void 0===n&&(n=!1);var r=++q,a=null!=i.nodeType.field;o=a?F.createField({id:r,nodeType:F.AjfNodeType.AjfField,fieldType:i.nodeType.field,parent:e.id,parentNode:t,name:""}):F.createContainerNode({id:r,nodeType:i.nodeType.node,parent:null!=e?e.id:0,parentNode:t,name:"",nodes:[]}),this._beforeNodesUpdate.emit(),this._nodesUpdates.next((function(i){if(0===o.parent)return[o];var t=F.isContainerNode(e)&&n?e:A({nodes:i},e);if(null!=t)if(a)t.nodes.push(o);else{var r=t.nodes===i,s=t.nodes.slice(0);s.push(o),t.nodes=s,r&&(i=s)}return i}))},i.prototype.saveNodeEntry=function(i){this._saveNodeEntryEvent.emit(i)},i.prototype.cancelNodeEntryEdit=function(){this._editedNodeEntry.next(null)},i.prototype.deleteNodeEntry=function(i){this._deleteNodeEntryEvent.next(i)},i.prototype.getCurrentForm=function(){return x.combineLatest([this.form,this.nodes,this.attachmentsOrigins,this.choicesOrigins,this.stringIdentifier]).pipe(O.filter((function(i){return null!=P(i,1)[0]})),O.map((function(i){var e=P(i,5),t=e[0],n=e[1],o=e[2],r=e[4];return F.createForm({choicesOrigins:e[3].slice(0),attachmentsOrigins:o.slice(0),stringIdentifier:(r||[]).slice(0),nodes:n.slice(0),supplementaryInformations:t.supplementaryInformations})})))},i.prototype.editChoicesOrigin=function(i){this._editedChoicesOrigin.next(i)},i.prototype.createChoicesOrigin=function(){this._editedChoicesOrigin.next(F.createChoicesFixedOrigin({name:""}))},i.prototype.cancelChoicesOriginEdit=function(){this._editedChoicesOrigin.next(null)},i.prototype.saveChoicesOrigin=function(i){var e=this._editedChoicesOrigin.getValue();null!=e&&(e.label=i.label,e.name=i.name,F.isChoicesFixedOrigin(e)&&(e.choices=i.choices),this._choicesOriginsUpdates.next((function(i){var t=i.indexOf(e);return t>-1?k(i.slice(0,t),[e],i.slice(t+1)):k(i,[e])}))),this._editedChoicesOrigin.next(null)},i.prototype.saveStringIdentifier=function(i){this._stringIdentifierUpdates.next((function(){return k(i)}))},i.prototype._findMaxNodeId=function(i,e){var t=this;void 0===e&&(e=0);var n=0;return i.forEach((function(i){n=Math.max(n,i.id),F.isContainerNode(i)&&(n=Math.max(n,t._findMaxNodeId(i.nodes)))})),n},i.prototype._initFormStreams=function(){var i=this;this._form.subscribe((function(e){q=0,null!=e&&null!=e.nodes&&e.nodes.length>0&&(q=i._findMaxNodeId(e.nodes)),i._nodesUpdates.next((function(i){return null!=e&&null!=e.nodes?e.nodes.slice(0):[]})),i._attachmentsOriginsUpdates.next((function(i){return null!=e&&null!=e.attachmentsOrigins?e.attachmentsOrigins.slice(0):[]})),i._choicesOriginsUpdates.next((function(i){return null!=e&&null!=e.choicesOrigins?e.choicesOrigins.slice(0):[]})),i._stringIdentifierUpdates.next((function(i){return null!=e&&null!=e.stringIdentifier?e.stringIdentifier.slice(0):[]}))}))},i.prototype._initChoicesOriginsStreams=function(){this._choicesOrigins=this._choicesOriginsUpdates.pipe(O.scan((function(i,e){return e(i)}),[]),O.publishReplay(1),O.refCount())},i.prototype._initAttachmentsOriginsStreams=function(){this._attachmentsOrigins=this._attachmentsOriginsUpdates.pipe(O.scan((function(i,e){return e(i)}),[]),O.publishReplay(1),O.refCount())},i.prototype._initStringIdentifierStreams=function(){this._stringIdentifier=this._stringIdentifierUpdates.pipe(O.scan((function(i,e){return e(i)}),[]),O.publishReplay(1),O.refCount())},i.prototype._initNodesStreams=function(){this._nodes=this._nodesUpdates.pipe(O.scan((function(i,e){return e(i)}),[]),O.publishReplay(1),O.refCount()),this._flatNodes=this._nodes.pipe(O.map((function(i){return W(i)})),O.publishReplay(1),O.refCount()),this._flatFields=this._flatNodes.pipe(O.map((function(i){return i.filter((function(i){return!F.isContainerNode(i)}))})),O.publishReplay(1),O.refCount()),this._nodeEntriesTree=this._nodes.pipe(O.map((function(i){return function e(i){var e=i.filter((function(i){return null==i.parent||0===i.parent}));if(1===e.length){var t=e[0];if(F.isSlidesNode(t)){var n=[];return n.push({node:t,container:null,children:B(i,t),content:L(0,t)}),n}}else if(0===e.length)return[null];throw new Error("Invalid form definition")}(i)})),O.publishReplay(1),O.refCount())},i.prototype._initSaveNode=function(){var i=this;this._saveNodeEntryEvent.pipe(O.withLatestFrom(this.editedNodeEntry,this.choicesOrigins,this.attachmentsOrigins),O.filter((function(i){return null!=P(i,2)[1]})),O.map((function(e){var t=P(e,2),n=t[0],o=t[1];i._beforeNodesUpdate.emit();var r=o,a=r.node,s=N.deepCopy(a);s.id=r.node.id,s.name=n.name,s.label=n.label,s.visibility=null!=n.visibility?w.createCondition({condition:n.visibility}):null;var l=s.conditionalBranches.length;s.conditionalBranches=null!=n.conditionalBranches?n.conditionalBranches.map((function(i){return w.createCondition({condition:i})})):[w.alwaysCondition()];var d=s.conditionalBranches.length;if(F.isRepeatingContainerNode(s)){var c=s;c.formulaReps=null!=n.formulaReps?w.createFormula({formula:n.formulaReps}):void 0,c.minReps=n.minReps,c.maxReps=n.maxReps}if(F.isField(s)){var u=s;u.description=n.description,u.defaultValue=n.defaultValue,u.formula=null!=n.formula?w.createFormula({formula:n.formula}):void 0;var p=n.value,f=n.notEmpty,h=n.validationConditions,m=parseInt(n.minValue,10),g=parseInt(n.maxValue,10),b=parseInt(n.minDigits,10),_=parseInt(n.maxDigits,10);if(isNaN(m)&&(m=null),isNaN(g)&&(g=null),isNaN(b)&&(b=null),isNaN(_)&&(_=null),null!=p||null!=f||null!=h&&h.length>0||null!=m||null!=g||null!=b||null!=_){var v=u.validation||F.createValidationGroup({});v.forceValue=p,v.notEmpty=f?F.notEmptyValidation():void 0,v.minValue=null!=m?F.minValidation(m):void 0,v.maxValue=null!=g?F.maxValidation(g):void 0,v.minDigits=null!=b?F.minDigitsValidation(b):void 0,v.maxDigits=null!=_?F.maxDigitsValidation(_):void 0,v.conditions=(h||[]).map((function(i){return F.createValidation({condition:i.condition,errorMessage:i.errorMessage})})),u.validation=v}else u.validation=void 0;var y=n.notEmptyWarning,C=n.warningConditions;if(null!=y||null!=C&&C.length>0){var S=u.warning||F.createWarningGroup({});S.notEmpty=y?F.notEmptyWarning():void 0,S.conditions=(C||[]).map((function(i){return F.createWarning({condition:i.condition,warningMessage:i.warningMessage})})),u.warning=S}else u.warning=void 0;if(u.nextSlideCondition=null!=n.nextSlideCondition?w.createCondition({condition:n.nextSlideCondition}):void 0,u.size=n.size,u.defaultValue=n.defaultValue,F.isFieldWithChoices(u)){var j=u;j.choicesOriginRef=n.choicesOriginRef,j.forceExpanded=n.forceExpanded,j.forceNarrow=n.forceNarrow,j.triggerConditions=(n.triggerConditions||[]).map((function(i){return w.createCondition({condition:i})}))}}return i._editedNodeEntry.next(null),function(i){var e=A({nodes:i},a);if(null!=e){var t=e.nodes===i,n=e.nodes.indexOf(a),o=e.nodes.slice(0,n);if(o.push(s),o=o.concat(e.nodes.slice(n+1)),e.nodes=o,i=t?o:i.slice(0),d<l)for(var r=d;r<l;r++)i=U(i,s,r)}return i}}))).subscribe(this._nodesUpdates)},i.prototype._initDeleteNode=function(){var i=this;this._deleteNodeEntryEvent.pipe(O.map((function(e){return i._beforeNodesUpdate.emit(),function(i){var t=e.node,n=A({nodes:i},t);if(null!=n){var o=n.nodes===i,r=n.nodes.indexOf(t),a=n.nodes.slice(0,r);a=a.concat(n.nodes.slice(r+1)),n.nodes=a,i=U(i=o?a:i.slice(0),t)}return i}}))).subscribe(this._nodesUpdates)},i}();z.decorators=[{type:r.Injectable}],z.ctorParameters=function(){return[]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var H=function(){function i(i){this._service=i,this._choicesOrigin=this._service.editedChoicesOrigin.pipe(O.filter((function(i){return null!=i})),O.map((function(i){return i})))}return Object.defineProperty(i.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},enumerable:!1,configurable:!0}),i.prototype.saveChoicesOrigin=function(){this._service.saveChoicesOrigin({label:this.editor.label,name:this.editor.name,choices:this.editor.choicesArr})},i.prototype.cancelChoicesOriginEdit=function(){this._service.cancelChoicesOriginEdit()},i}();H.decorators=[{type:r.Component,args:[{selector:"ajf-fb-choices-origin-editor-dialog",template:'<h3 matDialogTitle translate>Edit choices origin</h3>\n<mat-dialog-content>\n  <ajf-fb-choices-origin-editor\n      *ngIf="choicesOrigin|async as co"\n      [choicesOrigin]="co!"></ajf-fb-choices-origin-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveChoicesOrigin()">Save</button>\n  <button mat-button translate (click)="cancelChoicesOriginEdit()">Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["\n"]}]}],H.ctorParameters=function(){return[{type:z}]},H.propDecorators={editor:[{type:r.ViewChild,args:[R,{static:!1}]}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var $=function(){function i(i){}return Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},set:function(i){this._fields=i,this._updateVariables()},enumerable:!1,configurable:!0}),i.prototype.insertVariable=function(i){if(null!=this.monacoEditor&&null!=this.monacoEditor.editor){var e=this.monacoEditor.editor,t=e.getValue().split("\n"),n=e.getPosition(),o=n.lineNumber-1,r=t[o],a=n.column-1;r=r.substring(0,a)+i+r.substring(a),t[o]=r,n.column+=i.length,this.monacoEditor.value=t.join("\n"),e.setPosition(n),e.focus(),this.editedValue=e.getValue()}},i.prototype.onEditorInit=function(){monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES2015,allowNonTsExtensions:!0,allowJs:!0,module:monaco.languages.typescript.ModuleKind.None});try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-variables.d.ts")}catch(i){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=""}try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-functions.d.ts")}catch(i){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=""}this._updateVariables(),this._updateFunctions()},i.prototype._updateVariables=function(){var i=this;if(null!=this._fields)try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=this._fields.map((function(e){return"declare const "+e.name+": "+i._fieldVarType(e.fieldType)+";"})).join("\n")}catch(i){}},i.prototype._updateFunctions=function(){try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=w.AjfExpressionUtils.UTIL_FUNCTIONS}catch(i){}},i.prototype._fieldVarType=function(i){switch(i){case F.AjfFieldType.Boolean:return"boolean";case F.AjfFieldType.Date:case F.AjfFieldType.DateInput:case F.AjfFieldType.Time:return"Date";case F.AjfFieldType.Empty:return"void";case F.AjfFieldType.Formula:return"number";case F.AjfFieldType.MultipleChoice:case F.AjfFieldType.SingleChoice:return"any";case F.AjfFieldType.Number:return"number";case F.AjfFieldType.Table:return"Array";case F.AjfFieldType.String:case F.AjfFieldType.Text:return"string"}return null},i}();$.decorators=[{type:r.Component,args:[{selector:"ajf-condition-editor",template:'<div class="ajf-editor">\n  <ajf-monaco-editor\n      (init)="onEditorInit()"\n      (valueChange)="editedValue = $event"\n      [value]="condition" language="javascript"></ajf-monaco-editor>\n</div>\n<div class="ajf-editor-panel">\n  <ng-container *ngIf="fields as curFields">\n    <mat-nav-list dense *ngIf="curFields!.length > 0">\n      <a mat-list-item\n          (click)="insertVariable(field.name)"\n          [matTooltip]="field.label"\n          *ngFor="let field of curFields!">\n        <ajf-node-icon [node]="field"></ajf-node-icon>\n        {{ field.name }}\n      </a>\n    </mat-nav-list>\n  </ng-container>\n</div>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["ajf-condition-editor{display:flex;flex-direction:row;align-items:stretch;max-height:512px}ajf-condition-editor .ajf-editor{flex:.75 0 auto;display:flex;flex-direction:row;align-items:stretch}ajf-condition-editor .ajf-editor monaco-editor{flex:1 0 auto;min-width:512px;min-height:256px}ajf-condition-editor .ajf-editor-panel{flex:.25 0 auto;overflow-y:auto}ajf-condition-editor ajf-monaco-editor{min-width:400px}\n"]}]}],$.ctorParameters=function(){return[{type:F.AjfValidationService}]},$.propDecorators={monacoEditor:[{type:r.ViewChild,args:[e.AjfMonacoEditor,{static:!0}]}],fields:[{type:r.Input}],condition:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var J=function(){function i(i,e){this.dialogRef=e,this._fields=i.flatFields.pipe(O.map((function(i){return i.sort((function(i,e){return i.name.localeCompare(e.name)}))})))}return Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),i.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close(this.editor.editedValue)},i}();J.decorators=[{type:r.Component,args:[{selector:"ajf-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],J.ctorParameters=function(){return[{type:z},{type:p.MatDialogRef}]},J.propDecorators={editor:[{type:r.ViewChild,args:[$,{static:!1}]}]};var Z=function(){function i(i,e){var t=this;this._service=i,this._cdr=e,this.dataSource=new C.MatTableDataSource,this.displayedColumns=["label","value","delete"],this.separatorKeysCodes=[T.ENTER,T.COMMA],this._stringIdentifierSub=x.Subscription.EMPTY,this._stringIdentifierSub=i.stringIdentifier.subscribe((function(i){t.dataSource.data=k(i)})),this.fields$=i.flatFields.pipe(O.map((function(i){return i.sort((function(i,e){return i.name.localeCompare(e.name)})).map((function(i){return i.name})).filter((function(i){return i.length>0}))})),O.shareReplay(1))}return i.prototype.addRow=function(){this.dataSource.data=k(this.dataSource.data,[{label:"",value:[]}])},i.prototype.deleteRow=function(i){this.dataSource.data=k(this.dataSource.data.slice(0,i),this.dataSource.data.slice(i+1))},i.prototype.addValue=function(i,e,t){0!==e.value.length&&(i.value=k(i.value,[e.value]),t.value="",this._cdr.markForCheck())},i.prototype.removeValue=function(i,e){var t=i.value.indexOf(e);t>-1&&(i.value=k(i.value.slice(0,t),i.value.slice(t+1)),this._cdr.markForCheck())},i.prototype.ngOnDestroy=function(){this._stringIdentifierSub.unsubscribe()},i.prototype.saveStringIdentifier=function(){this._service.saveStringIdentifier(this.dataSource.data)},i.prototype.selected=function(i,e){i.value=k(i.value,[e.option.value]),this._cdr.markForCheck()},i}();Z.decorators=[{type:r.Component,args:[{selector:"ajf-fb-string-identifier-dialog",template:'<h3 matDialogTitle translate>Edit identifier</h3>\n<mat-dialog-content>\n  <button (click)="addRow()" mat-button>\n    <mat-icon>add</mat-icon>\n    <span translate>Add value</span>\n  </button>\n  <mat-table [dataSource]="dataSource">\n    <ng-container matColumnDef="label">\n      <mat-header-cell *matHeaderCellDef translate>Label</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n        <mat-form-field>\n          <input matInput [placeholder]="\'Label\'|translate" autofocus [(ngModel)]="row.label">\n        </mat-form-field>\n      </mat-cell>\n    </ng-container>\n    <ng-container matColumnDef="value">\n      <mat-header-cell *matHeaderCellDef translate>Value</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n        <mat-form-field>\n          <mat-chip-list #chipList>\n            <mat-chip\n                *ngFor="let field of row.value"\n                (removed)="removeValue(row, field)"\n            >\n              {{ field }}\n              <mat-icon matChipRemove>cancel</mat-icon>\n            </mat-chip>\n          </mat-chip-list>\n          <input\n              #valueInput\n              [ngModel]="row.value"\n              [matAutocomplete]="valueAc"\n              [matChipInputFor]="chipList"\n              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"\n              [matChipInputAddOnBlur]="true"\n              (matChipInputTokenEnd)="addValue(row, $event, valueInput)"\n              [placeholder]="\'Value\'|translate">\n          <mat-autocomplete #valueAc="matAutocomplete"\n              (optionSelected)="selected(row, $event)">\n            <mat-option *ngFor="let field of fields$ | async" [value]="field">{{field}}</mat-option>\n          </mat-autocomplete>\n        </mat-form-field>\n      </mat-cell>\n    </ng-container>\n    <ng-container matColumnDef="delete">\n      <mat-header-cell *matHeaderCellDef translate>Delete</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n          <mat-icon (click)="deleteRow(idx)">delete</mat-icon>\n      </mat-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\n    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\n  </mat-table>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate matDialogClose (click)="saveStringIdentifier()">Save</button>\n</mat-dialog-actions>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["\n"]}]}],Z.ctorParameters=function(){return[{type:z},{type:r.ChangeDetectorRef}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var G=function(){function i(i,e){var t=this;this._service=i,this._dialog=e,this._vc=new r.EventEmitter,this._init=!1,this._editConditionSub=x.Subscription.EMPTY,this._beforeNodesUpdateSub=x.Subscription.EMPTY,this._editChoicesOriginSub=x.Subscription.EMPTY,this._stringIdentifierSub=x.Subscription.EMPTY,this._nodeTypes=i.availableNodeTypes,this._nodeEntriesTree=i.nodeEntriesTree,this._choicesOrigins=i.choicesOrigins,this._editConditionSub=this._service.editedCondition.subscribe((function(i){null!=t._editConditionDialog&&(t._editConditionDialog.close(),t._editConditionDialog=null),null!=i&&(t._editConditionDialog=t._dialog.open(J,{disableClose:!0}))})),this._editChoicesOriginSub=this._service.editedChoicesOrigin.subscribe((function(i){null!=t._editChoicesOriginDialog&&(t._editChoicesOriginDialog.close(),t._editChoicesOriginDialog=null),null!=i&&(t._editChoicesOriginDialog=t._dialog.open(H,{disableClose:!0}))})),this._beforeNodesUpdateSub=this._service.beforeNodesUpdate.subscribe((function(){null!=t.designerCont&&(t._lastScrollTop=t.designerCont.nativeElement.scrollTop)})),this.nodeEntriesTree.pipe(O.sample(this._vc)).subscribe((function(){null!=t.designerCont&&(t.designerCont.nativeElement.scrollTop=t._lastScrollTop)})),this._stringIdentifierSub=this._service.stringIdentifier.subscribe((function(){}))}return Object.defineProperty(i.prototype,"form",{get:function(){return this._form},set:function(i){this._form!==i&&(this._form=i,this._init&&this._setCurrentForm())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodeTypes",{get:function(){return this._nodeTypes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),i.prototype.ngAfterViewChecked=function(){this._vc.emit()},i.prototype.ngAfterContentInit=function(){this._setCurrentForm(),this._init=!0},i.prototype.ngOnDestroy=function(){this._editConditionSub.unsubscribe(),this._beforeNodesUpdateSub.unsubscribe(),this._editChoicesOriginSub.unsubscribe(),this._stringIdentifierSub.unsubscribe(),this._service.setForm(null)},i.prototype.createChoicesOrigin=function(){this._service.createChoicesOrigin()},i.prototype.disableDropPredicate=function(){return!1},i.prototype.editChoicesOrigin=function(i){this._service.editChoicesOrigin(i)},i.prototype.editStringIdentifier=function(){null!=this._stringIdentifierDialog&&(this._stringIdentifierDialog.close(),this._stringIdentifierDialog=null),this._stringIdentifierDialog=this._dialog.open(Z,{disableClose:!0,width:"60%",height:"60%"})},i.prototype._setCurrentForm=function(){this._service.setForm(this._form)},i}();G.decorators=[{type:r.Component,args:[{selector:"ajf-form-builder",template:'<mat-toolbar>\n  <button mat-icon-button (click)="leftSidenav.toggle()">\n    <mat-icon>add_box</mat-icon>\n  </button>\n  <button mat-button [matMenuTriggerFor]="choicesMenu" translate>Choices</button>\n  <button mat-button (click)="editStringIdentifier()" translate>Identifier</button>\n  <mat-menu #choicesMenu>\n    <button (click)="createChoicesOrigin()" mat-menu-item translate>New..</button>\n    <ng-container *ngIf="choicesOrigins|async as cos">\n      <button *ngFor="let choicesOrigin of cos"\n          (click)="editChoicesOrigin(choicesOrigin)" mat-menu-item>\n        {{ choicesOrigin.label || choicesOrigin.name }}\n      </button>\n    </ng-container>\n  </mat-menu>\n  <span class="ajf-spacer"></span>\n  <button mat-icon-button (click)="rightSidenav.toggle()">\n    <mat-icon>settings</mat-icon>\n  </button>\n</mat-toolbar>\n<mat-drawer-container cdkDropListGroup>\n  <mat-drawer #leftSidenav position="start" mode="over">\n    <div #sourceDropList cdkDropList\n        [cdkDropListEnterPredicate]="disableDropPredicate"\n        [cdkDropListData]="nodeTypes">\n      <ajf-fb-node-type-entry *ngFor="let nodeType of nodeTypes"\n          cdkDrag\n          [cdkDragData]="nodeType"\n          (cdkDragStarted)="leftSidenav.close()"\n          [nodeType]="nodeType"></ajf-fb-node-type-entry>\n    </div>\n  </mat-drawer>\n  <mat-drawer #rightSidenav position="end" mode="side" [opened]="true">\n    <ajf-fb-node-properties></ajf-fb-node-properties>\n  </mat-drawer>\n  <div #designer class="ajf-designer">\n    <ajf-fb-node-entry\n        *ngFor="let nodeEntry of (nodeEntriesTree|async); let isFirst = first"\n        [isFirst]="isFirst"\n        [nodeEntry]="nodeEntry"></ajf-fb-node-entry>\n  </div>\n</mat-drawer-container>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["ajf-form-builder{display:flex;position:relative;min-height:300px;flex-direction:column;align-items:stretch}ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-button]{flex:1 0 auto}ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-icon-button]{flex:0 0 auto}ajf-form-builder mat-drawer-container{flex:1}ajf-form-builder mat-drawer-container mat-drawer{max-width:20%}ajf-form-builder mat-drawer-container .ajf-designer{padding:1em}ajf-form-builder mat-toolbar .ajf-spacer{flex:1 1 auto}\n"]}]}],G.ctorParameters=function(){return[{type:z},{type:p.MatDialog}]},G.propDecorators={designerCont:[{type:r.ViewChild,args:["designer",{static:!0}]}],form:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var K=["#F44336","#4CAF50","#3F51B5","#FFC107","#795548"],Q=function(){function i(i){this._service=i,this._hasContent=!1,this._isFirst=!1,this._isNodeEntry=!1,this._level=0,this._branchColors=K.slice(0),this._dropZones=["fbdz-node"],this._slideDropZones=["fbdz-slide"],this._originOffset=0,this._originLeftMargin="0",this._firstBranchColor=K[0],this._branchLinesSubscription=x.Subscription.EMPTY,this._childEntriesSubscription=x.Subscription.EMPTY,this._currentEditedNode=this._service.editedNodeEntry}return Object.defineProperty(i.prototype,"hasContent",{get:function(){return this._hasContent},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFirst",{get:function(){return this._isFirst},set:function(i){this._isFirst=i},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isNodeEntry",{get:function(){return this._isNodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodeEntry",{get:function(){return this._nodeEntry},set:function(i){if(this._nodeEntry=i,null!=i&&void 0!==i.node){var e=i;this._isNodeEntry=!0;var t=e.node;this._hasContent=null!=t&&F.isContainerNode(t)}else this._isNodeEntry=!1,this._hasContent=!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"level",{get:function(){return this._level},set:function(i){this._level=i},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realNodeEntry",{get:function(){return this._nodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"branchColors",{get:function(){return this._branchColors},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropZones",{get:function(){return this._dropZones},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"slideDropZones",{get:function(){return this._slideDropZones},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"originOffset",{get:function(){return this._originOffset},set:function(i){this._originOffset=i,this._originLeftMargin=4*this._originOffset+"px"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"originLeftMargin",{get:function(){return this._originLeftMargin},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"firstBranchColor",{get:function(){return this._firstBranchColor},set:function(i){var e=K.indexOf(i);e>0?(this._firstBranchColor=i,this._branchColors=K.slice(e).concat(K.slice(0,e))):(this._firstBranchColor=K[0],this._branchColors=K.slice(0))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentEditedNode",{get:function(){return this._currentEditedNode},enumerable:!1,configurable:!0}),i.prototype.onResize=function(){},i.prototype.edit=function(){null!=this.nodeEntry&&this.isNodeEntry&&this._service.editNodeEntry(this.nodeEntry)},i.prototype.delete=function(){null!=this.nodeEntry&&this.isNodeEntry&&this._service.deleteNodeEntry(this.nodeEntry)},i.prototype.ngAfterViewInit=function(){var i=this;setTimeout((function(){return i._updateBranchHeights()})),this._childEntriesSubscription=this.childEntries.changes.subscribe((function(){i._updateBranchHeights()}))},i.prototype.ngOnDestroy=function(){this._branchLinesSubscription.unsubscribe(),this._childEntriesSubscription.unsubscribe()},i.prototype.onDropSuccess=function(i,e){void 0===e&&(e=!1);var t=i.item.data;if(null!=this._nodeEntry){if(void 0!==t.nodeType&&(!this.isNodeEntry||this.isNodeEntry&&e)){var n=e?{parent:this.nodeEntry.node,parentNode:0}:this._nodeEntry;this._service.insertNode(t,n.parent,n.parentNode,e)}}else this._service.insertNode(t,null,0,e)},i.prototype.disableSlideDropPredicate=function(i){return!i.data.isSlide},i.prototype.emptyAreaDropPredicate=function(){var i=this;return function(e,t){return i._level>0?!e.data.isSlide:e.data.isSlide||!1}},i.prototype._updateBranchHeights=function(){if(null!=this.nodeEntry&&this.isNodeEntry&&null!=this.branchLines&&null!=this.childEntries){var i=this.nodeEntry,e=this.branchLines.toArray(),t=null!=i.content?i.content.length:0,n=this.childEntries.toArray().slice(t);e.length==n.length&&e.forEach((function(i,e){i.height=n[e].nativeElement.offsetTop}))}},i}();Q.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-entry",template:'<ng-container *ngIf="nodeEntry != null ; else rootEmpty">\n  <ng-template [ngIf]="isNodeEntry">\n    <ajf-fb-branch-line\n        *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index"\n        [offset]="idx"\n        [color]="branchColors[idx]"></ajf-fb-branch-line>\n  </ng-template>\n  <div class="mat-card-container"\n      [class.ajf-highlight]="(currentEditedNode|async) == nodeEntry">\n    <div *ngIf="!isFirst"\n        class="ajf-origin-line"\n        [style.margin-left]="originLeftMargin"\n        [style.border-color]="firstBranchColor"></div>\n    <ng-template [ngIf]="isNodeEntry">\n      <mat-card>\n        <div class="ajf-title-row">\n          <ajf-node-icon [node]="realNodeEntry.node"></ajf-node-icon>\n          <span class="ajf-title" [innerHTML]="(realNodeEntry.node.label || realNodeEntry.node.name)  | translate"></span>\n          <span class="ajf-actions">\n            <button [disabled]="(currentEditedNode|async) == nodeEntry" (click)="edit()" mat-icon-button>\n              <mat-icon>edit</mat-icon>\n            </button>\n            <button [disabled]="(currentEditedNode|async) == null" (click)="delete()" mat-icon-button>\n              <mat-icon>delete</mat-icon>\n            </button>\n          </span>\n        </div>\n        <div *ngIf="hasContent">\n          <ajf-fb-node-entry\n              *ngFor="let contentEntry of realNodeEntry.content; let isFirstChild = first; let idx = index"\n              [level]="level + 1"\n              [isFirst]="isFirstChild"\n              [firstBranchColor]="branchColors[idx]"\n              [nodeEntry]="contentEntry"></ajf-fb-node-entry>\n          <mat-card class="ajf-empty"\n              *ngIf="realNodeEntry.content.length === 0"\n              cdkDropList\n              [cdkDropListEnterPredicate]="disableSlideDropPredicate"\n              (cdkDropListDropped)="onDropSuccess($event, true)">&nbsp;</mat-card>\n        </div>\n      </mat-card>\n    </ng-template>\n    <ng-template [ngIf]="!isNodeEntry">\n      <mat-card class="ajf-empty"\n          cdkDropList\n          [cdkDropListEnterPredicate]="emptyAreaDropPredicate()"\n          (cdkDropListDropped)="onDropSuccess($event)">&nbsp;</mat-card>\n    </ng-template>\n  </div>\n  <ng-template [ngIf]="isNodeEntry">\n    <ajf-fb-node-entry\n        *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index"\n        [level]="level"\n        [originOffset]="idx"\n        [firstBranchColor]="branchColors[idx]"\n        [nodeEntry]="childNodeEntry"></ajf-fb-node-entry>\n  </ng-template>\n</ng-container>\n<ng-template #rootEmpty>\n  <div class="mat-card-container">\n    <mat-card class="ajf-empty"\n        cdkDropList\n        [cdkDropListEnterPredicate]="emptyAreaDropPredicate()"\n        (cdkDropListDropped)="onDropSuccess($event)">&nbsp;</mat-card>\n  </div>\n</ng-template>\n',host:{"(window.resize)":"onResize()"},encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-entry{display:block;position:relative}ajf-fb-node-entry .mat-card-container{position:relative}ajf-fb-node-entry .mat-card-container .ajf-origin-line{position:absolute;top:0;left:25px;width:25px;height:25px;border-bottom:2px solid;border-left:2px solid;border-bottom-left-radius:.5em}ajf-fb-node-entry .mat-card-container mat-card{margin-left:50px;padding:.5em 1em;margin-top:.2em;margin-bottom:.2em;background-color:#fff}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row{display:flex;flex-direction:row;align-items:center}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-title{flex:1 1 auto}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-actions{flex:0 0 auto;white-space:nowrap}ajf-fb-node-entry .mat-card-container mat-card.ajf-empty{line-height:36px;border:2px dashed;box-shadow:none;box-sizing:border-box}ajf-fb-node-entry .mat-card-container.ajf-highlight>mat-card{background-color:#fff9c4}\n"]}]}],Q.ctorParameters=function(){return[{type:z}]},Q.propDecorators={branchLines:[{type:r.ViewChildren,args:[V]}],childEntries:[{type:r.ViewChildren,args:[Q,{read:r.ElementRef}]}],isFirst:[{type:r.Input}],nodeEntry:[{type:r.Input}],level:[{type:r.Input}],originOffset:[{type:r.Input}],firstBranchColor:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var X=function(){function i(i,e){this.dialogRef=e,this._fields=i.flatFields.pipe(O.map((function(i){return i.sort((function(i,e){return i.name.localeCompare(e.name)}))})))}return Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),i.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close({condition:this.editor.editedValue,errorMessage:this.errorMessage})},i}();X.decorators=[{type:r.Component,args:[{selector:"ajf-fb-validation-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <mat-form-field>\n    <input matInput [(ngModel)]="errorMessage" [placeholder]="\'Error message\' | translate">\n  </mat-form-field>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-validation-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],X.ctorParameters=function(){return[{type:z},{type:p.MatDialogRef}]},X.propDecorators={editor:[{type:r.ViewChild,args:[$,{static:!1}]}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var ii=function(){function i(i,e){this.dialogRef=e,this._fields=i.flatFields.pipe(O.map((function(i){return i.sort((function(i,e){return i.name.localeCompare(e.name)}))})))}return Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),i.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close({condition:this.editor.editedValue,warningMessage:this.warningMessage})},i}();function ei(i){var e=i.value.minReps,t=i.value.maxReps;return null!=e&&null!=t&&e>t?{reps:"Min repetions cannot be greater than max repetitions"}:null}function ti(i){var e=i.value.minValue,t=i.value.maxValue;return null!=e&&null!=t&&e>t?{valueLimit:"Min value cannot be greater than max value"}:null}function ni(i){var e=i.value.minDigits,t=i.value.maxDigits;return null!=e&&null!=t&&e>t?{digits:"Min digits cannot be greater than max digits"}:null}ii.decorators=[{type:r.Component,args:[{selector:"ajf-fb-warning-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <mat-form-field>\n    <input matInput [(ngModel)]="warningMessage"\n      [placeholder]="\'Warning message\' | translate">\n  </mat-form-field>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-warning-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],ii.ctorParameters=function(){return[{type:z},{type:p.MatDialogRef}]},ii.propDecorators={editor:[{type:r.ViewChild,args:[$,{static:!1}]}]};var oi=function(){function i(i,e,t,n){var o=this;this._cdr=i,this._service=e,this._dialog=t,this._fb=n,this._fieldSizes=[{label:"Normal",value:"normal"},{label:"Small",value:"small"},{label:"Smaller",value:"smaller"},{label:"Tiny",value:"tiny"},{label:"Mini",value:"mini"}],this._choicesOrigins=[],this._conditionalBranches=[],this._validationConditions=[],this._warningConditions=[],this.isRepeatingContainerNode=function(i){return null!=i&&F.isRepeatingContainerNode(i.node)},this._visibilityOptSub=x.Subscription.EMPTY,this._visibilitySub=x.Subscription.EMPTY,this._conditionalBranchesSub=x.Subscription.EMPTY,this._formulaRepsSub=x.Subscription.EMPTY,this._choicesFilterSub=x.Subscription.EMPTY,this._formulaSub=x.Subscription.EMPTY,this._forceValueSub=x.Subscription.EMPTY,this._validationConditionsSub=x.Subscription.EMPTY,this._warningConditionsSub=x.Subscription.EMPTY,this._nextSlideConditionSub=x.Subscription.EMPTY,this._choicesOriginsSub=x.Subscription.EMPTY,this._triggerConditionsSub=x.Subscription.EMPTY,this._editConditionDialogSub=x.Subscription.EMPTY,this._editValidationConditionDialogSub=x.Subscription.EMPTY,this._editWarningConditionDialogSub=x.Subscription.EMPTY,this._editVisibilityEvt=new r.EventEmitter,this._editVisibilitySub=x.Subscription.EMPTY,this._editConditionalBranchEvt=new r.EventEmitter,this._editConditionalBranchSub=x.Subscription.EMPTY,this._editFormulaRepsEvt=new r.EventEmitter,this._editFormulaRepsSub=x.Subscription.EMPTY,this._editChoicesFilterEvt=new r.EventEmitter,this._editChoicesFilterSub=x.Subscription.EMPTY,this._editFormulaEvt=new r.EventEmitter,this._editFormulaSub=x.Subscription.EMPTY,this._editForceValueEvt=new r.EventEmitter,this._editForceValueSub=x.Subscription.EMPTY,this._editValidationConditionEvt=new r.EventEmitter,this._editValidationConditionSub=x.Subscription.EMPTY,this._addValidationConditionEvt=new r.EventEmitter,this._addValidationConditionSub=x.Subscription.EMPTY,this._removeValidationConditionEvt=new r.EventEmitter,this._removeValidationConditionSub=x.Subscription.EMPTY,this._editWarningConditionEvt=new r.EventEmitter,this._editWarningConditionSub=x.Subscription.EMPTY,this._addWarningConditionEvt=new r.EventEmitter,this._addWarningConditionSub=x.Subscription.EMPTY,this._removeWarningConditionEvt=new r.EventEmitter,this._removeWarningConditionSub=x.Subscription.EMPTY,this._editNextSlideConditionEvt=new r.EventEmitter,this._editNextSlideConditionSub=x.Subscription.EMPTY,this._editTriggerConditionEvt=new r.EventEmitter,this._editTriggerConditionSub=x.Subscription.EMPTY,this._addTriggerConditionEvt=new r.EventEmitter,this._addTriggerConditionSub=x.Subscription.EMPTY,this._removeTriggerConditionEvt=new r.EventEmitter,this._removeTriggerConditionSub=x.Subscription.EMPTY,this._saveEvt=new r.EventEmitter,this._saveSub=x.Subscription.EMPTY,this._nodeEntry=e.editedNodeEntry,this._choicesOriginsSub=e.choicesOrigins.subscribe((function(i){return o._choicesOrigins=i||[]})),this._enabled=this._nodeEntry.pipe(O.map((function(i){return null!=i}))),this._initForm(),this._initVisibilityEdit(),this._initConditionalBranchEdit(),this._initFormulaRepsEdit(),this._initChoicesFilterEdit(),this._initFormulaEdit(),this._initForceValueEdit(),this._initValidationConditionEdit(),this._initAddValidationCondition(),this._initRemoveValidationCondition(),this._initWarningConditionEdit(),this._initAddWarningCondition(),this._initRemoveWarningCondition(),this._initNextSlideConditionEdit(),this._initTriggerConditionEdit(),this._initAddTriggerCondition(),this._initRemoveTriggerCondition(),this._initSave()}return Object.defineProperty(i.prototype,"fieldSizes",{get:function(){return this._fieldSizes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nodeEntry",{get:function(){return this._nodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"propertiesForm",{get:function(){return this._propertiesForm},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasChoices",{get:function(){return this._hasChoices},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curVisibility",{get:function(){return this._curVisibility},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curFormulaReps",{get:function(){return this._curFormulaReps},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curChoicesFilter",{get:function(){return this._curChoicesFilter},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curForceValue",{get:function(){return this._curForceValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curFormula",{get:function(){return this._curFormula},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"conditionalBranches",{get:function(){return this._conditionalBranches},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"validationConditions",{get:function(){return this._validationConditions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"warningConditions",{get:function(){return this._warningConditions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nextSlideCondition",{get:function(){return this._nextSlideCondition},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"triggerConditions",{get:function(){return this._triggerConditions},enumerable:!1,configurable:!0}),i.prototype.editVisibility=function(){this._editVisibilityEvt.emit()},i.prototype.editConditionalBranch=function(i){i<0||i>=this._conditionalBranches.length||this._editConditionalBranchEvt.emit(i)},i.prototype.editFormulaReps=function(){this._editFormulaRepsEvt.emit()},i.prototype.editChoicesFilter=function(){this._editChoicesFilterEvt.emit()},i.prototype.editFormula=function(){this._editFormulaEvt.emit()},i.prototype.editForceValue=function(){this._editForceValueEvt.emit()},i.prototype.editValidationCondition=function(i){i<0||i>=this._validationConditions.length||this._editValidationConditionEvt.emit(i)},i.prototype.addValidationCondition=function(){this._addValidationConditionEvt.emit()},i.prototype.removeValidationCondition=function(i){i<0||i>=this._validationConditions.length||this._removeValidationConditionEvt.emit(i)},i.prototype.editWarningCondition=function(i){i<0||i>=this._warningConditions.length||this._editWarningConditionEvt.emit(i)},i.prototype.addWarningCondition=function(){this._addWarningConditionEvt.emit()},i.prototype.removeWarningCondition=function(i){i<0||i>=this._warningConditions.length||this._removeWarningConditionEvt.emit(i)},i.prototype.editNextSlideCondition=function(){this._editNextSlideConditionEvt.emit()},i.prototype.editTriggerCondition=function(i){i<0||i>=this._triggerConditions.length||this._editTriggerConditionEvt.emit(i)},i.prototype.addTriggerCondition=function(){this._addTriggerConditionEvt.emit()},i.prototype.removeTriggerCondition=function(i){i<0||i>=this._triggerConditions.length||this._removeTriggerConditionEvt.emit(i)},i.prototype.isField=function(i){return null!=i&&F.isField(i.node)},i.prototype.isNumericField=function(i){return F.isField(i)&&F.isNumberField(i)},i.prototype.isFieldWithChoices=function(i){return F.isField(i)&&F.isFieldWithChoices(i)},i.prototype.save=function(){this._saveEvt.emit()},i.prototype.cancel=function(){this._service.cancelNodeEntryEdit()},i.prototype.ngOnDestroy=function(){this._choicesOriginsSub.unsubscribe(),this._visibilityOptSub.unsubscribe(),this._visibilitySub.unsubscribe(),this._formulaRepsSub.unsubscribe(),this._choicesFilterSub.unsubscribe(),this._formulaSub.unsubscribe(),this._forceValueSub.unsubscribe(),this._validationConditionsSub.unsubscribe(),this._warningConditionsSub.unsubscribe(),this._triggerConditionsSub.unsubscribe(),this._editConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub.unsubscribe(),this._editChoicesFilterSub.unsubscribe(),this._editConditionalBranchSub.unsubscribe(),this._editVisibilitySub.unsubscribe(),this._editFormulaRepsSub.unsubscribe(),this._editFormulaSub.unsubscribe(),this._editForceValueSub.unsubscribe(),this._editValidationConditionSub.unsubscribe(),this._editWarningConditionSub.unsubscribe(),this._nextSlideConditionSub.unsubscribe(),this._addTriggerConditionSub.unsubscribe(),this._addValidationConditionSub.unsubscribe(),this._addWarningConditionSub.unsubscribe(),this._editNextSlideConditionSub.unsubscribe(),this._editTriggerConditionSub.unsubscribe(),this._removeTriggerConditionSub.unsubscribe(),this._removeValidationConditionSub.unsubscribe(),this._removeWarningConditionSub.unsubscribe(),this._saveSub.unsubscribe()},i.prototype._initSave=function(){var i=this;this._saveSub=this._saveEvt.pipe(O.withLatestFrom(this.propertiesForm)).subscribe((function(e){var t=P(e,2),n=Object.assign(Object.assign({},t[1].value),{conditionalBranches:i._conditionalBranches});i._service.saveNodeEntry(n)}))},i.prototype._initForm=function(){var i=this;this._propertiesForm=this._nodeEntry.pipe(O.filter((function(i){return null!=i})),O.map((function(e){null!=i._visibilityOptSub&&i._visibilityOptSub.unsubscribe(),null!=i._visibilitySub&&i._visibilitySub.unsubscribe(),null!=i._conditionalBranchesSub&&i._conditionalBranchesSub.unsubscribe();var t=null!=(e=e).node.visibility?e.node.visibility.condition:null,n=null!=e.node.visibility?i._guessVisibilityOpt(e.node.visibility):null,o={name:[e.node.name,a.Validators.required],label:e.node.label,visibilityOpt:[n,a.Validators.required],visibility:[t,a.Validators.required],conditionalBranchesNum:e.node.conditionalBranches.length},r=[];if(F.isRepeatingContainerNode(e.node)){var s=e.node,l=null!=s.formulaReps?s.formulaReps.formula:null;o.formulaReps=[l,a.Validators.required],o.minReps=s.minReps,o.maxReps=s.maxReps,i._curFormulaReps=l,r.push(ei)}if(i.isField(e)){var d=e.node,c=null,u=!1,p=[];null!=d.validation&&(null!=d.validation.forceValue&&(c=d.validation.forceValue.condition),u=null!=d.validation.notEmpty,p=(d.validation.conditions||[]).map((function(i){return{condition:i.condition,errorMessage:i.errorMessage}})));var f=!1,h=[];null!=d.warning&&(f=null!=d.warning.notEmpty,h=(d.warning.conditions||[]).map((function(i){return{condition:i.condition,warningMessage:i.warningMessage}})));var m=null!=d.formula?d.formula.formula:null;o.description=d.description,o.defaultValue=d.defaultValue,o.size=d.size,o.formula=m,o.forceValue=c,o.notEmpty=u,o.validationConditions=[p,[]],o.notEmptyWarning=f,o.warningConditions=[h,[]],o.nextSlideCondition=[d.nextSlideCondition],i._curForceValue=c,i._curFormula=m,i._validationConditions=p,i._warningConditions=h}if(i.isNumericField(e.node)){var g=e.node,b=void 0,_=void 0,v=void 0,y=void 0;null!=g.validation&&(null!=g.validation.minValue&&(b=(g.validation.minValue.condition||"").replace("$value >= ","")),null!=g.validation.maxValue&&(_=(g.validation.maxValue.condition||"").replace("$value <= ","")),null!=g.validation.minDigits&&(v=(g.validation.minDigits.condition||"").replace("$value.toString().length >= ","")),null!=g.validation.maxDigits&&(y=(g.validation.maxDigits.condition||"").replace("$value.toString().length <= ",""))),o.minValue=b,o.maxValue=_,o.minDigits=v,o.maxDigits=y,r.push(ti),r.push(ni)}if(i.isFieldWithChoices(e.node)){var C=e.node,S=(C.triggerConditions||[]).map((function(i){return i.condition}));o.choicesOriginRef=C.choicesOriginRef,o.choicesFilter=null!=C.choicesFilter?C.choicesFilter.formula:null,o.forceExpanded=C.forceExpanded,o.forceNarrow=C.forceNarrow,o.triggerConditions=S,i._triggerConditions=S}var j=i._fb.group(o);return j.setValidators(r),i._conditionalBranches=e.node.conditionalBranches.map((function(i){return i.condition})),i._curVisibility=null!=e.node.visibility?e.node.visibility.condition:null,i._handleConditionalBranchesChange(j),i._handleVisibilityChange(j),i._handleFormulaRepsChange(j),i._handleChoicesFilterChange(j),i._handleFormulaChange(j),i._handleForceValueChange(j),i._handleValidationCondtionsChange(j),i._handleWarningCondtionsChange(j),i._handleNextSlideConditionChange(j),i._handleTriggerCondtionsChange(j),j})),O.publishReplay(1),O.refCount())},i.prototype._destroyConditionDialog=function(){null!=this._editConditionDialogSub&&(this._editConditionDialogSub.unsubscribe(),this._editConditionDialogSub=x.Subscription.EMPTY),null!=this._editConditionDialog&&(this._editConditionDialog.close(),this._editConditionDialog=null)},i.prototype._destroyValidationConditionDialog=function(){null!=this._editValidationConditionDialogSub&&(this._editValidationConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub=x.Subscription.EMPTY),null!=this._editValidationConditionDialog&&(this._editValidationConditionDialog.close(),this._editValidationConditionDialog=null)},i.prototype._destroyWarningConditionDialog=function(){null!=this._editWarningConditionDialogSub&&(this._editWarningConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub=x.Subscription.EMPTY),null!=this._editWarningConditionDialog&&(this._editWarningConditionDialog.close(),this._editWarningConditionDialog=null)},i.prototype._initRemoveTriggerCondition=function(){this._removeTriggerConditionSub=this._removeTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2),t=e[0],n=e[1];if(null!=n){var o=n.controls.triggerConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},i.prototype._initAddTriggerCondition=function(){this._addTriggerConditionSub=this._addTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2)[1];if(null!=e){var t=e.controls.triggerConditions,n=(t.value||[]).slice(0);n.push(""),t.setValue(n)}}))},i.prototype._initTriggerConditionEdit=function(){var i=this;this._editConditionDialogSub=x.Subscription.EMPTY,this._cdr.markForCheck(),this._editTriggerConditionSub=this._editTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2),n=t[0],o=t[1];i._destroyConditionDialog(),n<0||n>=i._triggerConditions.length||null==o||(i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=i._triggerConditions[n],i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&(i._triggerConditions[n]=e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()})))}))},i.prototype._initRemoveWarningCondition=function(){this._removeWarningConditionSub=this._removeWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2),t=e[0],n=e[1];if(null!=n){var o=n.controls.warningConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},i.prototype._initAddWarningCondition=function(){this._addWarningConditionSub=this._addWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2)[1];if(null!=e){var t=e.controls.warningConditions,n=(t.value||[]).slice(0);n.push({condition:"",errorMessage:""}),t.setValue(n)}}))},i.prototype._initWarningConditionEdit=function(){var i=this;this._editWarningConditionSub=this._editWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2),n=t[0],o=t[1];if(i._destroyWarningConditionDialog(),!(n<0||n>=i._warningConditions.length||null==o)){i._editWarningConditionDialog=i._dialog.open(ii);var r=i._editWarningConditionDialog.componentInstance,a=i._warningConditions[n];r.condition=a.condition,r.warningMessage=a.warningMessage,i._editWarningConditionDialogSub=i._editWarningConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&(i._warningConditions[n]=e),i._editWarningConditionDialogSub.unsubscribe(),i._editWarningConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initRemoveValidationCondition=function(){this._removeValidationConditionSub=this._removeValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2),t=e[0],n=e[1];if(null!=n){var o=n.controls.validationConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},i.prototype._initAddValidationCondition=function(){this._addValidationConditionSub=this._addValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var e=P(i,2)[1];if(null!=e){var t=e.controls.validationConditions,n=(t.value||[]).slice(0);n.push({condition:"",errorMessage:""}),t.setValue(n)}}))},i.prototype._initValidationConditionEdit=function(){var i=this;this._editValidationConditionSub=this._editValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2),n=t[0],o=t[1];if(i._destroyValidationConditionDialog(),!(n<0||n>=i._validationConditions.length||null==o)){i._editValidationConditionDialog=i._dialog.open(X);var r=i._editValidationConditionDialog.componentInstance,a=i._validationConditions[n];r.condition=a.condition,r.errorMessage=a.errorMessage,i._editValidationConditionDialogSub=i._editValidationConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&(i._validationConditions[n]=e),i._editValidationConditionDialogSub.unsubscribe(),i._editValidationConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initForceValueEdit=function(){var i=this;this._editForceValueSub=this._editForceValueEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.forceValue;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=n.value,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initNextSlideConditionEdit=function(){var i=this;this._editNextSlideConditionSub=this._editNextSlideConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.nextSlideCondition;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=n.value,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initFormulaEdit=function(){var i=this;this._editConditionDialogSub=x.Subscription.EMPTY,this._cdr.markForCheck(),this._editFormulaSub=this._editFormulaEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.formula;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=n.value,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initFormulaRepsEdit=function(){var i=this;this._editFormulaRepsSub=this._editFormulaRepsEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.formulaReps;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=n.value,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initChoicesFilterEdit=function(){var i=this;this._editChoicesFilterSub=this._editChoicesFilterEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.choicesFilter;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=n.value,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._initConditionalBranchEdit=function(){var i=this;this._editConditionalBranchSub=this._editConditionalBranchEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2),n=t[0],o=t[1];i._destroyConditionDialog(),n<0||n>=i._conditionalBranches.length||null==o||(i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=i._conditionalBranches[n],i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&(i._conditionalBranches[n]=e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()})))}))},i.prototype._initVisibilityEdit=function(){var i=this;this._editVisibilitySub=this._editVisibilityEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var t=P(e,2)[1];if(i._destroyConditionDialog(),null!=t){var n=t.controls.visibility,o=n.value;i._editConditionDialog=i._dialog.open(J),i._editConditionDialog.componentInstance.condition=o,i._editConditionDialogSub=i._editConditionDialog.afterClosed().subscribe((function(e){void 0!==e&&n.setValue(e),i._editConditionDialogSub.unsubscribe(),i._editConditionDialogSub=x.Subscription.EMPTY,i._cdr.markForCheck()}))}}))},i.prototype._handleTriggerCondtionsChange=function(i){var e=this;this._triggerConditionsSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return JSON.stringify(i.triggerConditions)===JSON.stringify(e.triggerConditions)}))).subscribe((function(i){e._triggerConditions=i.triggerConditions,e._cdr.markForCheck()}))},i.prototype._handleWarningCondtionsChange=function(i){var e=this;this._warningConditionsSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return JSON.stringify(i.warningConditions)===JSON.stringify(e.warningConditions)}))).subscribe((function(i){e._warningConditions=i.warningConditions,e._cdr.markForCheck()}))},i.prototype._handleValidationCondtionsChange=function(i){var e=this;this._validationConditionsSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return JSON.stringify(i.validationConditions)===JSON.stringify(e.validationConditions)}))).subscribe((function(i){e._validationConditions=i.validationConditions,e._cdr.markForCheck()}))},i.prototype._handleForceValueChange=function(i){var e=this;this._forceValueSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.forceValue===e.forceValue}))).subscribe((function(i){e._curForceValue=i.forceValue,e._cdr.markForCheck()}))},i.prototype._handleNextSlideConditionChange=function(i){var e=this;this._formulaSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.nextSlideCondition===e.nextSlideCondition}))).subscribe((function(i){e._nextSlideCondition=i.nextSlideCondition,e._cdr.markForCheck()})),this._formulaSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.nextSlideCondition===e.nextSlideCondition}))).subscribe((function(i){e._nextSlideCondition=i.nextSlideCondition,e._cdr.markForCheck()}))},i.prototype._handleFormulaChange=function(i){var e=this;this._formulaSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.formula===e.formula}))).subscribe((function(i){e._curFormula=i.formula,e._cdr.markForCheck()}))},i.prototype._handleFormulaRepsChange=function(i){var e=this;this._formulaRepsSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.formulaReps===e.formulaReps}))).subscribe((function(i){e._curFormulaReps=i.formulaReps,e._cdr.markForCheck()}))},i.prototype._handleChoicesFilterChange=function(i){var e=this;this._choicesFilterSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.choicesFilter===e.choicesFilter}))).subscribe((function(i){e._curChoicesFilter=i.choicesFilter,e._cdr.markForCheck()}))},i.prototype._handleConditionalBranchesChange=function(i){var e=this;this._conditionalBranchesSub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.conditionalBranchesNum===e.conditionalBranchesNum}))).subscribe((function(i){var t=i.conditionalBranchesNum,n=e._conditionalBranches.length;if(n<t){for(var o=[],r=n;r<t;r++)o.push(w.alwaysCondition().condition);e._conditionalBranches=e._conditionalBranches.concat(o)}else n>t&&e._conditionalBranches.splice(0,n-t);e._cdr.markForCheck()}))},i.prototype._handleVisibilityChange=function(i){var e=this;this._visibilitySub=i.valueChanges.pipe(O.distinctUntilChanged((function(i,e){return i.visibilityOpt===e.visibilityOpt}))).subscribe((function(t){var n;switch(t.visibilityOpt){case"always":n=w.alwaysCondition().condition;break;case"never":n=w.neverCondition().condition;break;default:n=null}e._curVisibility=n,i.controls.visibility.setValue(n)})),this._visibilitySub=i.valueChanges.pipe(O.filter((function(i){return"condition"===i.visibilityOpt})),O.distinctUntilChanged((function(i,e){return i.visibility===e.visibility}))).subscribe((function(i){e._curVisibility=i.visibility,e._cdr.markForCheck()}))},i.prototype._guessVisibilityOpt=function(i){return 0===i.condition.localeCompare(w.alwaysCondition().condition)?"always":0===i.condition.localeCompare(w.neverCondition().condition)?"never":"condition"},i}();oi.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-properties",template:'<div [style.display]="(enabled|async) ? \'none\' : \'block\'" class="ajf-disabled-overlay"></div>\n<div class="ajf-header">\n  <h3 translate>Properties</h3>\n  <mat-icon (click)="save()">save</mat-icon>\n  <mat-icon (click)="cancel()">cancel</mat-icon>\n</div>\n<ng-container *ngIf="nodeEntry|async as ne">\n  <ng-container *ngIf="propertiesForm|async as pf">\n    <form [formGroup]="pf!" novalidate>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <input matInput formControlName="name" [placeholder]="\'Name\' | translate">\n        </mat-form-field>\n      </div>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <input matInput formControlName="label" [placeholder]="\'Label\' | translate">\n        </mat-form-field>\n      </div>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <mat-label translate>Visibility</mat-label>\n          <mat-select\n              formControlName="visibilityOpt" [placeholder]="\'Visible\' | translate">\n            <mat-option value="always" translate>Always</mat-option>\n            <mat-option value="never" translate>Never</mat-option>\n            <mat-option value="condition" translate>Condition...</mat-option>\n          </mat-select>\n        </mat-form-field>\n        <button (click)="editVisibility()"\n            [disabled]="pf!.value.visibilityOpt != \'condition\'"\n            mat-raised-button [matTooltip]="curVisibility || \'\'">\n          <div class="ajf-icon-cont">\n            <mat-icon>edit</mat-icon>\n            <span>{{ curVisibility }}</span>\n          </div>\n        </button>\n      </div>\n      <div class="ajf-prop">\n        <div><label translate>Branches</label></div>\n        <div>\n          <mat-slider formControlName="conditionalBranchesNum"\n              thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n        </div>\n        <div *ngFor="let branch of conditionalBranches; let idx = index">\n          <button (click)="editConditionalBranch(idx)" mat-raised-button [matTooltip]="branch">\n            <div class="ajf-icon-cont">\n              <mat-icon>edit</mat-icon>\n              <span>{{ branch }}</span>\n            </div>\n          </button>\n        </div>\n      </div>\n      <ng-template [ngIf]="isRepeatingContainerNode(ne)">\n        <div class="ajf-prop">\n          <div><label translate>Repetitions</label></div>\n          <div>\n            <button (click)="editFormulaReps()" mat-raised-button [matTooltip]="curFormulaReps || \'\'">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curFormulaReps }}</span>\n              </div>\n            </button>\n          </div>\n          <div><label translate>Min repetitions</label></div>\n          <div>\n            <mat-slider formControlName="minReps"\n                thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n          </div>\n          <div><label translate>Max repetitions</label></div>\n          <div>\n            <mat-slider formControlName="maxReps"\n                thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n          </div>\n        </div>\n      </ng-template>\n      <ng-template [ngIf]="isField(ne)">\n        <div class="ajf-prop">\n          <mat-form-field>\n            <mat-label translate>Field size</mat-label>\n            <mat-select formControlName="size"\n                [placeholder]="\'Size\' | translate">\n              <mat-option *ngFor="let fieldSize of fieldSizes"\n                [value]="fieldSize.value">\n                {{ fieldSize.label }}\n              </mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <mat-form-field>\n            <textarea matInput formControlName="description"\n                [placeholder]="\'Description\' | translate"></textarea>\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <mat-form-field>\n            <input matInput formControlName="defaultValue"\n              [placeholder]="\'Default value\' | translate">\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <div><label translate>Formula</label></div>\n          <div>\n            <button (click)="editFormula()" mat-raised-button [matTooltip]="curFormula || \'\'">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curFormula }}</span>\n              </div>\n            </button>\n          </div>\n        </div>\n        \x3c!-- <div class="ajf-prop">\n          <div><label translate>Force value</label></div>\n          <div>\n            <button (click)="editForceValue()" mat-raised-button [matTooltip]="curForceValue">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curForceValue }}</span>\n              </div>\n            </button>\n          </div>\n        </div> --\x3e\n        <div class="ajf-prop">\n          <mat-checkbox formControlName="notEmpty" translate>Not empty</mat-checkbox>\n        </div>\n        <ng-template [ngIf]="isNumericField(ne!.node)">\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="minValue"\n                [placeholder]="\'Min value\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="maxValue"\n                [placeholder]="\'Max value\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="minDigits"\n                [placeholder]="\'Min digits\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="maxDigits"\n                [placeholder]="\'Max digits\' | translate">\n            </mat-form-field>\n          </div>\n        </ng-template>\n        <div class="ajf-prop">\n          <div class="ajf-header">\n            <label>{{ \'Validation\' | translate }}</label>\n            <mat-icon class="ajf-pointer" (click)="addValidationCondition()">add_circle_outline</mat-icon>\n          </div>\n          <div *ngIf="validationConditions == null || validationConditions.length == 0"\n              class="ajf-validation-row ajf-emph" translate>No conditions</div>\n          <div class="ajf-validation-row" *ngFor="let validationCondition of validationConditions; let idx = index">\n            <button (click)="editValidationCondition(idx)"\n                mat-raised-button [matTooltip]="validationCondition.condition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ validationCondition.condition }}</span>\n              </div>\n            </button>\n            <mat-icon class="ajf-pointer" (click)="removeValidationCondition(idx)">remove_circle_outline</mat-icon>\n          </div>\n        </div>\n        <div class="ajf-prop">\n          <mat-checkbox formControlName="notEmptyWarning" translate>Not empty warning</mat-checkbox>\n        </div>\n        <div class="ajf-prop">\n          <div class="ajf-header">\n            <label translate>Warnings</label>\n            <mat-icon class="ajf-pointer" (click)="addWarningCondition()">add_circle_outline</mat-icon>\n          </div>\n          <div  *ngIf="warningConditions == null || warningConditions.length == 0"\n              class="ajf-validation-row ajf-emph" translate>No warnings</div>\n          <div class="ajf-validation-row" *ngFor="let warningCondition of warningConditions; let idx = index">\n            <button (click)="editWarningCondition(idx)"\n                mat-raised-button [matTooltip]="warningCondition.condition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ warningCondition.condition }}</span>\n              </div>\n            </button>\n            <mat-icon class="ajf-pointer" (click)="removeWarningCondition(idx)">remove_circle_outline</mat-icon>\n          </div>\n        </div>\n        <div class="ajf-prop">\n          <div><label translate>Go to next slide condition</label></div>\n          <div>\n            <button (click)="editNextSlideCondition()" mat-raised-button [matTooltip]="nextSlideCondition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ nextSlideCondition }}</span>\n              </div>\n            </button>\n          </div>\n        </div>\n        <ng-template [ngIf]="isFieldWithChoices(ne!.node)">\n          <div class="ajf-prop">\n            <mat-form-field>\n              <mat-label translate>Choices origins</mat-label>\n              <mat-select formControlName="choicesOriginRef" [placeholder]="\'Choices\' | translate">\n                <mat-option *ngFor="let choicesOrigin of choicesOrigins" [value]="choicesOrigin.name">\n                  {{ choicesOrigin.label || choicesOrigin.name }}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <div><label translate>Choices filter</label></div>\n            <div>\n              <button (click)="editChoicesFilter()" mat-raised-button [matTooltip]="curChoicesFilter">\n                <div class="ajf-icon-cont">\n                  <mat-icon>edit</mat-icon>\n                  <span>{{ curChoicesFilter }}</span>\n                </div>\n              </button>\n            </div>\n          </div>\n          <div class="ajf-prop">\n            <mat-checkbox formControlName="forceExpanded" translate>Force expanded selection</mat-checkbox>\n          </div>\n          <div class="ajf-prop">\n            <mat-checkbox formControlName="forceNarrow" translate>Force narrow selection</mat-checkbox>\n          </div>\n          <div class="ajf-prop">\n            <div class="ajf-header">\n              <label translate>Trigger selection</label>\n              <mat-icon class="ajf-pointer" (click)="addTriggerCondition()">add_circle_outline</mat-icon>\n            </div>\n            <div *ngIf="triggerConditions == null || triggerConditions.length == 0"\n                class="ajf-validation-row ajf-emph" translate>No trigger condition </div>\n            <div class="ajf-validation-row" *ngFor="let triggerCondition of triggerConditions; let idx = index">\n              <button (click)="editTriggerCondition(idx)"\n                  mat-raised-button [matTooltip]="triggerCondition">\n                <div class="ajf-icon-cont">\n                  <mat-icon>edit</mat-icon>\n                  <span>{{ triggerCondition }}</span>\n                </div>\n              </button>\n              <mat-icon class="pointer" (click)="removeTriggerCondition(idx)">remove_circle_outline</mat-icon>\n            </div>\n          </div>\n        </ng-template>\n      </ng-template>\n    </form>\n  </ng-container>\n</ng-container>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-properties{display:block;padding:1em;position:relative}ajf-fb-node-properties mat-icon{cursor:pointer}ajf-fb-node-properties .ajf-header{display:flex;flex-direction:row;align-items:center;flex-wrap:nowrap}ajf-fb-node-properties .ajf-header>h3,ajf-fb-node-properties .ajf-header>label{flex:1 0 auto;margin-right:.5em}ajf-fb-node-properties .ajf-header>mat-icon{flex:0 0 auto;margin-left:.5em}ajf-fb-node-properties .ajf-disabled-overlay{position:absolute;top:0;right:0;bottom:0;left:0;opacity:.4;background-color:#fff}ajf-fb-node-properties .ajf-emph{font-style:italic}ajf-fb-node-properties [mat-raised-button]{margin:.5em 0}ajf-fb-node-properties [mat-raised-button].ajf-pointer{cursor:pointer}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont{display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont span{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;display:block;min-height:36px}ajf-fb-node-properties .ajf-validation-row{margin:.5em 0;display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties .ajf-validation-row button{flex:1 1 auto}ajf-fb-node-properties .ajf-validation-row mat-icon{flex:0 0 auto}ajf-fb-node-properties .ajf-prop{margin:.5em 0}ajf-fb-node-properties mat-form-field,ajf-fb-node-properties mat-slider,ajf-fb-node-properties [mat-raised-button]{width:100%}\n"]}]}],oi.ctorParameters=function(){return[{type:r.ChangeDetectorRef},{type:z},{type:p.MatDialog},{type:a.FormBuilder}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var ri,ai=function(){function i(i){this._cdr=i}return Object.defineProperty(i.prototype,"nodeType",{get:function(){return this._nodeType},set:function(i){this._nodeType=i,this._cdr.markForCheck()},enumerable:!1,configurable:!0}),i}();ai.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-type-entry",template:'<ng-container *ngIf="nodeType">\n  <mat-icon\n    [fontSet]="nodeType.icon.fontSet" [fontIcon]="nodeType.icon.fontIcon"></mat-icon>\n  {{ nodeType.label }}\n</ng-container>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-type-entry{display:block;padding:1em 1.5em}ajf-fb-node-type-entry mat-icon{vertical-align:middle}\n"]}]}],ai.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},ai.propDecorators={nodeType:[{type:r.Input}]},(ri=function ri(){}).decorators=[{type:r.NgModule,args:[{imports:[e.AjfMonacoEditorModule,t.AjfNodeIconModule,o.CommonModule,n.DragDropModule,a.FormsModule,s.MatAutocompleteModule,l.MatButtonModule,d.MatCardModule,c.MatCheckboxModule,u.MatChipsModule,p.MatDialogModule,f.MatFormFieldModule,h.MatIconModule,m.MatInputModule,g.MatListModule,b.MatMenuModule,_.MatSelectModule,v.MatSidenavModule,y.MatSliderModule,C.MatTableModule,S.MatToolbarModule,j.MatTooltipModule,a.ReactiveFormsModule,E.TranslateModule],declarations:[V,R,H,$,J,Q,oi,ai,Z,X,ii,G],exports:[G],providers:[z]}]}],
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
i.AjfFormBuilder=G,i.AjfFormBuilderModule=ri,i.AjfFormBuilderService=z,i.flattenNodes=W,i.gc_ajf_src_material_form_builder_form_builder_a=V,i.gc_ajf_src_material_form_builder_form_builder_b=R,i.gc_ajf_src_material_form_builder_form_builder_c=H,i.gc_ajf_src_material_form_builder_form_builder_d=$,i.gc_ajf_src_material_form_builder_form_builder_e=J,i.gc_ajf_src_material_form_builder_form_builder_f=Q,i.gc_ajf_src_material_form_builder_form_builder_g=oi,i.gc_ajf_src_material_form_builder_form_builder_h=ai,i.gc_ajf_src_material_form_builder_form_builder_i=Z,i.gc_ajf_src_material_form_builder_form_builder_j=X,i.gc_ajf_src_material_form_builder_form_builder_k=ii,Object.defineProperty(i,"__esModule",{value:!0})}));