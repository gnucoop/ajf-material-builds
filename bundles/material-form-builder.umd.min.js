!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@ajf/material/monaco-editor"),require("@ajf/material/node-icon"),require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/material/autocomplete"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/checkbox"),require("@angular/material/chips"),require("@angular/material/dialog"),require("@angular/material/expansion"),require("@angular/material/form-field"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/list"),require("@angular/material/menu"),require("@angular/material/select"),require("@angular/material/sidenav"),require("@angular/material/slide-toggle"),require("@angular/material/slider"),require("@angular/material/table"),require("@angular/material/toolbar"),require("@angular/material/tooltip"),require("@ngx-translate/core"),require("@ajf/core/forms"),require("@angular/cdk/collections"),require("rxjs"),require("rxjs/operators"),require("@ajf/core/models"),require("@ajf/core/utils"),require("@angular/cdk/keycodes")):"function"==typeof define&&define.amd?define("@ajf/material/form-builder",["exports","@ajf/material/monaco-editor","@ajf/material/node-icon","@angular/cdk/drag-drop","@angular/common","@angular/core","@angular/forms","@angular/material/autocomplete","@angular/material/button","@angular/material/card","@angular/material/checkbox","@angular/material/chips","@angular/material/dialog","@angular/material/expansion","@angular/material/form-field","@angular/material/icon","@angular/material/input","@angular/material/list","@angular/material/menu","@angular/material/select","@angular/material/sidenav","@angular/material/slide-toggle","@angular/material/slider","@angular/material/table","@angular/material/toolbar","@angular/material/tooltip","@ngx-translate/core","@ajf/core/forms","@angular/cdk/collections","rxjs","rxjs/operators","@ajf/core/models","@ajf/core/utils","@angular/cdk/keycodes"],i):i(((e=e||self).ajf=e.ajf||{},e.ajf.material=e.ajf.material||{},e.ajf.material.formBuilder={}),e.ajf.material.monacoEditor,e.ajf.material.nodeIcon,e.ng.cdk.dragDrop,e.ng.common,e.ng.core,e.ng.forms,e.ng.material.autocomplete,e.ng.material.button,e.ng.material.card,e.ng.material.checkbox,e.ng.material.chips,e.ng.material.dialog,e.ng.material.expansionPanel,e.ng.material.formField,e.ng.material.icon,e.ng.material.input,e.ng.material.list,e.ng.material.menu,e.ng.material.select,e.ng.material.sidenav,e.ng.material.slideToggle,e.ng.material.slider,e.ng.material.table,e.ng.material.toolbar,e.ng.material.tooltip,e.ngxTranslate.core,e.ajf.core.forms,e.ng.cdk.collections,e.rxjs,e.rxjs.operators,e.ajf.core.models,e.ajf.core.utils,e.ng.cdk.keycodes)}(this,(function(e,i,t,n,o,r,a,s,l,d,c,u,p,f,h,m,g,b,_,v,y,C,j,S,E,x,D,F,N,T,O,w,V,M){"use strict";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var P=function(){function e(e,i){this._el=e,this._renderer=i,this._offset=0,this._height=0}return Object.defineProperty(e.prototype,"offset",{set:function(e){this._offset=e,this._updateOffset()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{set:function(e){this._color=e,this._updateColor()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{set:function(e){this._height=e,this._updateHeight()},enumerable:!1,configurable:!0}),e.prototype._updateHeight=function(){var e=Math.max(0,this._height-25)+"px";this._renderer.setStyle(this._el.nativeElement,"height",e)},e.prototype._updateOffset=function(){var e=4*this._offset+"px";this._renderer.setStyle(this._el.nativeElement,"margin-top",e),this._renderer.setStyle(this._el.nativeElement,"margin-left",e)},e.prototype._updateColor=function(){this._renderer.setStyle(this._el.nativeElement,"border-color",this._color)},e}();P.decorators=[{type:r.Component,args:[{selector:"ajf-fb-branch-line",template:"",encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-branch-line{display:block;position:absolute;top:25px;left:25px;width:25px;border-top:2px solid;border-left:2px solid;border-top-left-radius:6px;transition:height .5s ease-in-out}\n"]}]}],P.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer2}]},P.propDecorators={offset:[{type:r.Input}],color:[{type:r.Input}],height:[{type:r.Input}]};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var I=function(e,i){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])})(e,i)};function k(e,i){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,o,r=t.call(e),a=[];try{for(;(void 0===i||i-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a}function A(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(k(arguments[i]));return e}var R=function(e){function i(){var i=e.call(this)||this;return i._choices=new T.BehaviorSubject([]),i._choicesObs=i._choices,i}return function t(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=e}I(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}(i,e),i.prototype.connect=function(){return this._choicesObs},i.prototype.disconnect=function(){},i.prototype.updateChoices=function(e){this._choices.next(e)},i}(N.DataSource),L=function(){function e(){this._displayedColumns=["label","value","delete"],this.editing={},this._choices=new R,this._choicesArr=[]}return Object.defineProperty(e.prototype,"displayedColumns",{get:function(){return this._displayedColumns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},set:function(e){this._choicesOrigin=e,this.name=e.name,this.label=e.label,this.canEditChoices=F.isChoicesFixedOrigin(e),this._choicesArr=e.choices,this._choices.updateChoices(this._choicesArr)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choices",{get:function(){return this._choices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choicesArr",{get:function(){return this._choicesArr},enumerable:!1,configurable:!0}),e.prototype.updateValue=function(e,i,t,n){this.editing[n+"-"+i]=!1,this._choicesArr[n][i]=e.target.value,this._choices.updateChoices(this._choicesArr)},e.prototype.deleteRow=function(e){this._choicesArr.splice(e,1),this._choices.updateChoices(this._choicesArr)},e.prototype.addRow=function(){this._choicesArr.push({label:"",value:""}),this._choices.updateChoices(this._choicesArr)},e}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function B(e,i){if(e.nodes.indexOf(i)>-1)return e;for(var t=e.nodes.filter((function(e){return F.isContainerNode(e)})),n=t.length,o=0;o<n;o++){var r=B(t[o],i);if(null!=r)return r}return null}function W(e,i,t){void 0===t&&(t=!1);var n=e.filter((function(e){return e.parent===i.id})).sort((function(e,i){return e.parentNode-i.parentNode})).map((function(i){var t=W(e,i);return 0===t.length&&t.push({parent:i,parentNode:0}),{node:i,children:t,content:Y(0,i)}}));if(!t)for(var o=i.conditionalBranches.length,r=n.length;r<o;r++)n.push({parent:i,parentNode:r});return n}function Y(e,i){return F.isContainerNode(i)?W(i.nodes,i,!0):[]}function U(e){var i=[];return e.forEach((function(e){F.isContainerNode(e)&&(i=i.concat(U(e.nodes))),i.push(e)})),i}function q(e,i,t){return void 0===t&&(t=null),e.filter(null!=t?function(e){return e.parent===i.id&&e.parentNode===t}:function(e){return e.parent===i.id})}function z(e,i,t){void 0===t&&(t=null);for(var n=U(e),o=[],r=q(n,i,t),a=r.length,s=0;s<a;s++)o=o.concat(q(n,r[s]));return function e(i,t){for(var n=i.length,o=0;o<n;o++){var r=i[o];F.isContainerNode(r)&&(r.nodes=e(r.nodes,t))}return i.filter((function(e){return-1===t.indexOf(e.id)}))}(e,(o=o.concat(r)).map((function(e){return e.id})))}L.decorators=[{type:r.Component,args:[{selector:"ajf-fb-choices-origin-editor",template:'<div>\n  <mat-form-field>\n    <input matInput [(ngModel)]="name"\n        [placeholder]="\'Name\' | translate">\n  </mat-form-field>\n  <mat-form-field>\n    <input matInput [(ngModel)]="label"\n        [placeholder]="\'Label\' | translate">\n  </mat-form-field>\n  <ng-template [ngIf]="canEditChoices">\n    <button (click)="addRow()" mat-button>\n      <mat-icon>add</mat-icon>\n      <span translate>Add value</span>\n    </button>\n    <mat-table [dataSource]="choices">\n      <ng-container matColumnDef="label">\n        <mat-header-cell *matHeaderCellDef translate>Label</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n          <input matInput [(ngModel)]="row.label" type="text">\n        </mat-cell>\n      </ng-container>\n      <ng-container matColumnDef="value">\n        <mat-header-cell *matHeaderCellDef translate>Value</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n          <input matInput [(ngModel)]="row.value" type="text">\n        </mat-cell>\n      </ng-container>\n      <ng-container matColumnDef="delete">\n        <mat-header-cell *matHeaderCellDef translate>Delete</mat-header-cell>\n        <mat-cell *matCellDef="let row; let idx = index">\n            <mat-icon (click)="deleteRow(idx)">delete</mat-icon>\n        </mat-cell>\n      </ng-container>\n\n      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\n      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\n    </mat-table>\n  </ng-template>\n</div>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-choices-origin-editor mat-form-field+mat-form-field{margin-left:1em}ajf-fb-choices-origin-editor mat-table{max-height:300px}ajf-fb-choices-origin-editor mat-table mat-icon{cursor:pointer}\n"]}]}],L.propDecorators={choicesOrigin:[{type:r.Input}]};var H=0,$=function(){function e(){this._availableNodeTypes=[{label:"Slide",icon:{fontSet:"ajf-icon",fontIcon:"field-slide"},nodeType:{node:F.AjfNodeType.AjfSlide},isSlide:!0},{label:"Repeating slide",icon:{fontSet:"ajf-icon",fontIcon:"field-repeatingslide"},nodeType:{node:F.AjfNodeType.AjfRepeatingSlide},isSlide:!0},{label:"String",icon:{fontSet:"ajf-icon",fontIcon:"field-string"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.String}},{label:"Text",icon:{fontSet:"ajf-icon",fontIcon:"field-text"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Text}},{label:"Number",icon:{fontSet:"ajf-icon",fontIcon:"field-number"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Number}},{label:"Boolean",icon:{fontSet:"ajf-icon",fontIcon:"field-boolean"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Boolean}},{label:"Single choice",icon:{fontSet:"ajf-icon",fontIcon:"field-singlechoice"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.SingleChoice}},{label:"Multiple choice",icon:{fontSet:"ajf-icon",fontIcon:"field-multiplechoice"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.MultipleChoice}},{label:"Formula",icon:{fontSet:"ajf-icon",fontIcon:"field-formula"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Formula}},{label:"Date",icon:{fontSet:"ajf-icon",fontIcon:"field-date"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Date}},{label:"Date input",icon:{fontSet:"ajf-icon",fontIcon:"field-dateinput"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.DateInput}},{label:"Time",icon:{fontSet:"ajf-icon",fontIcon:"field-time"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Time}},{label:"Table",icon:{fontSet:"ajf-icon",fontIcon:"field-table"},nodeType:{node:F.AjfNodeType.AjfField,field:F.AjfFieldType.Table}}],this._form=new T.BehaviorSubject(null),this._formObs=this._form,this._connectedDropLists=new T.BehaviorSubject([]),this._editedNodeEntry=new T.BehaviorSubject(null),this._editedNodeEntryObs=this._editedNodeEntry,this._editedCondition=new T.BehaviorSubject(null),this._editedConditionObs=this._editedCondition,this._editedChoicesOrigin=new T.BehaviorSubject(null),this._editedChoicesOriginObs=this._editedChoicesOrigin,this._beforeNodesUpdate=new r.EventEmitter,this._beforeNodesUpdateObs=this._beforeNodesUpdate,this._afterNodeUpdate=new r.EventEmitter,this._afterNodeUpdateObs=this._afterNodeUpdate,this._nodesUpdates=new T.Subject,this._attachmentsOriginsUpdates=new T.Subject,this._choicesOriginsUpdates=new T.Subject,this._stringIdentifierUpdates=new T.Subject,this._saveNodeEntryEvent=new r.EventEmitter,this._deleteNodeEntryEvent=new r.EventEmitter,this._moveNodeEntryEvent=new r.EventEmitter,this._moveNodeSub=T.Subscription.EMPTY,this._initChoicesOriginsStreams(),this._initAttachmentsOriginsStreams(),this._initStringIdentifierStreams(),this._initNodesStreams(),this._initFormStreams(),this._initSaveNode(),this._initMoveNode(),this._initDeleteNode()}return Object.defineProperty(e.prototype,"availableNodeTypes",{get:function(){return this._availableNodeTypes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"form",{get:function(){return this._formObs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachmentsOrigins",{get:function(){return this._attachmentsOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stringIdentifier",{get:function(){return this._stringIdentifier},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"flatNodes",{get:function(){return this._flatNodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"flatFields",{get:function(){return this._flatFields},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectedDropLists",{get:function(){return this._connectedDropLists},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editedNodeEntry",{get:function(){return this._editedNodeEntryObs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editedCondition",{get:function(){return this._editedConditionObs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editedChoicesOrigin",{get:function(){return this._editedChoicesOriginObs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeNodesUpdate",{get:function(){return this._beforeNodesUpdateObs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"afterNodeUpdate",{get:function(){return this._afterNodeUpdateObs},enumerable:!1,configurable:!0}),e.prototype.setForm=function(e){e!==this._form.getValue()&&this._form.next(e)},e.prototype.editNodeEntry=function(e){this._editedNodeEntry.next(e)},e.prototype.editCondition=function(e){this._editedCondition.next(e)},e.prototype.saveCurrentCondition=function(e){var i=this._editedCondition.getValue();null!=i&&(i.condition=e,this._editedCondition.next(null))},e.prototype.cancelConditionEdit=function(){this._editedChoicesOrigin.next(null)},e.prototype.assignListId=function(e,i){if(void 0===i&&(i=!1),e.nodeType===F.AjfNodeType.AjfSlide||e.nodeType===F.AjfNodeType.AjfRepeatingSlide){var t=i?"empty_fields_list_"+e.id:"fields_list_"+e.id;return-1==this._connectedDropLists.value.indexOf(t)&&this._connectDropList(t),t}return""},e.prototype.insertNode=function(e,i,t,n,o){var r,a,s=this;void 0===n&&(n=!1),void 0===o&&(o=0);var l=++H,d=null!=(null===(r=e.nodeType)||void 0===r?void 0:r.field);a=d?F.createField({id:l,nodeType:F.AjfNodeType.AjfField,fieldType:e.nodeType.field,parent:i.id,parentNode:t,name:""}):F.createContainerNode({id:l,nodeType:e.nodeType.node,parent:0,parentNode:t,name:"",nodes:[]}),this._beforeNodesUpdate.emit(),this._nodesUpdates.next((function(e){var t,r=F.isContainerNode(i)&&n?i:B({nodes:e},i);return d?((t=r.nodes.slice(0)).splice(o,0,a),t=s._updateNodesList(r.id,t),r.nodes=t,e):((t=e.slice(0)).splice(o,0,a),t=s._updateNodesList(0,t))}))},e.prototype.saveNodeEntry=function(e){this._saveNodeEntryEvent.emit(e)},e.prototype.cancelNodeEntryEdit=function(){this._editedNodeEntry.next(null)},e.prototype.deleteNodeEntry=function(e){this._deleteNodeEntryEvent.next(e)},e.prototype.moveNodeEntry=function(e,i,t){this._moveNodeEntryEvent.next({nodeEntry:e,fromIndex:i,toIndex:t})},e.prototype.getCurrentForm=function(){return T.combineLatest([this.form,this._nodesWithoutChoiceOrigins,this.attachmentsOrigins,this.choicesOrigins,this.stringIdentifier]).pipe(O.filter((function(e){return null!=k(e,1)[0]})),O.map((function(e){var i=k(e,5),t=i[0],n=i[1],o=i[2],r=i[4];return F.createForm({choicesOrigins:i[3].slice(0),attachmentsOrigins:o.slice(0),stringIdentifier:(r||[]).slice(0),nodes:n.slice(0),supplementaryInformations:t.supplementaryInformations})})))},e.prototype.editChoicesOrigin=function(e){this._editedChoicesOrigin.next(e)},e.prototype.createChoicesOrigin=function(){this._editedChoicesOrigin.next(F.createChoicesFixedOrigin({name:""}))},e.prototype.cancelChoicesOriginEdit=function(){this._editedChoicesOrigin.next(null)},e.prototype.saveChoicesOrigin=function(e){var i=this._editedChoicesOrigin.getValue();null!=i&&(i.label=e.label,i.name=e.name,F.isChoicesFixedOrigin(i)&&(i.choices=e.choices),this._choicesOriginsUpdates.next((function(e){var t=e.indexOf(i);return t>-1?A(e.slice(0,t),[i],e.slice(t+1)):A(e,[i])}))),this._editedChoicesOrigin.next(null)},e.prototype.saveStringIdentifier=function(e){this._stringIdentifierUpdates.next((function(){return A(e)}))},e.prototype._buildFormBuilderNodesTree=function(e){this._updateNodesList(0,e);var i=e.filter((function(e){return e.nodeType==F.AjfNodeType.AjfSlide||e.nodeType==F.AjfNodeType.AjfRepeatingSlide}));if(0===i.length)return[null];var t=i[0];if(F.isSlidesNode(t)){var n=[];return n.push({node:t,container:null,children:W(e,t),content:Y(0,t)}),n}throw new Error("Invalid form definition")},e.prototype._connectDropList=function(e){var i=this._connectedDropLists.value.slice(0);this._connectedDropLists.next(A(i,[e]))},e.prototype._findMaxNodeId=function(e,i){var t=this;void 0===i&&(i=0);var n=0;return e.forEach((function(e){n=Math.max(n,e.id),F.isContainerNode(e)&&(n=Math.max(n,t._findMaxNodeId(e.nodes)))})),n},e.prototype._initFormStreams=function(){var e=this;this._form.subscribe((function(i){H=0,null!=i&&null!=i.nodes&&i.nodes.length>0&&(H=e._findMaxNodeId(i.nodes)),e._nodesUpdates.next((function(e){return null!=i&&null!=i.nodes?i.nodes.slice(0):[]})),e._attachmentsOriginsUpdates.next((function(e){return null!=i&&null!=i.attachmentsOrigins?i.attachmentsOrigins.slice(0):[]})),e._choicesOriginsUpdates.next((function(e){return null!=i&&null!=i.choicesOrigins?i.choicesOrigins.slice(0):[]})),e._stringIdentifierUpdates.next((function(e){return null!=i&&null!=i.stringIdentifier?i.stringIdentifier.slice(0):[]}))}))},e.prototype._initChoicesOriginsStreams=function(){this._choicesOrigins=this._choicesOriginsUpdates.pipe(O.scan((function(e,i){return i(e)}),[]),O.publishReplay(1),O.refCount())},e.prototype._initAttachmentsOriginsStreams=function(){this._attachmentsOrigins=this._attachmentsOriginsUpdates.pipe(O.scan((function(e,i){return i(e)}),[]),O.publishReplay(1),O.refCount())},e.prototype._initStringIdentifierStreams=function(){this._stringIdentifier=this._stringIdentifierUpdates.pipe(O.scan((function(e,i){return i(e)}),[]),O.publishReplay(1),O.refCount())},e.prototype._initNodesStreams=function(){var e=this;this._nodes=this._nodesUpdates.pipe(O.scan((function(e,i){return i(e)}),[]),O.publishReplay(1),O.refCount()),this._nodesWithoutChoiceOrigins=this._nodes.pipe(O.map((function(e){return e.map((function(e){return e.nodes=e.nodes.map((function(e){if(F.isFieldWithChoices(e)){var i=V.deepCopy(e);return i&&i.choices&&delete i.choices,i&&i.choicesOrigin&&delete i.choicesOrigin,i}return e})),e}))}))),this._flatNodes=this._nodes.pipe(O.map((function(e){return U(e)})),O.publishReplay(1),O.refCount()),this._flatFields=this._flatNodes.pipe(O.map((function(e){return e.filter((function(e){return!F.isContainerNode(e)}))})),O.publishReplay(1),O.refCount()),this._nodeEntriesTree=this._nodes.pipe(O.map((function(i){return e._buildFormBuilderNodesTree(i)})),O.publishReplay(1),O.refCount())},e.prototype._initSaveNode=function(){var e=this;this._saveNodeEntryEvent.pipe(O.withLatestFrom(this.editedNodeEntry,this.choicesOrigins,this.attachmentsOrigins),O.filter((function(e){return null!=k(e,2)[1]})),O.map((function(i){var t=k(i,2),n=t[0],o=t[1];e._beforeNodesUpdate.emit();var r=o,a=r.node,s=V.deepCopy(a);s.id=r.node.id,s.name=n.name,s.label=n.label,s.visibility=null!=n.visibility?w.createCondition({condition:n.visibility}):null;var l=s.conditionalBranches.length;s.conditionalBranches=null!=n.conditionalBranches?n.conditionalBranches.map((function(e){return w.createCondition({condition:e})})):[w.alwaysCondition()];var d=s.conditionalBranches.length;if(F.isRepeatingContainerNode(s)){var c=s;c.formulaReps=null!=n.formulaReps?w.createFormula({formula:n.formulaReps}):void 0,c.minReps=n.minReps,c.maxReps=n.maxReps}if(F.isField(s)){var u=s;u.description=n.description,u.defaultValue=n.defaultValue,u.formula=null!=n.formula?w.createFormula({formula:n.formula}):void 0;var p=n.value,f=n.notEmpty,h=n.validationConditions,m=parseInt(n.minValue,10),g=parseInt(n.maxValue,10),b=parseInt(n.minDigits,10),_=parseInt(n.maxDigits,10);if(isNaN(m)&&(m=null),isNaN(g)&&(g=null),isNaN(b)&&(b=null),isNaN(_)&&(_=null),null!=p||null!=f||null!=h&&h.length>0||null!=m||null!=g||null!=b||null!=_){var v=u.validation||F.createValidationGroup({});v.forceValue=p,v.notEmpty=f?F.notEmptyValidation():void 0,v.minValue=null!=m?F.minValidation(m):void 0,v.maxValue=null!=g?F.maxValidation(g):void 0,v.minDigits=null!=b?F.minDigitsValidation(b):void 0,v.maxDigits=null!=_?F.maxDigitsValidation(_):void 0,v.conditions=(h||[]).map((function(e){return F.createValidation({condition:e.condition,errorMessage:e.errorMessage})})),u.validation=v}else u.validation=void 0;var y=n.notEmptyWarning,C=n.warningConditions;if(null!=y||null!=C&&C.length>0){var j=u.warning||F.createWarningGroup({});j.notEmpty=y?F.notEmptyWarning():void 0,j.conditions=(C||[]).map((function(e){return F.createWarning({condition:e.condition,warningMessage:e.warningMessage})})),u.warning=j}else u.warning=void 0;if(u.nextSlideCondition=null!=n.nextSlideCondition?w.createCondition({condition:n.nextSlideCondition}):void 0,u.size=n.size,u.defaultValue=n.defaultValue,F.isFieldWithChoices(u)){var S=u;S.choicesOriginRef=n.choicesOriginRef,S.forceExpanded=n.forceExpanded,S.forceNarrow=n.forceNarrow,S.triggerConditions=(n.triggerConditions||[]).map((function(e){return w.createCondition({condition:e})}))}}return e._editedNodeEntry.next(null),function(e){var i=B({nodes:e},a);if(null!=i){var t=i.nodes===e,n=i.nodes.indexOf(a),o=i.nodes.slice(0,n);if(o.push(s),o=o.concat(i.nodes.slice(n+1)),i.nodes=o,e=t?o:e.slice(0),d<l)for(var r=d;r<l;r++)e=z(e,s,r)}return e}}))).subscribe(this._nodesUpdates)},e.prototype._initDeleteNode=function(){var e=this;this._deleteNodeEntryEvent.pipe(O.map((function(i){return e._beforeNodesUpdate.emit(),function(e){var t=i.node,n=B({nodes:e},t);if(null!=n){var o=n.nodes===e,r=n.nodes.indexOf(t),a=n.nodes.slice(0,r);a=a.concat(n.nodes.slice(r+1)),n.nodes=a,e=o?a:e.slice(0)}return e}}))).subscribe(this._nodesUpdates)},e.prototype._initMoveNode=function(){var e=this;this._moveNodeSub.unsubscribe(),this._moveNodeSub=this._moveNodeEntryEvent.pipe(O.map((function(i){return e._beforeNodesUpdate.emit(),function(t){var o=B({nodes:t},i.nodeEntry.node),r=t;if(null!=o){var a=o.nodes===t;n.moveItemInArray(r=o.nodes,i.fromIndex,i.toIndex),r=e._updateNodesList(o.id,r),o.nodes=r,t=a?r:t.slice(0)}return t}}))).subscribe(this._nodesUpdates)},e.prototype._updateNodesList=function(e,i){if(!i.length)return[];for(var t=null!=e?e:0,n=0;n<i.length;n++){var o=i[n];o.id=1e3*t+n+1,o.parent=0==n?t:1e3*t+n,(o.nodeType==F.AjfNodeType.AjfSlide||o.nodeType==F.AjfNodeType.AjfRepeatingSlide)&&o.nodes&&this._updateNodesList(o.id,o.nodes)}return i},e}();$.decorators=[{type:r.Injectable}],$.ctorParameters=function(){return[]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var G=function(){function e(e){this._service=e,this._choicesOrigin=this._service.editedChoicesOrigin.pipe(O.filter((function(e){return null!=e})),O.map((function(e){return e})))}return Object.defineProperty(e.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},enumerable:!1,configurable:!0}),e.prototype.saveChoicesOrigin=function(){this._service.saveChoicesOrigin({label:this.editor.label,name:this.editor.name,choices:this.editor.choicesArr})},e.prototype.cancelChoicesOriginEdit=function(){this._service.cancelChoicesOriginEdit()},e}();G.decorators=[{type:r.Component,args:[{selector:"ajf-fb-choices-origin-editor-dialog",template:'<h3 matDialogTitle translate>Edit choices origin</h3>\n<mat-dialog-content>\n  <ajf-fb-choices-origin-editor\n      *ngIf="choicesOrigin|async as co"\n      [choicesOrigin]="co!"></ajf-fb-choices-origin-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveChoicesOrigin()">Save</button>\n  <button mat-button translate (click)="cancelChoicesOriginEdit()">Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["\n"]}]}],G.ctorParameters=function(){return[{type:$}]},G.propDecorators={editor:[{type:r.ViewChild,args:[L,{static:!1}]}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var J=function(){function e(e){}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields},set:function(e){this._fields=e,this._updateVariables()},enumerable:!1,configurable:!0}),e.prototype.insertVariable=function(e){if(null!=this.monacoEditor&&null!=this.monacoEditor.editor){var i=this.monacoEditor.editor,t=i.getValue().split("\n"),n=i.getPosition(),o=n.lineNumber-1,r=t[o],a=n.column-1;r=r.substring(0,a)+e+r.substring(a),t[o]=r,n.column+=e.length,this.monacoEditor.value=t.join("\n"),i.setPosition(n),i.focus(),this.editedValue=i.getValue()}},e.prototype.onEditorInit=function(){monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES2015,allowNonTsExtensions:!0,allowJs:!0,module:monaco.languages.typescript.ModuleKind.None});try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-variables.d.ts")}catch(e){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=""}try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-functions.d.ts")}catch(e){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=""}this._updateVariables(),this._updateFunctions()},e.prototype._updateVariables=function(){var e=this;if(null!=this._fields)try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=this._fields.map((function(i){return"declare const "+i.name+": "+e._fieldVarType(i.fieldType)+";"})).join("\n")}catch(e){}},e.prototype._updateFunctions=function(){try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=w.AjfExpressionUtils.UTIL_FUNCTIONS}catch(e){}},e.prototype._fieldVarType=function(e){switch(e){case F.AjfFieldType.Boolean:return"boolean";case F.AjfFieldType.Date:case F.AjfFieldType.DateInput:case F.AjfFieldType.Time:return"Date";case F.AjfFieldType.Empty:return"void";case F.AjfFieldType.Formula:return"number";case F.AjfFieldType.MultipleChoice:case F.AjfFieldType.SingleChoice:return"any";case F.AjfFieldType.Number:return"number";case F.AjfFieldType.Table:return"Array";case F.AjfFieldType.String:case F.AjfFieldType.Text:return"string"}return null},e}();J.decorators=[{type:r.Component,args:[{selector:"ajf-condition-editor",template:'<div class="ajf-editor">\n  <ajf-monaco-editor\n      (init)="onEditorInit()"\n      (valueChange)="editedValue = $event"\n      [value]="condition" language="javascript"></ajf-monaco-editor>\n</div>\n<div class="ajf-editor-panel">\n  <ng-container *ngIf="fields as curFields">\n    <mat-nav-list dense *ngIf="curFields!.length > 0">\n      <a mat-list-item\n          (click)="insertVariable(field.name)"\n          [matTooltip]="field.label"\n          *ngFor="let field of curFields!">\n        <ajf-node-icon [node]="field"></ajf-node-icon>\n        {{ field.name }}\n      </a>\n    </mat-nav-list>\n  </ng-container>\n</div>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["ajf-condition-editor{display:flex;flex-direction:row;align-items:stretch;max-height:512px}ajf-condition-editor .ajf-editor{flex:.75 0 auto;display:flex;flex-direction:row;align-items:stretch}ajf-condition-editor .ajf-editor monaco-editor{flex:1 0 auto;min-width:512px;min-height:256px}ajf-condition-editor .ajf-editor-panel{flex:.25 0 auto;overflow-y:auto}ajf-condition-editor ajf-monaco-editor{min-width:400px}\n"]}]}],J.ctorParameters=function(){return[{type:F.AjfValidationService}]},J.propDecorators={monacoEditor:[{type:r.ViewChild,args:[i.AjfMonacoEditor,{static:!0}]}],fields:[{type:r.Input}],condition:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var K=function(){function e(e,i){this.dialogRef=i,this._fields=e.flatFields.pipe(O.map((function(e){return e.sort((function(e,i){return e.name.localeCompare(i.name)}))})))}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),e.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close(this.editor.editedValue)},e}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function Z(e,i,t,n){void 0===n&&(n=!1);var o=e.item.data,r=e.container.id;if(o.node)i.moveNodeEntry(e.item.data,e.previousIndex,e.currentIndex);else{if(null==t&&"slides-list"===r)return void i.insertNode(o,null,0,n,e.currentIndex);var a=n?{parent:t.node,parentNode:0}:t;i.insertNode(o,a.parent,a.parentNode,n,e.currentIndex)}}function Q(e){return!e.data.isSlide}function X(e){return!!e.data.isSlide}K.decorators=[{type:r.Component,args:[{selector:"ajf-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],K.ctorParameters=function(){return[{type:$},{type:p.MatDialogRef}]},K.propDecorators={editor:[{type:r.ViewChild,args:[J,{static:!1}]}]};var ee=function(){function e(e,i){var t=this;this._service=e,this._cdr=i,this.dataSource=new S.MatTableDataSource,this.displayedColumns=["label","value","delete"],this.separatorKeysCodes=[M.ENTER,M.COMMA],this._stringIdentifierSub=T.Subscription.EMPTY,this._stringIdentifierSub=e.stringIdentifier.subscribe((function(e){t.dataSource.data=A(e)})),this.fields$=e.flatFields.pipe(O.map((function(e){return e.sort((function(e,i){return e.name.localeCompare(i.name)})).map((function(e){return e.name})).filter((function(e){return e.length>0}))})),O.shareReplay(1))}return e.prototype.addRow=function(){this.dataSource.data=A(this.dataSource.data,[{label:"",value:[]}])},e.prototype.deleteRow=function(e){this.dataSource.data=A(this.dataSource.data.slice(0,e),this.dataSource.data.slice(e+1))},e.prototype.addValue=function(e,i,t){0!==i.value.length&&(e.value=A(e.value,[i.value]),t.value="",this._cdr.markForCheck())},e.prototype.removeValue=function(e,i){var t=e.value.indexOf(i);t>-1&&(e.value=A(e.value.slice(0,t),e.value.slice(t+1)),this._cdr.markForCheck())},e.prototype.ngOnDestroy=function(){this._stringIdentifierSub.unsubscribe()},e.prototype.saveStringIdentifier=function(){this._service.saveStringIdentifier(this.dataSource.data)},e.prototype.selected=function(e,i){e.value=A(e.value,[i.option.value]),this._cdr.markForCheck()},e}();ee.decorators=[{type:r.Component,args:[{selector:"ajf-fb-string-identifier-dialog",template:'<h3 matDialogTitle translate>Edit identifier</h3>\n<mat-dialog-content>\n  <button (click)="addRow()" mat-button>\n    <mat-icon>add</mat-icon>\n    <span translate>Add value</span>\n  </button>\n  <mat-table [dataSource]="dataSource">\n    <ng-container matColumnDef="label">\n      <mat-header-cell *matHeaderCellDef translate>Label</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n        <mat-form-field>\n          <input matInput [placeholder]="\'Label\'|translate" autofocus [(ngModel)]="row.label">\n        </mat-form-field>\n      </mat-cell>\n    </ng-container>\n    <ng-container matColumnDef="value">\n      <mat-header-cell *matHeaderCellDef translate>Value</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n        <mat-form-field>\n          <mat-chip-list #chipList>\n            <mat-chip\n                *ngFor="let field of row.value"\n                (removed)="removeValue(row, field)"\n            >\n              {{ field }}\n              <mat-icon matChipRemove>cancel</mat-icon>\n            </mat-chip>\n          </mat-chip-list>\n          <input\n              #valueInput\n              [ngModel]="row.value"\n              [matAutocomplete]="valueAc"\n              [matChipInputFor]="chipList"\n              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"\n              [matChipInputAddOnBlur]="true"\n              (matChipInputTokenEnd)="addValue(row, $event, valueInput)"\n              [placeholder]="\'Value\'|translate">\n          <mat-autocomplete #valueAc="matAutocomplete"\n              (optionSelected)="selected(row, $event)">\n            <mat-option *ngFor="let field of fields$ | async" [value]="field">{{field}}</mat-option>\n          </mat-autocomplete>\n        </mat-form-field>\n      </mat-cell>\n    </ng-container>\n    <ng-container matColumnDef="delete">\n      <mat-header-cell *matHeaderCellDef translate>Delete</mat-header-cell>\n      <mat-cell *matCellDef="let row; let idx = index">\n          <mat-icon (click)="deleteRow(idx)">delete</mat-icon>\n      </mat-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\n    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\n  </mat-table>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate matDialogClose (click)="saveStringIdentifier()">Save</button>\n</mat-dialog-actions>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["\n"]}]}],ee.ctorParameters=function(){return[{type:$},{type:r.ChangeDetectorRef}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var ie=function(){function e(e,i){var t=this;this._service=e,this._dialog=i,this._globalExpanded=!1,this._connectedDropLists=this._service.connectedDropLists,this._vc=new r.EventEmitter,this._init=!1,this._editConditionSub=T.Subscription.EMPTY,this._beforeNodesUpdateSub=T.Subscription.EMPTY,this._editChoicesOriginSub=T.Subscription.EMPTY,this._stringIdentifierSub=T.Subscription.EMPTY,this._nodeTypes=e.availableNodeTypes,this._nodeEntriesTree=e.nodeEntriesTree,this._choicesOrigins=e.choicesOrigins,this._editConditionSub=this._service.editedCondition.subscribe((function(e){null!=t._editConditionDialog&&(t._editConditionDialog.close(),t._editConditionDialog=null),null!=e&&(t._editConditionDialog=t._dialog.open(K,{disableClose:!0}))})),this._editChoicesOriginSub=this._service.editedChoicesOrigin.subscribe((function(e){null!=t._editChoicesOriginDialog&&(t._editChoicesOriginDialog.close(),t._editChoicesOriginDialog=null),null!=e&&(t._editChoicesOriginDialog=t._dialog.open(G,{disableClose:!0}))})),this._beforeNodesUpdateSub=this._service.beforeNodesUpdate.subscribe((function(){null!=t.designerCont&&(t._lastScrollTop=t.designerCont.nativeElement.scrollTop)})),this.nodeEntriesTree.pipe(O.sample(this._vc)).subscribe((function(){null!=t.designerCont&&(t.designerCont.nativeElement.scrollTop=t._lastScrollTop)})),this._stringIdentifierSub=this._service.stringIdentifier.subscribe((function(){}))}return Object.defineProperty(e.prototype,"form",{get:function(){return this._form},set:function(e){this._form!==e&&(this._form=e,this._init&&this._setCurrentForm())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeTypes",{get:function(){return this._nodeTypes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isGlobalExpanded",{get:function(){return this._globalExpanded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectedDropLists",{get:function(){return this._connectedDropLists},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewChecked=function(){this._vc.emit()},e.prototype.ngAfterContentInit=function(){this._setCurrentForm(),this._init=!0},e.prototype.ngOnDestroy=function(){this._editConditionSub.unsubscribe(),this._beforeNodesUpdateSub.unsubscribe(),this._editChoicesOriginSub.unsubscribe(),this._stringIdentifierSub.unsubscribe(),this._service.setForm(null)},e.prototype.createChoicesOrigin=function(){this._service.createChoicesOrigin()},e.prototype.disableDrop=function(){return!1},e.prototype.disableFieldDrop=function(e){return X(e)},e.prototype.onDrop=function(e,i){void 0===i&&(i=!1),Z(e,this._service,null,i)},e.prototype.editChoicesOrigin=function(e){this._service.editChoicesOrigin(e)},e.prototype.editStringIdentifier=function(){null!=this._stringIdentifierDialog&&(this._stringIdentifierDialog.close(),this._stringIdentifierDialog=null),this._stringIdentifierDialog=this._dialog.open(ee,{disableClose:!0,width:"60%",height:"60%"})},e.prototype.expandAll=function(){this._globalExpanded=!0},e.prototype.collapseAll=function(){this._globalExpanded=!1},e.prototype.expandToggle=function(e){e.checked?this.expandAll():this.collapseAll()},e.prototype._setCurrentForm=function(){this._service.setForm(this._form)},e}();ie.decorators=[{type:r.Component,args:[{selector:"ajf-form-builder",template:'<mat-toolbar>\n  <button mat-icon-button (click)="leftSidenav.toggle()">\n    <mat-icon>add_box</mat-icon>\n  </button>\n  <button mat-button [matMenuTriggerFor]="choicesMenu" translate>Choices</button>\n  <button mat-button (click)="editStringIdentifier()" translate>Identifier</button>\n  <button mat-icon-button aria-label="Collapsed" matTooltip="Keep slides collapsed">\n    <mat-icon>unfold_less</mat-icon>\n  </button>\n  <mat-slide-toggle color="primary" (change)="expandToggle($event)"></mat-slide-toggle> \n  <button mat-icon-button aria-label="Expanded" matTooltip="Keep slides expanded">\n    <mat-icon>unfold_more</mat-icon>\n  </button>\n  <mat-menu #choicesMenu>\n    <button (click)="createChoicesOrigin()" mat-menu-item translate>New..</button>\n    <ng-container *ngIf="choicesOrigins|async as cos">\n      <button *ngFor="let choicesOrigin of cos"\n          (click)="editChoicesOrigin(choicesOrigin)" mat-menu-item>\n        {{ choicesOrigin.label || choicesOrigin.name }}\n      </button>\n    </ng-container>\n  </mat-menu>\n  <span class="ajf-spacer"></span>\n  <button mat-icon-button (click)="rightSidenav.toggle()">\n    <mat-icon>settings</mat-icon>\n  </button>\n</mat-toolbar>\n<mat-drawer-container cdkDropListGroup>\n  <mat-drawer #leftSidenav position="start" mode="over">\n    <div #sourceDropList cdkDropList\n        [cdkDropListConnectedTo]="(connectedDropLists|async)!"\n        [cdkDropListEnterPredicate]="disableDrop"\n        [cdkDropListData]="nodeTypes">\n      <ajf-fb-node-type-entry *ngFor="let nodeType of nodeTypes"\n          cdkDrag\n          [cdkDragData]="nodeType"\n          (cdkDragStarted)="leftSidenav.close()"\n          [nodeType]="nodeType"></ajf-fb-node-type-entry>\n    </div>\n  </mat-drawer>\n  <mat-drawer #rightSidenav position="end" mode="side" [opened]="true">\n    <ajf-fb-node-properties></ajf-fb-node-properties>\n  </mat-drawer>\n  <div #designer class="ajf-designer">\n    <ajf-fb-node-entry id="slides-list"\n        cdkDropList\n        (cdkDropListDropped)="onDrop($event)"\n        [cdkDropListEnterPredicate]="disableFieldDrop"\n        *ngFor="let nodeEntry of (nodeEntriesTree|async); let isFirst = first"\n        [isExpanded]="isGlobalExpanded"\n        [isFirst]="isFirst"\n        [nodeEntry]="nodeEntry"></ajf-fb-node-entry>\n  </div>\n</mat-drawer-container>\n',changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["ajf-form-builder{display:flex;position:relative;min-height:300px;flex-direction:column;align-items:stretch}ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-button]{flex:1 0 auto}ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-icon-button]{flex:0 0 auto}ajf-form-builder mat-drawer-container{flex:1}ajf-form-builder mat-drawer-container mat-drawer{max-width:20%}ajf-form-builder mat-drawer-container .ajf-designer{padding:1em}ajf-form-builder mat-toolbar .ajf-spacer{flex:1 1 auto}\n"]}]}],ie.ctorParameters=function(){return[{type:$},{type:p.MatDialog}]},ie.propDecorators={designerCont:[{type:r.ViewChild,args:["designer",{static:!0}]}],form:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var te=["#F44336","#4CAF50","#3F51B5","#FFC107","#795548"],ne=function(){function e(e){this._service=e,this._hasContent=!1,this._isFirst=!1,this._isNodeEntry=!1,this._isExpanded=!1,this._level=0,this._isDraggable=!0,this._branchColors=te.slice(0),this._dropZones=["fbdz-node"],this._slideDropZones=["fbdz-slide"],this._originOffset=0,this._originLeftMargin="0",this._firstBranchColor=te[0],this._branchLinesSubscription=T.Subscription.EMPTY,this._childEntriesSubscription=T.Subscription.EMPTY,this._currentEditedNode=this._service.editedNodeEntry}return Object.defineProperty(e.prototype,"hasContent",{get:function(){return this._hasContent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFirst",{get:function(){return this._isFirst},set:function(e){this._isFirst=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isNodeEntry",{get:function(){return this._isNodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isExpanded",{get:function(){return this._isExpanded},set:function(e){var i=this;this._isExpanded=e,setTimeout((function(){return i._updateBranchHeights()}),400)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeEntry",{get:function(){return this._nodeEntry},set:function(e){if(this._nodeEntry=e,null!=e&&void 0!==e.node){var i=e;this._isNodeEntry=!0;var t=i.node;this._hasContent=null!=t&&F.isContainerNode(t)}else this._isNodeEntry=!1,this._hasContent=!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){this._level=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDraggable",{get:function(){return this._isDraggable},set:function(e){this._isDraggable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realNodeEntry",{get:function(){return this._nodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchColors",{get:function(){return this._branchColors},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropZones",{get:function(){return this._dropZones},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"slideDropZones",{get:function(){return this._slideDropZones},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originOffset",{get:function(){return this._originOffset},set:function(e){this._originOffset=e,this._originLeftMargin=4*this._originOffset+"px"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"originLeftMargin",{get:function(){return this._originLeftMargin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstBranchColor",{get:function(){return this._firstBranchColor},set:function(e){var i=te.indexOf(e);i>0?(this._firstBranchColor=e,this._branchColors=te.slice(i).concat(te.slice(0,i))):(this._firstBranchColor=te[0],this._branchColors=te.slice(0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentEditedNode",{get:function(){return this._currentEditedNode},enumerable:!1,configurable:!0}),e.prototype.onResize=function(){},e.prototype.edit=function(e){e.stopPropagation(),null!=this.nodeEntry&&this.isNodeEntry&&this._service.editNodeEntry(this.nodeEntry)},e.prototype.delete=function(e){e.stopPropagation(),null!=this.nodeEntry&&this.isNodeEntry&&this._service.deleteNodeEntry(this.nodeEntry)},e.prototype.isLastNode=function(){return!(!this.realNodeEntry||!this.realNodeEntry.children||this.realNodeEntry.children[0].children)},e.prototype.isSlide=function(e){return F.isSlidesNode(e)},e.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){return e._updateBranchHeights()})),this._childEntriesSubscription=this.childEntries.changes.subscribe((function(){e._updateBranchHeights()}))},e.prototype.ngOnDestroy=function(){this._branchLinesSubscription.unsubscribe(),this._childEntriesSubscription.unsubscribe()},e.prototype.onDrop=function(e,i){void 0===i&&(i=!1),Z(e,this._service,this._nodeEntry,i)},e.prototype.assignId=function(e){return void 0===e&&(e=!1),this._service.assignListId(this.realNodeEntry.node,e)},e.prototype.disableSlideDrop=function(e){return Q(e)},e.prototype.disableFieldDrop=function(e){return X(e)},e.prototype.emptyAreaDropPredicate=function(){var e=this;return function(i,t){return e._level>0?!i.data.isSlide:i.data.isSlide||!1}},e.prototype._updateBranchHeights=function(){if(null!=this.nodeEntry&&this.isNodeEntry&&null!=this.branchLines&&null!=this.childEntries){var e=this.nodeEntry,i=this.branchLines.toArray(),t=null!=e.content?e.content.length:0,n=this.childEntries.toArray().slice(t);i.length==n.length&&i.forEach((function(e,i){e.height=n[i].nativeElement.offsetTop}))}},e}();ne.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-entry",template:'<ng-container *ngIf="nodeEntry != null ; else rootEmpty">\n  <ng-template [ngIf]="isNodeEntry && !isLastNode()">\n    <ajf-fb-branch-line\n      *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index"\n      [offset]="idx"\n      [color]="branchColors[idx]"\n    ></ajf-fb-branch-line>\n  </ng-template>\n\n  <div\n    class="mat-card-container"\n    [class.ajf-highlight]="(currentEditedNode|async) == nodeEntry"\n  >\n    <div\n      *ngIf="!isFirst"\n      class="ajf-origin-line"\n      [style.margin-left]="originLeftMargin"\n      [style.border-color]="firstBranchColor"\n    ></div>\n    <ng-template [ngIf]="isNodeEntry">\n      <ng-container *ngIf="!isDraggable; else draggable">\n        <mat-card>\n          <ng-container *ngTemplateOutlet="cardTitle"></ng-container>\n          <ng-container *ngTemplateOutlet="cardContent"></ng-container>\n        </mat-card>\n      </ng-container>\n\n      <ng-template #draggable>\n        <mat-card cdkDrag [cdkDragData]="realNodeEntry" class="ajf-draggable-box">\n          <ng-container\n            *ngIf="isSlide(realNodeEntry.node); else fieldPanel"\n          >\n            <ng-container *ngTemplateOutlet="slidePanel"></ng-container>\n          </ng-container>\n        </mat-card>\n      </ng-template>\n\n      <ng-template #slidePanel>\n        <mat-expansion-panel\n          [expanded]="isExpanded"\n          (opened)="isExpanded = true"\n          (closed)="isExpanded = false"\n          class="mat-elevation-z"\n        >\n          <mat-expansion-panel-header>\n            <ng-container *ngTemplateOutlet="cardTitle"></ng-container>\n          </mat-expansion-panel-header>\n          <ng-container *ngTemplateOutlet="cardContent"></ng-container>\n        </mat-expansion-panel>\n      </ng-template>\n\n      <ng-template #fieldPanel>\n        <ng-container *ngTemplateOutlet="cardTitle"></ng-container>\n        <ng-container *ngTemplateOutlet="cardContent"></ng-container>\n      </ng-template>\n\n      <ng-template #cardTitle>\n        <div class="ajf-title-row">\n          <ajf-node-icon [node]="realNodeEntry.node"></ajf-node-icon>\n          <span\n            class="ajf-title"\n            [innerHTML]="(realNodeEntry.node.label || realNodeEntry.node.name)  | translate"\n          ></span>\n          <span\n            *ngIf="realNodeEntry.node.visibility && realNodeEntry.node.visibility?.condition !== \'true\'"\n            class="ajf-visibility-condition"\n            [innerHTML]="\'Condition: (\' + realNodeEntry.node.visibility?.condition + \')\'"\n          >\n          </span>\n          <span class="ajf-actions">\n            <button\n              [disabled]="(currentEditedNode|async) == nodeEntry"\n              (click)="edit($event)"\n              mat-icon-button\n            >\n              <mat-icon>edit</mat-icon>\n            </button>\n            <button\n              [disabled]="(currentEditedNode|async) == null"\n              (click)="delete($event)"\n              mat-icon-button\n            >\n              <mat-icon>delete</mat-icon>\n            </button>\n          </span>\n        </div>\n      </ng-template>\n\n      <ng-template #cardContent>\n        <div *ngIf="hasContent">\n          <ajf-fb-node-entry\n            cdkDropList\n            class="ajf-fields-list"\n            *ngFor="let contentEntry of realNodeEntry.content; let isFirstChild = first; let idx = index"\n            [id]="assignId()"\n            [level]="level + 1"\n            [isFirst]="isFirstChild"\n            [firstBranchColor]="branchColors[idx]"\n            [nodeEntry]="contentEntry"\n            [cdkDropListEnterPredicate]="disableSlideDrop"\n            (cdkDropListDropped)="onDrop($event, true)"\n            [isExpanded]="isExpanded"\n          ></ajf-fb-node-entry>\n          <mat-card\n            class="ajf-empty"\n            *ngIf="realNodeEntry.content.length === 0"\n            cdkDropList\n            [id]="assignId(true)"\n            [cdkDropListEnterPredicate]="disableSlideDrop"\n            (cdkDropListDropped)="onDrop($event, true)"\n            ><mat-card-title>Drop your fields here</mat-card-title></mat-card\n          >\n        </div>\n      </ng-template>\n    </ng-template>\n  </div>\n\n  <ng-template [ngIf]="isNodeEntry">\n    <ng-container\n      *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index"\n    >\n      <ajf-fb-node-entry\n        *ngIf="!isLastNode()"\n        [level]="level"\n        [originOffset]="idx"\n        [firstBranchColor]="branchColors[idx]"\n        [nodeEntry]="childNodeEntry"\n        [isExpanded]="isExpanded"\n      ></ajf-fb-node-entry>\n    </ng-container>\n  </ng-template>\n</ng-container>\n\n<ng-template #rootEmpty>\n  <div class="mat-card-container">\n    <mat-card\n      class="ajf-empty"\n      cdkDropList\n      [cdkDropListEnterPredicate]="emptyAreaDropPredicate()"\n      (cdkDropListDropped)="onDrop($event)"\n      ><mat-card-title>Drop your slides here</mat-card-title>\n    </mat-card>\n  </div>\n</ng-template>\n',host:{"(window.resize)":"onResize()"},encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-entry{display:block;position:relative}ajf-fb-node-entry .mat-card-container{position:relative}ajf-fb-node-entry .mat-card-container .ajf-origin-line{position:absolute;top:0;left:25px;width:25px;height:25px;border-bottom:2px solid;border-left:2px solid;border-bottom-left-radius:.5em}ajf-fb-node-entry .mat-card-container mat-card{margin-left:50px;padding:.5em 1em;margin-top:.2em;margin-bottom:.2em;background-color:#fff}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row{display:flex;flex:1 1 auto;flex-direction:row;align-items:center}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-title{flex:1 1 auto}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-visibility-condition{flex:1 1 auto;font-size:10px;color:#999}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-actions{flex:0 0 auto;white-space:nowrap}ajf-fb-node-entry .mat-card-container mat-card.ajf-empty{line-height:36px;border:2px dashed;box-shadow:none;box-sizing:border-box;text-align:center;color:#ccc}ajf-fb-node-entry .mat-card-container mat-card.ajf-draggable-box{padding:20px 10px;border-bottom:solid 1px #ccc;border-right:solid 1px #ccc;color:rgba(0,0,0,.87);box-sizing:border-box;cursor:move;background:#fff;font-size:14px}ajf-fb-node-entry .mat-card-container.ajf-highlight>mat-card{background-color:#fff9c4}ajf-fb-node-entry.ajf-fields-list{max-width:80%;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden}ajf-fb-node-entry .cdk-drag-placeholder{opacity:0;min-height:60px}ajf-fb-node-entry .ajf-fields-list.cdk-drop-list-dragging .ajf-draggable-box:not(.cdk-drag-placeholder),ajf-fb-node-entry .cdk-drag-animating{transition:transform 250ms cubic-bezier(0, 0, 0.2, 1)}\n"]}]}],ne.ctorParameters=function(){return[{type:$}]},ne.propDecorators={branchLines:[{type:r.ViewChildren,args:[P]}],childEntries:[{type:r.ViewChildren,args:[ne,{read:r.ElementRef}]}],isFirst:[{type:r.Input}],isExpanded:[{type:r.Input}],nodeEntry:[{type:r.Input}],level:[{type:r.Input}],isDraggable:[{type:r.Input}],originOffset:[{type:r.Input}],firstBranchColor:[{type:r.Input}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var oe=function(){function e(e,i){this.dialogRef=i,this._fields=e.flatFields.pipe(O.map((function(e){return e.sort((function(e,i){return e.name.localeCompare(i.name)}))})))}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),e.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close({condition:this.editor.editedValue,errorMessage:this.errorMessage})},e}();oe.decorators=[{type:r.Component,args:[{selector:"ajf-fb-validation-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <mat-form-field>\n    <input matInput [(ngModel)]="errorMessage" [placeholder]="\'Error message\' | translate">\n  </mat-form-field>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-validation-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],oe.ctorParameters=function(){return[{type:$},{type:p.MatDialogRef}]},oe.propDecorators={editor:[{type:r.ViewChild,args:[J,{static:!1}]}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var re=function(){function e(e,i){this.dialogRef=i,this._fields=e.flatFields.pipe(O.map((function(e){return e.sort((function(e,i){return e.name.localeCompare(i.name)}))})))}return Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),e.prototype.saveCondition=function(){null!=this.editor&&this.dialogRef.close({condition:this.editor.editedValue,warningMessage:this.warningMessage})},e}();function ae(e){var i=e.value.minReps,t=e.value.maxReps;return null!=i&&null!=t&&i>t?{reps:"Min repetions cannot be greater than max repetitions"}:null}function se(e){var i=e.value.minValue,t=e.value.maxValue;return null!=i&&null!=t&&i>t?{valueLimit:"Min value cannot be greater than max value"}:null}function le(e){var i=e.value.minDigits,t=e.value.maxDigits;return null!=i&&null!=t&&i>t?{digits:"Min digits cannot be greater than max digits"}:null}re.decorators=[{type:r.Component,args:[{selector:"ajf-fb-warning-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3>\n<mat-dialog-content>\n  <mat-form-field>\n    <input matInput [(ngModel)]="warningMessage"\n      [placeholder]="\'Warning message\' | translate">\n  </mat-form-field>\n  <ajf-condition-editor\n      *ngIf="fields|async as curFields"\n      [fields]="curFields!"\n      [condition]="condition"></ajf-condition-editor>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button translate (click)="saveCondition()">Save</button>\n  <button mat-button translate matDialogClose>Close</button>\n</mat-dialog-actions>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-warning-condition-editor-dialog mat-dialog-content{overflow:visible}\n"]}]}],re.ctorParameters=function(){return[{type:$},{type:p.MatDialogRef}]},re.propDecorators={editor:[{type:r.ViewChild,args:[J,{static:!1}]}]};var de=function(){function e(e,i,t,n){var o=this;this._cdr=e,this._service=i,this._dialog=t,this._fb=n,this._fieldSizes=[{label:"Normal",value:"normal"},{label:"Small",value:"small"},{label:"Smaller",value:"smaller"},{label:"Tiny",value:"tiny"},{label:"Mini",value:"mini"}],this._choicesOrigins=[],this._conditionalBranches=[],this._validationConditions=[],this._warningConditions=[],this.isRepeatingContainerNode=function(e){return null!=e&&F.isRepeatingContainerNode(e.node)},this._visibilityOptSub=T.Subscription.EMPTY,this._visibilitySub=T.Subscription.EMPTY,this._conditionalBranchesSub=T.Subscription.EMPTY,this._formulaRepsSub=T.Subscription.EMPTY,this._choicesFilterSub=T.Subscription.EMPTY,this._formulaSub=T.Subscription.EMPTY,this._forceValueSub=T.Subscription.EMPTY,this._validationConditionsSub=T.Subscription.EMPTY,this._warningConditionsSub=T.Subscription.EMPTY,this._nextSlideConditionSub=T.Subscription.EMPTY,this._choicesOriginsSub=T.Subscription.EMPTY,this._triggerConditionsSub=T.Subscription.EMPTY,this._editConditionDialogSub=T.Subscription.EMPTY,this._editValidationConditionDialogSub=T.Subscription.EMPTY,this._editWarningConditionDialogSub=T.Subscription.EMPTY,this._editVisibilityEvt=new r.EventEmitter,this._editVisibilitySub=T.Subscription.EMPTY,this._editConditionalBranchEvt=new r.EventEmitter,this._editConditionalBranchSub=T.Subscription.EMPTY,this._editFormulaRepsEvt=new r.EventEmitter,this._editFormulaRepsSub=T.Subscription.EMPTY,this._editChoicesFilterEvt=new r.EventEmitter,this._editChoicesFilterSub=T.Subscription.EMPTY,this._editFormulaEvt=new r.EventEmitter,this._editFormulaSub=T.Subscription.EMPTY,this._editForceValueEvt=new r.EventEmitter,this._editForceValueSub=T.Subscription.EMPTY,this._editValidationConditionEvt=new r.EventEmitter,this._editValidationConditionSub=T.Subscription.EMPTY,this._addValidationConditionEvt=new r.EventEmitter,this._addValidationConditionSub=T.Subscription.EMPTY,this._removeValidationConditionEvt=new r.EventEmitter,this._removeValidationConditionSub=T.Subscription.EMPTY,this._editWarningConditionEvt=new r.EventEmitter,this._editWarningConditionSub=T.Subscription.EMPTY,this._addWarningConditionEvt=new r.EventEmitter,this._addWarningConditionSub=T.Subscription.EMPTY,this._removeWarningConditionEvt=new r.EventEmitter,this._removeWarningConditionSub=T.Subscription.EMPTY,this._editNextSlideConditionEvt=new r.EventEmitter,this._editNextSlideConditionSub=T.Subscription.EMPTY,this._editTriggerConditionEvt=new r.EventEmitter,this._editTriggerConditionSub=T.Subscription.EMPTY,this._addTriggerConditionEvt=new r.EventEmitter,this._addTriggerConditionSub=T.Subscription.EMPTY,this._removeTriggerConditionEvt=new r.EventEmitter,this._removeTriggerConditionSub=T.Subscription.EMPTY,this._saveEvt=new r.EventEmitter,this._saveSub=T.Subscription.EMPTY,this._nodeEntry=i.editedNodeEntry,this._choicesOriginsSub=i.choicesOrigins.subscribe((function(e){return o._choicesOrigins=e||[]})),this._enabled=this._nodeEntry.pipe(O.map((function(e){return null!=e}))),this._initForm(),this._initVisibilityEdit(),this._initConditionalBranchEdit(),this._initFormulaRepsEdit(),this._initChoicesFilterEdit(),this._initFormulaEdit(),this._initForceValueEdit(),this._initValidationConditionEdit(),this._initAddValidationCondition(),this._initRemoveValidationCondition(),this._initWarningConditionEdit(),this._initAddWarningCondition(),this._initRemoveWarningCondition(),this._initNextSlideConditionEdit(),this._initTriggerConditionEdit(),this._initAddTriggerCondition(),this._initRemoveTriggerCondition(),this._initSave()}return Object.defineProperty(e.prototype,"fieldSizes",{get:function(){return this._fieldSizes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nodeEntry",{get:function(){return this._nodeEntry},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"propertiesForm",{get:function(){return this._propertiesForm},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChoices",{get:function(){return this._hasChoices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curVisibility",{get:function(){return this._curVisibility},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curFormulaReps",{get:function(){return this._curFormulaReps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curChoicesFilter",{get:function(){return this._curChoicesFilter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curForceValue",{get:function(){return this._curForceValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curFormula",{get:function(){return this._curFormula},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionalBranches",{get:function(){return this._conditionalBranches},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"validationConditions",{get:function(){return this._validationConditions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"warningConditions",{get:function(){return this._warningConditions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSlideCondition",{get:function(){return this._nextSlideCondition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"triggerConditions",{get:function(){return this._triggerConditions},enumerable:!1,configurable:!0}),e.prototype.editVisibility=function(){this._editVisibilityEvt.emit()},e.prototype.editConditionalBranch=function(e){e<0||e>=this._conditionalBranches.length||this._editConditionalBranchEvt.emit(e)},e.prototype.editFormulaReps=function(){this._editFormulaRepsEvt.emit()},e.prototype.editChoicesFilter=function(){this._editChoicesFilterEvt.emit()},e.prototype.editFormula=function(){this._editFormulaEvt.emit()},e.prototype.editForceValue=function(){this._editForceValueEvt.emit()},e.prototype.editValidationCondition=function(e){e<0||e>=this._validationConditions.length||this._editValidationConditionEvt.emit(e)},e.prototype.addValidationCondition=function(){this._addValidationConditionEvt.emit()},e.prototype.removeValidationCondition=function(e){e<0||e>=this._validationConditions.length||this._removeValidationConditionEvt.emit(e)},e.prototype.editWarningCondition=function(e){e<0||e>=this._warningConditions.length||this._editWarningConditionEvt.emit(e)},e.prototype.addWarningCondition=function(){this._addWarningConditionEvt.emit()},e.prototype.removeWarningCondition=function(e){e<0||e>=this._warningConditions.length||this._removeWarningConditionEvt.emit(e)},e.prototype.editNextSlideCondition=function(){this._editNextSlideConditionEvt.emit()},e.prototype.editTriggerCondition=function(e){e<0||e>=this._triggerConditions.length||this._editTriggerConditionEvt.emit(e)},e.prototype.addTriggerCondition=function(){this._addTriggerConditionEvt.emit()},e.prototype.removeTriggerCondition=function(e){e<0||e>=this._triggerConditions.length||this._removeTriggerConditionEvt.emit(e)},e.prototype.isField=function(e){return null!=e&&F.isField(e.node)},e.prototype.isNumericField=function(e){return F.isField(e)&&F.isNumberField(e)},e.prototype.isFieldWithChoices=function(e){return F.isField(e)&&F.isFieldWithChoices(e)},e.prototype.save=function(){this._saveEvt.emit()},e.prototype.cancel=function(){this._service.cancelNodeEntryEdit()},e.prototype.ngOnDestroy=function(){this._choicesOriginsSub.unsubscribe(),this._visibilityOptSub.unsubscribe(),this._visibilitySub.unsubscribe(),this._formulaRepsSub.unsubscribe(),this._choicesFilterSub.unsubscribe(),this._formulaSub.unsubscribe(),this._forceValueSub.unsubscribe(),this._validationConditionsSub.unsubscribe(),this._warningConditionsSub.unsubscribe(),this._triggerConditionsSub.unsubscribe(),this._editConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub.unsubscribe(),this._editChoicesFilterSub.unsubscribe(),this._editConditionalBranchSub.unsubscribe(),this._editVisibilitySub.unsubscribe(),this._editFormulaRepsSub.unsubscribe(),this._editFormulaSub.unsubscribe(),this._editForceValueSub.unsubscribe(),this._editValidationConditionSub.unsubscribe(),this._editWarningConditionSub.unsubscribe(),this._nextSlideConditionSub.unsubscribe(),this._addTriggerConditionSub.unsubscribe(),this._addValidationConditionSub.unsubscribe(),this._addWarningConditionSub.unsubscribe(),this._editNextSlideConditionSub.unsubscribe(),this._editTriggerConditionSub.unsubscribe(),this._removeTriggerConditionSub.unsubscribe(),this._removeValidationConditionSub.unsubscribe(),this._removeWarningConditionSub.unsubscribe(),this._saveSub.unsubscribe()},e.prototype._initSave=function(){var e=this;this._saveSub=this._saveEvt.pipe(O.withLatestFrom(this.propertiesForm)).subscribe((function(i){var t=k(i,2),n=Object.assign(Object.assign({},t[1].value),{conditionalBranches:e._conditionalBranches});e._service.saveNodeEntry(n)}))},e.prototype._initForm=function(){var e=this;this._propertiesForm=this._nodeEntry.pipe(O.filter((function(e){return null!=e})),O.map((function(i){null!=e._visibilityOptSub&&e._visibilityOptSub.unsubscribe(),null!=e._visibilitySub&&e._visibilitySub.unsubscribe(),null!=e._conditionalBranchesSub&&e._conditionalBranchesSub.unsubscribe();var t=null!=(i=i).node.visibility?i.node.visibility.condition:null,n=null!=i.node.visibility?e._guessVisibilityOpt(i.node.visibility):null,o={name:[i.node.name,a.Validators.required],label:i.node.label,visibilityOpt:[n,a.Validators.required],visibility:[t,a.Validators.required],conditionalBranchesNum:i.node.conditionalBranches.length},r=[];if(F.isRepeatingContainerNode(i.node)){var s=i.node,l=null!=s.formulaReps?s.formulaReps.formula:null;o.formulaReps=[l,a.Validators.required],o.minReps=s.minReps,o.maxReps=s.maxReps,e._curFormulaReps=l,r.push(ae)}if(e.isField(i)){var d=i.node,c=null,u=!1,p=[];null!=d.validation&&(null!=d.validation.forceValue&&(c=d.validation.forceValue.condition),u=null!=d.validation.notEmpty,p=(d.validation.conditions||[]).map((function(e){return{condition:e.condition,errorMessage:e.errorMessage}})));var f=!1,h=[];null!=d.warning&&(f=null!=d.warning.notEmpty,h=(d.warning.conditions||[]).map((function(e){return{condition:e.condition,warningMessage:e.warningMessage}})));var m=null!=d.formula?d.formula.formula:null;o.description=d.description,o.defaultValue=d.defaultValue,o.hint=d.hint,o.size=d.size,o.formula=m,o.forceValue=c,o.notEmpty=u,o.validationConditions=[p,[]],o.notEmptyWarning=f,o.warningConditions=[h,[]],o.nextSlideCondition=[d.nextSlideCondition],e._curForceValue=c,e._curFormula=m,e._validationConditions=p,e._warningConditions=h}if(e.isNumericField(i.node)){var g=i.node,b=void 0,_=void 0,v=void 0,y=void 0;null!=g.validation&&(null!=g.validation.minValue&&(b=(g.validation.minValue.condition||"").replace("$value >= ","")),null!=g.validation.maxValue&&(_=(g.validation.maxValue.condition||"").replace("$value <= ","")),null!=g.validation.minDigits&&(v=(g.validation.minDigits.condition||"").replace("$value.toString().length >= ","")),null!=g.validation.maxDigits&&(y=(g.validation.maxDigits.condition||"").replace("$value.toString().length <= ",""))),o.minValue=b,o.maxValue=_,o.minDigits=v,o.maxDigits=y,r.push(se),r.push(le)}if(e.isFieldWithChoices(i.node)){var C=i.node,j=(C.triggerConditions||[]).map((function(e){return e.condition}));o.choicesOriginRef=C.choicesOriginRef,o.choicesFilter=null!=C.choicesFilter?C.choicesFilter.formula:null,o.forceExpanded=C.forceExpanded,o.forceNarrow=C.forceNarrow,o.triggerConditions=j,e._triggerConditions=j}var S=e._fb.group(o);return S.setValidators(r),e._conditionalBranches=i.node.conditionalBranches.map((function(e){return e.condition})),e._curVisibility=null!=i.node.visibility?i.node.visibility.condition:null,e._handleConditionalBranchesChange(S),e._handleVisibilityChange(S),e._handleFormulaRepsChange(S),e._handleChoicesFilterChange(S),e._handleFormulaChange(S),e._handleForceValueChange(S),e._handleValidationCondtionsChange(S),e._handleWarningCondtionsChange(S),e._handleNextSlideConditionChange(S),e._handleTriggerCondtionsChange(S),S})),O.publishReplay(1),O.refCount())},e.prototype._destroyConditionDialog=function(){null!=this._editConditionDialogSub&&(this._editConditionDialogSub.unsubscribe(),this._editConditionDialogSub=T.Subscription.EMPTY),null!=this._editConditionDialog&&(this._editConditionDialog.close(),this._editConditionDialog=null)},e.prototype._destroyValidationConditionDialog=function(){null!=this._editValidationConditionDialogSub&&(this._editValidationConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub=T.Subscription.EMPTY),null!=this._editValidationConditionDialog&&(this._editValidationConditionDialog.close(),this._editValidationConditionDialog=null)},e.prototype._destroyWarningConditionDialog=function(){null!=this._editWarningConditionDialogSub&&(this._editWarningConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub=T.Subscription.EMPTY),null!=this._editWarningConditionDialog&&(this._editWarningConditionDialog.close(),this._editWarningConditionDialog=null)},e.prototype._initRemoveTriggerCondition=function(){this._removeTriggerConditionSub=this._removeTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2),t=i[0],n=i[1];if(null!=n){var o=n.controls.triggerConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},e.prototype._initAddTriggerCondition=function(){this._addTriggerConditionSub=this._addTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2)[1];if(null!=i){var t=i.controls.triggerConditions,n=(t.value||[]).slice(0);n.push(""),t.setValue(n)}}))},e.prototype._initTriggerConditionEdit=function(){var e=this;this._editConditionDialogSub=T.Subscription.EMPTY,this._cdr.markForCheck(),this._editTriggerConditionSub=this._editTriggerConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2),n=t[0],o=t[1];e._destroyConditionDialog(),n<0||n>=e._triggerConditions.length||null==o||(e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=e._triggerConditions[n],e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&(e._triggerConditions[n]=i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()})))}))},e.prototype._initRemoveWarningCondition=function(){this._removeWarningConditionSub=this._removeWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2),t=i[0],n=i[1];if(null!=n){var o=n.controls.warningConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},e.prototype._initAddWarningCondition=function(){this._addWarningConditionSub=this._addWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2)[1];if(null!=i){var t=i.controls.warningConditions,n=(t.value||[]).slice(0);n.push({condition:"",errorMessage:""}),t.setValue(n)}}))},e.prototype._initWarningConditionEdit=function(){var e=this;this._editWarningConditionSub=this._editWarningConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2),n=t[0],o=t[1];if(e._destroyWarningConditionDialog(),!(n<0||n>=e._warningConditions.length||null==o)){e._editWarningConditionDialog=e._dialog.open(re);var r=e._editWarningConditionDialog.componentInstance,a=e._warningConditions[n];r.condition=a.condition,r.warningMessage=a.warningMessage,e._editWarningConditionDialogSub=e._editWarningConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&(e._warningConditions[n]=i),e._editWarningConditionDialogSub.unsubscribe(),e._editWarningConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initRemoveValidationCondition=function(){this._removeValidationConditionSub=this._removeValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2),t=i[0],n=i[1];if(null!=n){var o=n.controls.validationConditions,r=(o.value||[]).slice(0);t<0||t>=r.length||(r.splice(t,1),o.setValue(r))}}))},e.prototype._initAddValidationCondition=function(){this._addValidationConditionSub=this._addValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(e){var i=k(e,2)[1];if(null!=i){var t=i.controls.validationConditions,n=(t.value||[]).slice(0);n.push({condition:"",errorMessage:""}),t.setValue(n)}}))},e.prototype._initValidationConditionEdit=function(){var e=this;this._editValidationConditionSub=this._editValidationConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2),n=t[0],o=t[1];if(e._destroyValidationConditionDialog(),!(n<0||n>=e._validationConditions.length||null==o)){e._editValidationConditionDialog=e._dialog.open(oe);var r=e._editValidationConditionDialog.componentInstance,a=e._validationConditions[n];r.condition=a.condition,r.errorMessage=a.errorMessage,e._editValidationConditionDialogSub=e._editValidationConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&(e._validationConditions[n]=i),e._editValidationConditionDialogSub.unsubscribe(),e._editValidationConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initForceValueEdit=function(){var e=this;this._editForceValueSub=this._editForceValueEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.forceValue;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=n.value,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initNextSlideConditionEdit=function(){var e=this;this._editNextSlideConditionSub=this._editNextSlideConditionEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.nextSlideCondition;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=n.value,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initFormulaEdit=function(){var e=this;this._editConditionDialogSub=T.Subscription.EMPTY,this._cdr.markForCheck(),this._editFormulaSub=this._editFormulaEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.formula;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=n.value,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initFormulaRepsEdit=function(){var e=this;this._editFormulaRepsSub=this._editFormulaRepsEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.formulaReps;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=n.value,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initChoicesFilterEdit=function(){var e=this;this._editChoicesFilterSub=this._editChoicesFilterEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.choicesFilter;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=n.value,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._initConditionalBranchEdit=function(){var e=this;this._editConditionalBranchSub=this._editConditionalBranchEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2),n=t[0],o=t[1];e._destroyConditionDialog(),n<0||n>=e._conditionalBranches.length||null==o||(e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=e._conditionalBranches[n],e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&(e._conditionalBranches[n]=i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()})))}))},e.prototype._initVisibilityEdit=function(){var e=this;this._editVisibilitySub=this._editVisibilityEvt.pipe(O.withLatestFrom(this._propertiesForm)).subscribe((function(i){var t=k(i,2)[1];if(e._destroyConditionDialog(),null!=t){var n=t.controls.visibility,o=n.value;e._editConditionDialog=e._dialog.open(K),e._editConditionDialog.componentInstance.condition=o,e._editConditionDialogSub=e._editConditionDialog.afterClosed().subscribe((function(i){void 0!==i&&n.setValue(i),e._editConditionDialogSub.unsubscribe(),e._editConditionDialogSub=T.Subscription.EMPTY,e._cdr.markForCheck()}))}}))},e.prototype._handleTriggerCondtionsChange=function(e){var i=this;this._triggerConditionsSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return JSON.stringify(e.triggerConditions)===JSON.stringify(i.triggerConditions)}))).subscribe((function(e){i._triggerConditions=e.triggerConditions,i._cdr.markForCheck()}))},e.prototype._handleWarningCondtionsChange=function(e){var i=this;this._warningConditionsSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return JSON.stringify(e.warningConditions)===JSON.stringify(i.warningConditions)}))).subscribe((function(e){i._warningConditions=e.warningConditions,i._cdr.markForCheck()}))},e.prototype._handleValidationCondtionsChange=function(e){var i=this;this._validationConditionsSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return JSON.stringify(e.validationConditions)===JSON.stringify(i.validationConditions)}))).subscribe((function(e){i._validationConditions=e.validationConditions,i._cdr.markForCheck()}))},e.prototype._handleForceValueChange=function(e){var i=this;this._forceValueSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.forceValue===i.forceValue}))).subscribe((function(e){i._curForceValue=e.forceValue,i._cdr.markForCheck()}))},e.prototype._handleNextSlideConditionChange=function(e){var i=this;this._formulaSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.nextSlideCondition===i.nextSlideCondition}))).subscribe((function(e){i._nextSlideCondition=e.nextSlideCondition,i._cdr.markForCheck()})),this._formulaSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.nextSlideCondition===i.nextSlideCondition}))).subscribe((function(e){i._nextSlideCondition=e.nextSlideCondition,i._cdr.markForCheck()}))},e.prototype._handleFormulaChange=function(e){var i=this;this._formulaSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.formula===i.formula}))).subscribe((function(e){i._curFormula=e.formula,i._cdr.markForCheck()}))},e.prototype._handleFormulaRepsChange=function(e){var i=this;this._formulaRepsSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.formulaReps===i.formulaReps}))).subscribe((function(e){i._curFormulaReps=e.formulaReps,i._cdr.markForCheck()}))},e.prototype._handleChoicesFilterChange=function(e){var i=this;this._choicesFilterSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.choicesFilter===i.choicesFilter}))).subscribe((function(e){i._curChoicesFilter=e.choicesFilter,i._cdr.markForCheck()}))},e.prototype._handleConditionalBranchesChange=function(e){var i=this;this._conditionalBranchesSub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.conditionalBranchesNum===i.conditionalBranchesNum}))).subscribe((function(e){var t=e.conditionalBranchesNum,n=i._conditionalBranches.length;if(n<t){for(var o=[],r=n;r<t;r++)o.push(w.alwaysCondition().condition);i._conditionalBranches=i._conditionalBranches.concat(o)}else n>t&&i._conditionalBranches.splice(0,n-t);i._cdr.markForCheck()}))},e.prototype._handleVisibilityChange=function(e){var i=this;this._visibilitySub=e.valueChanges.pipe(O.distinctUntilChanged((function(e,i){return e.visibilityOpt===i.visibilityOpt}))).subscribe((function(t){var n;switch(t.visibilityOpt){case"always":n=w.alwaysCondition().condition;break;case"never":n=w.neverCondition().condition;break;default:n=null}i._curVisibility=n,e.controls.visibility.setValue(n)})),this._visibilitySub=e.valueChanges.pipe(O.filter((function(e){return"condition"===e.visibilityOpt})),O.distinctUntilChanged((function(e,i){return e.visibility===i.visibility}))).subscribe((function(e){i._curVisibility=e.visibility,i._cdr.markForCheck()}))},e.prototype._guessVisibilityOpt=function(e){return 0===e.condition.localeCompare(w.alwaysCondition().condition)?"always":0===e.condition.localeCompare(w.neverCondition().condition)?"never":"condition"},e}();de.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-properties",template:'<div [style.display]="(enabled|async) ? \'none\' : \'block\'" class="ajf-disabled-overlay"></div>\n<div class="ajf-header">\n  <h3 translate>Properties</h3>\n  <mat-icon (click)="save()">save</mat-icon>\n  <mat-icon (click)="cancel()">cancel</mat-icon>\n</div>\n<ng-container *ngIf="nodeEntry|async as ne">\n  <ng-container *ngIf="propertiesForm|async as pf">\n    <form [formGroup]="pf!" novalidate>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <input matInput formControlName="name" [placeholder]="\'Name\' | translate">\n        </mat-form-field>\n      </div>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <input matInput formControlName="label" [placeholder]="\'Label\' | translate">\n        </mat-form-field>\n      </div>\n      <div class="ajf-prop">\n        <mat-form-field>\n          <mat-label translate>Visibility</mat-label>\n          <mat-select\n              formControlName="visibilityOpt" [placeholder]="\'Visible\' | translate">\n            <mat-option value="always" translate>Always</mat-option>\n            <mat-option value="never" translate>Never</mat-option>\n            <mat-option value="condition" translate>Condition...</mat-option>\n          </mat-select>\n        </mat-form-field>\n        <button (click)="editVisibility()"\n            [disabled]="pf!.value.visibilityOpt != \'condition\'"\n            mat-raised-button [matTooltip]="curVisibility || \'\'">\n          <div class="ajf-icon-cont">\n            <mat-icon>edit</mat-icon>\n            <span>{{ curVisibility }}</span>\n          </div>\n        </button>\n      </div>\n      <div class="ajf-prop">\n        <div><label translate>Branches</label></div>\n        <div>\n          <mat-slider formControlName="conditionalBranchesNum"\n              thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n        </div>\n        <div *ngFor="let branch of conditionalBranches; let idx = index">\n          <button (click)="editConditionalBranch(idx)" mat-raised-button [matTooltip]="branch">\n            <div class="ajf-icon-cont">\n              <mat-icon>edit</mat-icon>\n              <span>{{ branch }}</span>\n            </div>\n          </button>\n        </div>\n      </div>\n      <ng-template [ngIf]="isRepeatingContainerNode(ne)">\n        <div class="ajf-prop">\n          <div><label translate>Repetitions</label></div>\n          <div>\n            <button (click)="editFormulaReps()" mat-raised-button [matTooltip]="curFormulaReps || \'\'">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curFormulaReps }}</span>\n              </div>\n            </button>\n          </div>\n          <div><label translate>Min repetitions</label></div>\n          <div>\n            <mat-slider formControlName="minReps"\n                thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n          </div>\n          <div><label translate>Max repetitions</label></div>\n          <div>\n            <mat-slider formControlName="maxReps"\n                thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider>\n          </div>\n        </div>\n      </ng-template>\n      <ng-template [ngIf]="isField(ne)">\n        <div class="ajf-prop">\n          <mat-form-field>\n            <mat-label translate>Field size</mat-label>\n            <mat-select formControlName="size"\n                [placeholder]="\'Size\' | translate">\n              <mat-option *ngFor="let fieldSize of fieldSizes"\n                [value]="fieldSize.value">\n                {{ fieldSize.label }}\n              </mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <mat-form-field>\n            <input matInput formControlName="hint" [placeholder]="\'Hint\' | translate">\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <mat-form-field>\n            <textarea matInput formControlName="description"\n                [placeholder]="\'Description\' | translate"></textarea>\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <mat-form-field>\n            <input matInput formControlName="defaultValue"\n              [placeholder]="\'Default value\' | translate">\n          </mat-form-field>\n        </div>\n        <div class="ajf-prop">\n          <div><label translate>Formula</label></div>\n          <div>\n            <button (click)="editFormula()" mat-raised-button [matTooltip]="curFormula || \'\'">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curFormula }}</span>\n              </div>\n            </button>\n          </div>\n        </div>\n        \x3c!-- <div class="ajf-prop">\n          <div><label translate>Force value</label></div>\n          <div>\n            <button (click)="editForceValue()" mat-raised-button [matTooltip]="curForceValue">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ curForceValue }}</span>\n              </div>\n            </button>\n          </div>\n        </div> --\x3e\n        <div class="ajf-prop">\n          <mat-checkbox formControlName="notEmpty" translate>Not empty</mat-checkbox>\n        </div>\n        <ng-template [ngIf]="isNumericField(ne!.node)">\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="minValue"\n                [placeholder]="\'Min value\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="maxValue"\n                [placeholder]="\'Max value\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="minDigits"\n                [placeholder]="\'Min digits\' | translate">\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <mat-form-field>\n              <input matInput formControlName="maxDigits"\n                [placeholder]="\'Max digits\' | translate">\n            </mat-form-field>\n          </div>\n        </ng-template>\n        <div class="ajf-prop">\n          <div class="ajf-header">\n            <label>{{ \'Validation\' | translate }}</label>\n            <mat-icon class="ajf-pointer" (click)="addValidationCondition()">add_circle_outline</mat-icon>\n          </div>\n          <div *ngIf="validationConditions == null || validationConditions.length == 0"\n              class="ajf-validation-row ajf-emph" translate>No conditions</div>\n          <div class="ajf-validation-row" *ngFor="let validationCondition of validationConditions; let idx = index">\n            <button (click)="editValidationCondition(idx)"\n                mat-raised-button [matTooltip]="validationCondition.condition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ validationCondition.condition }}</span>\n              </div>\n            </button>\n            <mat-icon class="ajf-pointer" (click)="removeValidationCondition(idx)">remove_circle_outline</mat-icon>\n          </div>\n        </div>\n        <div class="ajf-prop">\n          <mat-checkbox formControlName="notEmptyWarning" translate>Not empty warning</mat-checkbox>\n        </div>\n        <div class="ajf-prop">\n          <div class="ajf-header">\n            <label translate>Warnings</label>\n            <mat-icon class="ajf-pointer" (click)="addWarningCondition()">add_circle_outline</mat-icon>\n          </div>\n          <div  *ngIf="warningConditions == null || warningConditions.length == 0"\n              class="ajf-validation-row ajf-emph" translate>No warnings</div>\n          <div class="ajf-validation-row" *ngFor="let warningCondition of warningConditions; let idx = index">\n            <button (click)="editWarningCondition(idx)"\n                mat-raised-button [matTooltip]="warningCondition.condition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ warningCondition.condition }}</span>\n              </div>\n            </button>\n            <mat-icon class="ajf-pointer" (click)="removeWarningCondition(idx)">remove_circle_outline</mat-icon>\n          </div>\n        </div>\n        <div class="ajf-prop">\n          <div><label translate>Go to next slide condition</label></div>\n          <div>\n            <button (click)="editNextSlideCondition()" mat-raised-button [matTooltip]="nextSlideCondition">\n              <div class="ajf-icon-cont">\n                <mat-icon>edit</mat-icon>\n                <span>{{ nextSlideCondition }}</span>\n              </div>\n            </button>\n          </div>\n        </div>\n        <ng-template [ngIf]="isFieldWithChoices(ne!.node)">\n          <div class="ajf-prop">\n            <mat-form-field>\n              <mat-label translate>Choices origins</mat-label>\n              <mat-select formControlName="choicesOriginRef" [placeholder]="\'Choices\' | translate">\n                <mat-option *ngFor="let choicesOrigin of choicesOrigins" [value]="choicesOrigin.name">\n                  {{ choicesOrigin.label || choicesOrigin.name }}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n          </div>\n          <div class="ajf-prop">\n            <div><label translate>Choices filter</label></div>\n            <div>\n              <button (click)="editChoicesFilter()" mat-raised-button [matTooltip]="curChoicesFilter">\n                <div class="ajf-icon-cont">\n                  <mat-icon>edit</mat-icon>\n                  <span>{{ curChoicesFilter }}</span>\n                </div>\n              </button>\n            </div>\n          </div>\n          <div class="ajf-prop">\n            <mat-checkbox formControlName="forceExpanded" translate>Force expanded selection</mat-checkbox>\n          </div>\n          <div class="ajf-prop">\n            <mat-checkbox formControlName="forceNarrow" translate>Force narrow selection</mat-checkbox>\n          </div>\n          <div class="ajf-prop">\n            <div class="ajf-header">\n              <label translate>Trigger selection</label>\n              <mat-icon class="ajf-pointer" (click)="addTriggerCondition()">add_circle_outline</mat-icon>\n            </div>\n            <div *ngIf="triggerConditions == null || triggerConditions.length == 0"\n                class="ajf-validation-row ajf-emph" translate>No trigger condition </div>\n            <div class="ajf-validation-row" *ngFor="let triggerCondition of triggerConditions; let idx = index">\n              <button (click)="editTriggerCondition(idx)"\n                  mat-raised-button [matTooltip]="triggerCondition">\n                <div class="ajf-icon-cont">\n                  <mat-icon>edit</mat-icon>\n                  <span>{{ triggerCondition }}</span>\n                </div>\n              </button>\n              <mat-icon class="pointer" (click)="removeTriggerCondition(idx)">remove_circle_outline</mat-icon>\n            </div>\n          </div>\n        </ng-template>\n      </ng-template>\n    </form>\n  </ng-container>\n</ng-container>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-properties{display:block;padding:1em;position:relative}ajf-fb-node-properties mat-icon{cursor:pointer}ajf-fb-node-properties .ajf-header{display:flex;flex-direction:row;align-items:center;flex-wrap:nowrap}ajf-fb-node-properties .ajf-header>h3,ajf-fb-node-properties .ajf-header>label{flex:1 0 auto;margin-right:.5em}ajf-fb-node-properties .ajf-header>mat-icon{flex:0 0 auto;margin-left:.5em}ajf-fb-node-properties .ajf-disabled-overlay{position:absolute;top:0;right:0;bottom:0;left:0;opacity:.4;background-color:#fff}ajf-fb-node-properties .ajf-emph{font-style:italic}ajf-fb-node-properties [mat-raised-button]{margin:.5em 0}ajf-fb-node-properties [mat-raised-button].ajf-pointer{cursor:pointer}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont{display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont span{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;display:block;min-height:36px}ajf-fb-node-properties .ajf-validation-row{margin:.5em 0;display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties .ajf-validation-row button{flex:1 1 auto}ajf-fb-node-properties .ajf-validation-row mat-icon{flex:0 0 auto}ajf-fb-node-properties .ajf-prop{margin:.5em 0}ajf-fb-node-properties mat-form-field,ajf-fb-node-properties mat-slider,ajf-fb-node-properties [mat-raised-button]{width:100%}\n"]}]}],de.ctorParameters=function(){return[{type:r.ChangeDetectorRef},{type:$},{type:p.MatDialog},{type:a.FormBuilder}]};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var ce,ue=function(){function e(e){this._cdr=e}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return this._nodeType},set:function(e){this._nodeType=e,this._cdr.markForCheck()},enumerable:!1,configurable:!0}),e}();ue.decorators=[{type:r.Component,args:[{selector:"ajf-fb-node-type-entry",template:'<ng-container *ngIf="nodeType">\n  <mat-icon\n    [fontSet]="nodeType.icon.fontSet" [fontIcon]="nodeType.icon.fontIcon"></mat-icon>\n  {{ nodeType.label }}\n</ng-container>\n',encapsulation:r.ViewEncapsulation.None,changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["ajf-fb-node-type-entry{display:block;padding:1em 1.5em}ajf-fb-node-type-entry mat-icon{vertical-align:middle}\n"]}]}],ue.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},ue.propDecorators={nodeType:[{type:r.Input}]},(ce=function ce(){}).decorators=[{type:r.NgModule,args:[{imports:[i.AjfMonacoEditorModule,t.AjfNodeIconModule,o.CommonModule,n.DragDropModule,a.FormsModule,s.MatAutocompleteModule,l.MatButtonModule,d.MatCardModule,c.MatCheckboxModule,u.MatChipsModule,p.MatDialogModule,h.MatFormFieldModule,m.MatIconModule,g.MatInputModule,b.MatListModule,_.MatMenuModule,v.MatSelectModule,y.MatSidenavModule,j.MatSliderModule,S.MatTableModule,E.MatToolbarModule,x.MatTooltipModule,a.ReactiveFormsModule,D.TranslateModule,f.MatExpansionModule,C.MatSlideToggleModule],declarations:[P,L,G,J,K,ne,de,ue,ee,oe,re,ie],exports:[ie],providers:[$]}]}],
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
e.AjfFormBuilder=ie,e.AjfFormBuilderModule=ce,e.AjfFormBuilderService=$,e.disableFieldDropPredicate=X,e.disableSlideDropPredicate=Q,e.flattenNodes=U,e.onDropProcess=Z,e.ɵgc_ajf_src_material_form_builder_form_builder_a=P,e.ɵgc_ajf_src_material_form_builder_form_builder_b=L,e.ɵgc_ajf_src_material_form_builder_form_builder_c=G,e.ɵgc_ajf_src_material_form_builder_form_builder_d=J,e.ɵgc_ajf_src_material_form_builder_form_builder_e=K,e.ɵgc_ajf_src_material_form_builder_form_builder_f=ne,e.ɵgc_ajf_src_material_form_builder_form_builder_g=de,e.ɵgc_ajf_src_material_form_builder_form_builder_h=ue,e.ɵgc_ajf_src_material_form_builder_form_builder_i=ee,e.ɵgc_ajf_src_material_form_builder_form_builder_j=oe,e.ɵgc_ajf_src_material_form_builder_form_builder_k=re,Object.defineProperty(e,"__esModule",{value:!0})}));