/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/cdk/drag-drop"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/checkbox"),require("@angular/material/dialog"),require("@angular/material/form-field"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/list"),require("@angular/material/menu"),require("@angular/material/select"),require("@angular/material/sidenav"),require("@angular/material/slider"),require("@angular/material/table"),require("@angular/material/toolbar"),require("@angular/material/tooltip"),require("@ngx-translate/core"),require("@ajf/material/monaco-editor"),require("@ajf/material/node-icon"),require("rxjs/operators"),require("@ajf/core/forms"),require("@angular/cdk/collections"),require("rxjs"),require("@ajf/core/models"),require("@ajf/core/utils")):"function"==typeof define&&define.amd?define("@ajf/material/form-builder",["exports","@angular/common","@angular/core","@angular/forms","@angular/cdk/drag-drop","@angular/material/button","@angular/material/card","@angular/material/checkbox","@angular/material/dialog","@angular/material/form-field","@angular/material/icon","@angular/material/input","@angular/material/list","@angular/material/menu","@angular/material/select","@angular/material/sidenav","@angular/material/slider","@angular/material/table","@angular/material/toolbar","@angular/material/tooltip","@ngx-translate/core","@ajf/material/monaco-editor","@ajf/material/node-icon","rxjs/operators","@ajf/core/forms","@angular/cdk/collections","rxjs","@ajf/core/models","@ajf/core/utils"],t):t(((i=i||self).ajf=i.ajf||{},i.ajf.material=i.ajf.material||{},i.ajf.material.formBuilder={}),i.ng.common,i.ng.core,i.ng.forms,i.ng.cdk.dragDrop,i.ng.material.button,i.ng.material.card,i.ng.material.checkbox,i.ng.material.dialog,i.ng.material.formField,i.ng.material.icon,i.ng.material.input,i.ng.material.list,i.ng.material.menu,i.ng.material.select,i.ng.material.sidenav,i.ng.material.slider,i.ng.material.table,i.ng.material.toolbar,i.ng.material.tooltip,i.ngxt.core,i.ajf.material.monacoEditor,i.ajf.material.nodeIcon,i.rxjs.operators,i.ajf.core.forms,i.ng.cdk.collections,i.rxjs,i.ajf.core.models,i.ajf.core.utils)}(this,function(i,t,o,E,e,n,r,a,s,l,d,c,u,p,f,h,g,m,b,v,_,y,C,S,x,j,F,D,O){"use strict";var N=function(i,t){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])})(i,t)};var T=function(){return(T=Object.assign||function(i){for(var t,e=1,n=arguments.length;e<n;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o]);return i}).apply(this,arguments)},w=(Object.defineProperty(V.prototype,"offset",{set:function(i){this._offset=i,this._updateOffset()},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"color",{set:function(i){this._color=i,this._updateColor()},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"height",{set:function(i){this._height=i,this._updateHeight()},enumerable:!0,configurable:!0}),V.prototype._updateHeight=function(){var i=Math.max(0,this._height-25)+"px";this._renderer.setStyle(this._el.nativeElement,"height",i)},V.prototype._updateOffset=function(){var i=4*this._offset+"px";this._renderer.setStyle(this._el.nativeElement,"margin-top",i),this._renderer.setStyle(this._el.nativeElement,"margin-left",i)},V.prototype._updateColor=function(){this._renderer.setStyle(this._el.nativeElement,"border-color",this._color)},V.decorators=[{type:o.Component,args:[{selector:"ajf-fb-branch-line",template:"",styles:["ajf-fb-branch-line{display:block;position:absolute;top:25px;left:25px;width:25px;border-top:2px solid;border-left:2px solid;border-top-left-radius:6px}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],V.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2}]},V.propDecorators={offset:[{type:o.Input}],color:[{type:o.Input}],height:[{type:o.Input}]},V);function V(i,t){this._el=i,this._renderer=t,this._offset=0,this._height=0}var M,P,I,A=(I=j.DataSource,N(M=k,P=I),void(M.prototype=null===P?Object.create(P):(R.prototype=P.prototype,new R)),k.prototype.connect=function(){return this._choicesObs},k.prototype.disconnect=function(){},k.prototype.updateChoices=function(i){this._choices.next(i)},k);function R(){this.constructor=M}function k(){var i=I.call(this)||this;return i._choices=new F.BehaviorSubject([]),i._choicesObs=i._choices.asObservable(),i}var B=(Object.defineProperty(W.prototype,"displayedColumns",{get:function(){return this._displayedColumns},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},set:function(i){this._choicesOrigin=i,this.name=i.name,this.label=i.label,this.canEditChoices=x.isChoicesFixedOrigin(i),this._choicesArr=i.choices,this._choices.updateChoices(this._choicesArr)},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"choices",{get:function(){return this._choices},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"choicesArr",{get:function(){return this._choicesArr},enumerable:!0,configurable:!0}),W.prototype.updateValue=function(i,t,e,n){this.editing[n+"-"+t]=!1,this._choicesArr[n][t]=i.target.value,this._choices.updateChoices(this._choicesArr)},W.prototype.deleteRow=function(i){this._choicesArr.splice(i,1),this._choices.updateChoices(this._choicesArr)},W.prototype.addRow=function(){this._choicesArr.push({label:"",value:""}),this._choices.updateChoices(this._choicesArr)},W.decorators=[{type:o.Component,args:[{selector:"ajf-fb-choices-origin-editor",template:'<div><mat-form-field><input matInput [(ngModel)]="name" [placeholder]="\'Name\' | translate"></mat-form-field><mat-form-field><input matInput [(ngModel)]="label" [placeholder]="\'Label\' | translate"></mat-form-field><ng-template [ngIf]="canEditChoices"><button (click)="addRow()" mat-button><mat-icon>add</mat-icon><span translate>Add value</span></button><mat-table [dataSource]="choices"><ng-container matColumnDef="label"><mat-header-cell *matHeaderCellDef translate>Label</mat-header-cell><mat-cell *matCellDef="let row; let idx = index"><span [title]="\'Double click to edit\' | translate" (dblclick)="editing[idx + \'-label\'] = true" *ngIf="!editing[idx + \'-label\']"><span *ngIf="row.label">{{ row.label }}</span> <span *ngIf="!row.label" translate>(no label)</span> </span><input autofocus #in1 (blur)="updateValue($event, \'label\', in1.value, idx)" *ngIf="editing[idx + \'-label\']" type="text" [value]="row.label"></mat-cell></ng-container><ng-container matColumnDef="value"><mat-header-cell *matHeaderCellDef translate>Value</mat-header-cell><mat-cell *matCellDef="let row; let idx = index"><span [title]="\'Double click to edit\' | translate" (dblclick)="editing[idx + \'-value\'] = true" *ngIf="!editing[idx + \'-value\']"><span *ngIf="row.value">{{ row.value }}</span> <span *ngIf="!row.value" translate>(no value)</span> </span><input autofocus #in2 (blur)="updateValue($event, \'value\', in2.value, idx)" *ngIf="editing[idx + \'-value\']" type="text" [value]="row.value"></mat-cell></ng-container><ng-container matColumnDef="delete"><mat-header-cell *matHeaderCellDef translate>Delete</mat-header-cell><mat-cell *matCellDef="let row; let idx = index"><mat-icon (click)="deleteRow(idx)">delete</mat-icon></mat-cell></ng-container><mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row><mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row></mat-table></ng-template></div>',styles:["ajf-fb-choices-origin-editor mat-form-field+mat-form-field{margin-left:1em}ajf-fb-choices-origin-editor mat-table{max-height:300px}ajf-fb-choices-origin-editor mat-table mat-icon{cursor:pointer}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],W.propDecorators={choicesOrigin:[{type:o.Input}]},W);function W(){this._displayedColumns=["label","value","delete"],this.editing={},this._choices=new A,this._choicesArr=[]}function L(i,t){if(-1<i.nodes.indexOf(t))return i;for(var e=i.nodes.filter(function(i){return x.isContainerNode(i)}),n=e.length,o=0;o<n;o++){var r=L(e[o],t);if(null!=r)return r}return null}function Y(t,e,i){void 0===i&&(i=!1);var n=t.filter(function(i){return i.parent===e.id}).sort(function(i,t){return i.parentNode-t.parentNode}).map(function(i){return{node:i,children:Y(t,i),content:U(t,i)}});if(!i)for(var o=n.length,r=e.conditionalBranches.length,a=o;a<r;a++)n.push({parent:e,parentNode:a});return n}function U(i,t){return x.isContainerNode(t)?Y(t.nodes,t,!0):[]}function q(i){var t=[];return i.forEach(function(i){x.isContainerNode(i)&&(t=t.concat(q(i.nodes))),t.push(i)}),t}function z(i,t,e){return void 0===e&&(e=null),null!=e?i.filter(function(i){return i.parent===t.id&&i.parentNode===e}):i.filter(function(i){return i.parent===t.id})}function H(i,t,e){void 0===e&&(e=null);for(var n=q(i),o=[],r=z(n,t,e),a=r.length,s=0;s<a;s++)o=o.concat(z(n,r[s]));return function i(t,e){for(var n=t.length,o=0;o<n;o++){var r=t[o];if(x.isContainerNode(r)){var a=r;a.nodes=i(a.nodes,e)}}return t.filter(function(i){return-1===e.indexOf(i.id)})}(i,(o=o.concat(r)).map(function(i){return i.id}))}var $=0,J=(Object.defineProperty(Z.prototype,"availableNodeTypes",{get:function(){return this._availableNodeTypes},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"form",{get:function(){return this._formObs},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"attachmentsOrigins",{get:function(){return this._attachmentsOrigins},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"flatNodes",{get:function(){return this._flatNodes},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"flatFields",{get:function(){return this._flatFields},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"editedNodeEntry",{get:function(){return this._editedNodeEntryObs},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"editedCondition",{get:function(){return this._editedConditionObs},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"editedChoicesOrigin",{get:function(){return this._editedChoicesOriginObs},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"beforeNodesUpdate",{get:function(){return this._beforeNodesUpdateObs},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"afterNodeUpdate",{get:function(){return this._afterNodeUpdateObs},enumerable:!0,configurable:!0}),Z.prototype.setForm=function(i){i!==this._form.getValue()&&this._form.next(i)},Z.prototype.editNodeEntry=function(i){this._editedNodeEntry.next(i)},Z.prototype.editCondition=function(i){this._editedCondition.next(i)},Z.prototype.saveCurrentCondition=function(i){var t=this._editedCondition.getValue();null!=t&&(t.condition=i,this._editedCondition.next(null))},Z.prototype.cancelConditionEdit=function(){this._editedChoicesOrigin.next(null)},Z.prototype.insertNode=function(i,n,t,o){var r;void 0===o&&(o=!1);var e=++$,a=null!=i.nodeType.field;r=a?x.createField({id:e,nodeType:x.AjfNodeType.AjfField,fieldType:i.nodeType.field,parent:n.id,parentNode:t,name:""}):x.createNode({id:e,nodeType:i.nodeType.node,parent:n.id,parentNode:t,name:""}),this._beforeNodesUpdate.emit(),this._nodesUpdates.next(function(i){var t=x.isContainerNode(n)&&o?n:L({nodes:i},n);if(null!=t)if(a)t.nodes.push(r);else{var e=t.nodes.slice(0);e.push(r),t.nodes=e}return i})},Z.prototype.saveNodeEntry=function(i){this._saveNodeEntryEvent.emit(i)},Z.prototype.cancelNodeEntryEdit=function(){this._editedNodeEntry.next(null)},Z.prototype.deleteNodeEntry=function(i){this._deleteNodeEntryEvent.next(i)},Z.prototype.getCurrentForm=function(){return this._form.pipe(S.withLatestFrom(this._nodes),S.filter(function(i){return null!=i[0]}),S.map(function(i){var t=i[0],e=i[1];return x.createForm({choicesOrigins:t.choicesOrigins.slice(0),attachmentsOrigins:t.attachmentsOrigins.slice(0),stringIdentifier:t.stringIdentifier.slice(0),nodes:e.slice(0)})}))},Z.prototype.editChoicesOrigin=function(i){this._editedChoicesOrigin.next(i)},Z.prototype.createChoicesOrigin=function(){this._editedChoicesOrigin.next(x.createChoicesFixedOrigin({name:""}))},Z.prototype.cancelChoicesOriginEdit=function(){this._editedChoicesOrigin.next(null)},Z.prototype.saveChoicesOrigin=function(i){var t=this._editedChoicesOrigin.getValue();null!=t&&(t.label=i.label,t.name=i.name,x.isChoicesFixedOrigin(t)&&(t.choices=i.choices)),this._editedChoicesOrigin.next(null)},Z.prototype._findMaxNodeId=function(i,t){var e=this,n=0;return i.forEach(function(i){n=Math.max(n,i.id),x.isContainerNode(i)&&(n=Math.max(n,e._findMaxNodeId(i.nodes)))}),n},Z.prototype._initFormStreams=function(){var i=this;this._form.subscribe(function(t){$=0,null!=t&&null!=t.nodes&&0<t.nodes.length&&($=i._findMaxNodeId(t.nodes)),i._nodesUpdates.next(function(i){return null!=t&&null!=t.nodes?t.nodes.slice(0):[]}),i._attachmentsOriginsUpdates.next(function(i){return null!=t&&null!=t.attachmentsOrigins?t.attachmentsOrigins.slice(0):[]}),i._choicesOriginsUpdates.next(function(i){return null!=t&&null!=t.choicesOrigins?t.choicesOrigins.slice(0):[]})})},Z.prototype._initChoicesOriginsStreams=function(){this._choicesOrigins=this._choicesOriginsUpdates.pipe(S.scan(function(i,t){return t(i)},[]),S.publishReplay(1),S.refCount())},Z.prototype._initAttachmentsOriginsStreams=function(){this._attachmentsOrigins=this._attachmentsOriginsUpdates.pipe(S.scan(function(i,t){return t(i)},[]),S.publishReplay(1),S.refCount())},Z.prototype._initNodesStreams=function(){this._nodes=this._nodesUpdates.pipe(S.scan(function(i,t){return t(i)},[]),S.publishReplay(1),S.refCount()),this._flatNodes=this._nodes.pipe(S.map(function(i){return q(i)}),S.publishReplay(1),S.refCount()),this._flatFields=this._flatNodes.pipe(S.map(function(i){return i.filter(function(i){return!x.isContainerNode(i)})}),S.publishReplay(1),S.refCount()),this._nodeEntriesTree=this._nodes.pipe(S.map(function(i){return function(i){var t=i.filter(function(i){return null==i.parent||0===i.parent});if(1===t.length){var e=t[0];if(x.isSlidesNode(e)){var n=[];return n.push({node:e,container:null,children:Y(i,e),content:U(0,e)}),n}}else if(0===t.length)return[null];throw new Error("Invalid form definition")}(i)}),S.publishReplay(1),S.refCount())},Z.prototype._initSaveNode=function(){var F=this;this._saveNodeEntryEvent.pipe(S.withLatestFrom(this.editedNodeEntry,this.choicesOrigins,this.attachmentsOrigins),S.filter(function(i){return null!=i[1]}),S.map(function(i){F._beforeNodesUpdate.emit();var t=i[0],e=i[1],n=i[2],r=e.node,a=O.deepCopy(r);a.id=e.node.id,a.name=t.name,a.label=t.label,a.visibility=null!=t.visibility?D.createCondition({condition:t.visibility}):null;var s=a.conditionalBranches.length;a.conditionalBranches=null!=t.conditionalBranches?t.conditionalBranches.map(function(i){return D.createCondition({condition:i})}):[D.alwaysCondition()];var l=a.conditionalBranches.length;if(x.isRepeatingContainerNode(a)){var o=a;o.formulaReps=null!=t.formulaReps?D.createFormula({formula:t.formulaReps}):void 0,o.minReps=t.minReps,o.maxReps=t.maxReps}if(x.isField(e.node)){var d=e.node;d.description=t.description,d.defaultValue=t.defaultValue,d.formula=null!=t.formula?D.createFormula({formula:t.formula}):void 0;var c=t.value,u=t.notEmpty,p=t.validationConditions,f=parseInt(t.minValue,10),h=parseInt(t.maxValue,10),g=parseInt(t.minDigits,10),m=parseInt(t.maxDigits,10);if(isNaN(f)&&(f=null),isNaN(h)&&(h=null),isNaN(g)&&(g=null),isNaN(m)&&(m=null),null!=c||null!=u||null!=p&&0<p.length||null!=f||null!=h||null!=g||null!=m){var b=d.validation||x.createValidationGroup({});b.forceValue=c,b.notEmpty=u?x.notEmptyValidation():void 0,b.minValue=null!=f?x.minValidation(f):void 0,b.maxValue=null!=h?x.maxValidation(h):void 0,b.minDigits=null!=g?x.minDigitsValidation(g):void 0,b.maxDigits=null!=m?x.maxDigitsValidation(m):void 0,b.conditions=(p||[]).map(function(i){return x.createValidation({condition:i.condition,errorMessage:i.errorMessage})}),d.validation=b}else d.validation=void 0;var v=t.notEmptyWarning,_=t.warningConditions;if(null!=v||null!=_&&0<_.length){var y=d.warning||x.createWarningGroup({});y.notEmpty=v?x.notEmptyWarning():void 0,y.conditions=(_||[]).map(function(i){return x.createWarning({condition:i.condition,warningMessage:i.warningMessage})}),d.warning=y}else d.warning=void 0;if(d.nextSlideCondition=null!=t.nextSlideCondition?D.createCondition({condition:t.nextSlideCondition}):void 0,x.isFieldWithChoices(d)){for(var C=d,j=null,E=0,S=n.length;null==j&&E<S;)n[E].name===t.choicesOrigin&&(j=n[E]),E++;null!=j&&(C.choicesOrigin=j),C.forceExpanded=t.forceExpanded,C.forceNarrow=t.forceNarrow,C.triggerConditions=(t.triggerConditions||[]).map(function(i){return D.createCondition({condition:i})})}}return F._editedNodeEntry.next(null),function(i){var t=L({nodes:i},r);if(null!=t){var e=t.nodes.indexOf(r),n=t.nodes.slice(0,e);if(n.push(a),n=n.concat(t.nodes.slice(e+1)),t.nodes=n,i=i.slice(0),l<s)for(var o=l;o<s;o++)i=H(i,a,o)}return i}})).subscribe(this._nodesUpdates)},Z.prototype._initDeleteNode=function(){var i=this;this._deleteNodeEntryEvent.pipe(S.map(function(r){return i._beforeNodesUpdate.emit(),function(i){var t=r.node,e=L({nodes:i},t);if(null!=e){var n=e.nodes.indexOf(t),o=e.nodes.slice(0,n);o=o.concat(e.nodes.slice(n+1)),e.nodes=o,i=H(i=i.slice(0),t)}return i}})).subscribe(this._nodesUpdates)},Z.decorators=[{type:o.Injectable}],Z.ctorParameters=function(){return[]},Z);function Z(){this._availableNodeTypes=[{label:"Slide",icon:{fontSet:"ajf-icon",fontIcon:"field-slide"},nodeType:{node:x.AjfNodeType.AjfSlide},isSlide:!0},{label:"Repeating slide",icon:{fontSet:"ajf-icon",fontIcon:"field-repeatingslide"},nodeType:{node:x.AjfNodeType.AjfRepeatingSlide},isSlide:!0},{label:"String",icon:{fontSet:"ajf-icon",fontIcon:"field-string"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.String}},{label:"Text",icon:{fontSet:"ajf-icon",fontIcon:"field-text"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Text}},{label:"Number",icon:{fontSet:"ajf-icon",fontIcon:"field-number"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Number}},{label:"Boolean",icon:{fontSet:"ajf-icon",fontIcon:"field-boolean"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Boolean}},{label:"Single choice",icon:{fontSet:"ajf-icon",fontIcon:"field-singlechoice"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.SingleChoice}},{label:"Multiple choice",icon:{fontSet:"ajf-icon",fontIcon:"field-multiplechoice"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.MultipleChoice}},{label:"Formula",icon:{fontSet:"ajf-icon",fontIcon:"field-formula"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Formula}},{label:"Date",icon:{fontSet:"ajf-icon",fontIcon:"field-date"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Date}},{label:"Date input",icon:{fontSet:"ajf-icon",fontIcon:"field-dateinput"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.DateInput}},{label:"Time",icon:{fontSet:"ajf-icon",fontIcon:"field-time"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Time}},{label:"Table",icon:{fontSet:"ajf-icon",fontIcon:"field-table"},nodeType:{node:x.AjfNodeType.AjfField,field:x.AjfFieldType.Table}}],this._form=new F.BehaviorSubject(null),this._formObs=this._form.asObservable(),this._editedNodeEntry=new F.BehaviorSubject(null),this._editedNodeEntryObs=this._editedNodeEntry.asObservable(),this._editedCondition=new F.BehaviorSubject(null),this._editedConditionObs=this._editedCondition.asObservable(),this._editedChoicesOrigin=new F.BehaviorSubject(null),this._editedChoicesOriginObs=this._editedChoicesOrigin.asObservable(),this._beforeNodesUpdate=new o.EventEmitter,this._beforeNodesUpdateObs=this._beforeNodesUpdate.asObservable(),this._afterNodeUpdate=new o.EventEmitter,this._afterNodeUpdateObs=this._afterNodeUpdate.asObservable(),this._nodesUpdates=new F.Subject,this._attachmentsOriginsUpdates=new F.Subject,this._choicesOriginsUpdates=new F.Subject,this._saveNodeEntryEvent=new o.EventEmitter,this._deleteNodeEntryEvent=new o.EventEmitter,this._initChoicesOriginsStreams(),this._initAttachmentsOriginsStreams(),this._initNodesStreams(),this._initFormStreams(),this._initSaveNode(),this._initDeleteNode()}var G=(Object.defineProperty(K.prototype,"choicesOrigin",{get:function(){return this._choicesOrigin},enumerable:!0,configurable:!0}),K.prototype.saveChoicesOrigin=function(){this._service.saveChoicesOrigin({label:this.editor.label,name:this.editor.name,choices:this.editor.choicesArr})},K.prototype.cancelChoicesOriginEdit=function(){this._service.cancelChoicesOriginEdit()},K.decorators=[{type:o.Component,args:[{selector:"ajf-fb-choices-origin-editor-dialog",template:'<h3 matDialogTitle translate>Edit choices origin</h3><mat-dialog-content><ajf-fb-choices-origin-editor [choicesOrigin]="choicesOrigin|async"></ajf-fb-choices-origin-editor></mat-dialog-content><mat-dialog-actions><button mat-button translate (click)="saveChoicesOrigin()">Save</button> <button mat-button translate (click)="cancelChoicesOriginEdit()">Close</button></mat-dialog-actions>',styles:[""],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],K.ctorParameters=function(){return[{type:J}]},K.propDecorators={editor:[{type:o.ViewChild,args:[B,{static:!0}]}]},K);function K(i){this._service=i,this._choicesOrigin=this._service.editedChoicesOrigin.pipe(S.filter(function(i){return null!=i}),S.map(function(i){return i}))}var Q=(Object.defineProperty(X.prototype,"fields",{get:function(){return this._fields},set:function(i){this._fields=i,this._updateVariables()},enumerable:!0,configurable:!0}),X.prototype.insertVariable=function(i){if(null!=this.monacoEditor&&null!=this.monacoEditor.editor){var t=this.monacoEditor.editor,e=t.getValue().split("\n"),n=t.getPosition(),o=n.lineNumber-1,r=e[o],a=n.column-1;r=r.substring(0,a)+i+r.substring(a),e[o]=r,n.column+=i.length,this.monacoEditor.value=e.join("\n"),t.setPosition(n),t.focus(),this.editedValue=t.getValue()}},X.prototype.onEditorInit=function(){monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES2015,allowNonTsExtensions:!0,allowJs:!0,module:monaco.languages.typescript.ModuleKind.None});try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-variables.d.ts")}catch(i){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=""}try{monaco.languages.typescript.javascriptDefaults.addExtraLib("","condition-editor-functions.d.ts")}catch(i){monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=""}this._updateVariables(),this._updateFunctions()},X.prototype._updateVariables=function(){var t=this;if(null!=this._fields)try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-variables.d.ts"]=this._fields.map(function(i){return"declare const "+i.name+": "+t._fieldVarType(i.fieldType)+";"}).join("\n")}catch(i){}},X.prototype._updateFunctions=function(){try{monaco.languages.typescript.javascriptDefaults._extraLibs["condition-editor-functions.d.ts"]=D.AjfExpressionUtils.UTIL_FUNCTIONS}catch(i){}},X.prototype._fieldVarType=function(i){switch(i){case x.AjfFieldType.Boolean:return"boolean";case x.AjfFieldType.Date:case x.AjfFieldType.DateInput:case x.AjfFieldType.Time:return"Date";case x.AjfFieldType.Empty:return"void";case x.AjfFieldType.Formula:return"number";case x.AjfFieldType.MultipleChoice:case x.AjfFieldType.SingleChoice:return"any";case x.AjfFieldType.Number:return"number";case x.AjfFieldType.Table:return"Array";case x.AjfFieldType.String:case x.AjfFieldType.Text:return"string"}return null},X.decorators=[{type:o.Component,args:[{selector:"ajf-condition-editor",template:'<div class="ajf-editor"><ajf-monaco-editor (init)="onEditorInit()" (valueChange)="editedValue = $event" [value]="condition" language="javascript"></ajf-monaco-editor></div><div class="ajf-editor-panel"><mat-nav-list dense *ngIf="fields?.length > 0"><a mat-list-item (click)="insertVariable(field.name)" [matTooltip]="field.label" *ngFor="let field of fields"><ajf-node-icon [node]="field"></ajf-node-icon>{{ field.name }}</a></mat-nav-list></div>',styles:["ajf-condition-editor{display:flex;flex-direction:row;align-items:stretch;max-height:512px}ajf-condition-editor .ajf-editor{flex:.75 0 auto;display:flex;flex-direction:row;align-items:stretch}ajf-condition-editor .ajf-editor monaco-editor{flex:1 0 auto;min-width:512px;min-height:256px}ajf-condition-editor .ajf-editor-panel{flex:.25 0 auto;overflow-y:auto}"],changeDetection:o.ChangeDetectionStrategy.OnPush,encapsulation:o.ViewEncapsulation.None}]}],X.ctorParameters=function(){return[{type:x.AjfValidationService}]},X.propDecorators={monacoEditor:[{type:o.ViewChild,args:[y.AjfMonacoEditor,{static:!0}]}],fields:[{type:o.Input}],condition:[{type:o.Input}]},X);function X(i){}var ii=(Object.defineProperty(ti.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),ti.prototype.saveCondition=function(){if(null!=this.editor){var i=this.editor.editedValue;this.dialogRef.close(i)}},ti.decorators=[{type:o.Component,args:[{selector:"ajf-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3><mat-dialog-content><ajf-condition-editor [fields]="fields|async" [condition]="condition"></ajf-condition-editor></mat-dialog-content><mat-dialog-actions><button mat-button translate (click)="saveCondition()">Save</button> <button mat-button translate matDialogClose>Close</button></mat-dialog-actions>',styles:["ajf-condition-editor-dialog mat-dialog-content{overflow:visible}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],ti.ctorParameters=function(){return[{type:J},{type:s.MatDialogRef}]},ti.propDecorators={editor:[{type:o.ViewChild,args:[Q,{static:!0}]}]},ti);function ti(i,t){this.dialogRef=t,this._fields=i.flatFields.pipe(S.map(function(i){return i.sort(function(i,t){return i.name.localeCompare(t.name)})}))}var ei=(Object.defineProperty(ni.prototype,"form",{get:function(){return this._form},set:function(i){this._form!==i&&(this._form=i,this._init&&this._setCurrentForm())},enumerable:!0,configurable:!0}),Object.defineProperty(ni.prototype,"nodeTypes",{get:function(){return this._nodeTypes},enumerable:!0,configurable:!0}),Object.defineProperty(ni.prototype,"nodeEntriesTree",{get:function(){return this._nodeEntriesTree},enumerable:!0,configurable:!0}),Object.defineProperty(ni.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!0,configurable:!0}),ni.prototype.ngAfterViewChecked=function(){this._vc.emit()},ni.prototype.ngAfterContentInit=function(){this._setCurrentForm(),this._init=!0},ni.prototype.ngOnDestroy=function(){this._service.setForm(null),this._editConditionSub.unsubscribe(),this._beforeNodesUpdateSub.unsubscribe(),this._editChoicesOriginSub.unsubscribe()},ni.prototype.createChoicesOrigin=function(){this._service.createChoicesOrigin()},ni.prototype.disableDropPredicate=function(){return!1},ni.prototype.editChoicesOrigin=function(i){this._service.editChoicesOrigin(i)},ni.prototype._setCurrentForm=function(){this._service.setForm(this._form)},ni.decorators=[{type:o.Component,args:[{selector:"ajf-form-builder",template:'<mat-toolbar><button mat-icon-button (click)="leftSidenav.toggle()"><mat-icon>add_box</mat-icon></button> <button mat-button [matMenuTriggerFor]="choicesMenu" translate>Choices</button><mat-menu #choicesMenu><button (click)="createChoicesOrigin()" mat-menu-item translate>New..</button><ng-container *ngIf="choicesOrigins|async as cos"><button *ngFor="let choicesOrigin of cos" (click)="editChoicesOrigin(choicesOrigin)" mat-menu-item>{{ choicesOrigin.label || choicesOrigin.name }}</button></ng-container></mat-menu><span class="ajf-spacer"></span> <button mat-icon-button (click)="rightSidenav.toggle()"><mat-icon>settings</mat-icon></button></mat-toolbar><mat-drawer-container cdkDropListGroup><mat-drawer #leftSidenav position="start" mode="over"><div #sourceDropList cdkDropList [cdkDropListEnterPredicate]="disableDropPredicate" [cdkDropListData]="nodeTypes"><ajf-fb-node-type-entry *ngFor="let nodeType of nodeTypes" cdkDrag [cdkDragData]="nodeType" (cdkDragStarted)="leftSidenav.close()" [nodeType]="nodeType"></ajf-fb-node-type-entry></div></mat-drawer><mat-drawer #rightSidenav position="end" mode="side" [opened]="true"><ajf-fb-node-properties></ajf-fb-node-properties></mat-drawer><div #designer class="ajf-designer"><ajf-fb-node-entry *ngFor="let nodeEntry of (nodeEntriesTree|async); let isFirst = first" [isFirst]="isFirst" [nodeEntry]="nodeEntry"></ajf-fb-node-entry></div></mat-drawer-container>',styles:["ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-button]{flex:1 0 auto}ajf-form-builder mat-toolbar mat-menu div[mat-menu-item]>button[mat-icon-button]{flex:0 0 auto}ajf-form-builder mat-drawer-container{height:700px}ajf-form-builder mat-drawer-container mat-drawer{max-width:20%}ajf-form-builder mat-drawer-container .ajf-designer{padding:1em;position:absolute;top:0;right:0;bottom:0;left:0;overflow-y:auto}ajf-form-builder mat-toolbar .ajf-spacer{flex:1 1 auto}"],changeDetection:o.ChangeDetectionStrategy.OnPush,encapsulation:o.ViewEncapsulation.None}]}],ni.ctorParameters=function(){return[{type:J},{type:s.MatDialog}]},ni.propDecorators={designerCont:[{type:o.ViewChild,args:["designer",{static:!0}]}],form:[{type:o.Input}]},ni);function ni(i,t){var e=this;this._service=i,this._dialog=t,this._vc=new o.EventEmitter,this._init=!1,this._editConditionSub=F.Subscription.EMPTY,this._beforeNodesUpdateSub=F.Subscription.EMPTY,this._editChoicesOriginSub=F.Subscription.EMPTY,this._nodeTypes=i.availableNodeTypes,this._nodeEntriesTree=i.nodeEntriesTree,this._choicesOrigins=i.choicesOrigins,this._editConditionSub=this._service.editedCondition.subscribe(function(i){null!=e._editConditionDialog&&(e._editConditionDialog.close(),e._editConditionDialog=null),null!=i&&(e._editConditionDialog=e._dialog.open(ii,{disableClose:!0}))}),this._editChoicesOriginSub=this._service.editedChoicesOrigin.subscribe(function(i){null!=e._editChoicesOriginDialog&&(e._editChoicesOriginDialog.close(),e._editChoicesOriginDialog=null),null!=i&&(e._editChoicesOriginDialog=e._dialog.open(G,{disableClose:!0}))}),this._beforeNodesUpdateSub=this._service.beforeNodesUpdate.subscribe(function(){null!=e.designerCont&&(e._lastScrollTop=e.designerCont.nativeElement.scrollTop)}),this.nodeEntriesTree.pipe(S.sample(this._vc)).subscribe(function(){null!=e.designerCont&&(e.designerCont.nativeElement.scrollTop=e._lastScrollTop)})}var oi=["#F44336","#4CAF50","#3F51B5","#FFC107","#795548"],ri=(Object.defineProperty(ai.prototype,"hasContent",{get:function(){return this._hasContent},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"isFirst",{get:function(){return this._isFirst},set:function(i){this._isFirst=i},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"isNodeEntry",{get:function(){return this._isNodeEntry},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"nodeEntry",{get:function(){return this._nodeEntry},set:function(i){if(null!=(this._nodeEntry=i)&&void 0!==i.node){var t=i;this._isNodeEntry=!0;var e=t.node;this._hasContent=null!=e&&x.isContainerNode(e),this._isSlide=x.isSlidesNode(i.parent)}else this._isNodeEntry=!1,this._hasContent=!1,this._isSlide=!1},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"realNodeEntry",{get:function(){return this._nodeEntry},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"branchColors",{get:function(){return this._branchColors},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"dropZones",{get:function(){return this._dropZones},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"slideDropZones",{get:function(){return this._slideDropZones},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"originOffset",{get:function(){return this._originOffset},set:function(i){this._originOffset=i,this._originLeftMargin=4*this._originOffset+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"originLeftMargin",{get:function(){return this._originLeftMargin},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"firstBranchColor",{get:function(){return this._firstBranchColor},set:function(i){var t=oi.indexOf(i);0<t?(this._firstBranchColor=i,this._branchColors=oi.slice(t).concat(oi.slice(0,t))):(this._firstBranchColor=oi[0],this._branchColors=oi.slice(0))},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"currentEditedNode",{get:function(){return this._currentEditedNode},enumerable:!0,configurable:!0}),ai.prototype.onResize=function(){},ai.prototype.edit=function(){null!=this.nodeEntry&&this.isNodeEntry&&this._service.editNodeEntry(this.nodeEntry)},ai.prototype.delete=function(){null!=this.nodeEntry&&this.isNodeEntry&&this._service.deleteNodeEntry(this.nodeEntry)},ai.prototype.ngAfterViewInit=function(){var i=this;setTimeout(function(){return i._updateBranchHeights()}),this._childEntriesSubscription=this.childEntries.changes.subscribe(function(){i._updateBranchHeights()})},ai.prototype.ngOnDestroy=function(){this._branchLinesSubscription.unsubscribe(),this._childEntriesSubscription.unsubscribe()},ai.prototype.onDropSuccess=function(i,t){if(void 0===t&&(t=!1),null!=this._nodeEntry){var e=i.item.data;if(void 0!==e.nodeType&&(!this.isNodeEntry||this.isNodeEntry&&t)){var n=t?{parent:this.nodeEntry.node,parentNode:0}:this._nodeEntry;this._service.insertNode(e,n.parent,n.parentNode,t)}}},ai.prototype.disableSlideDropPredicate=function(i){return!i.data.isSlide},ai.prototype.emptyAreaDropPredicate=function(i){return this._isSlide?i.data.isSlide||!1:!i.data.isSlide},ai.prototype._updateBranchHeights=function(){if(null!=this.nodeEntry&&this.isNodeEntry&&null!=this.branchLines&&null!=this.childEntries){var i=this.nodeEntry,t=this.branchLines.toArray(),e=null!=i.content?i.content.length:0,n=this.childEntries.toArray().slice(e);t.length==n.length&&t.forEach(function(i,t){var e=n[t];i.height=e.nativeElement.offsetTop})}},ai.decorators=[{type:o.Component,args:[{selector:"ajf-fb-node-entry",template:'<ng-template [ngIf]="nodeEntry != null"><ng-template [ngIf]="isNodeEntry"><ajf-fb-branch-line *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index" [offset]="idx" [color]="branchColors[idx]"></ajf-fb-branch-line></ng-template><div class="mat-card-container" [class.ajf-highlight]="(currentEditedNode|async) == nodeEntry"><div *ngIf="!isFirst" class="ajf-origin-line" [style.margin-left]="originLeftMargin" [style.border-color]="firstBranchColor"></div><ng-template [ngIf]="isNodeEntry"><mat-card><div class="ajf-title-row"><ajf-node-icon [node]="realNodeEntry.node"></ajf-node-icon><span class="ajf-title" [innerHTML]="(realNodeEntry.node.label || realNodeEntry.node.name)  | translate"></span> <span class="ajf-actions"><button [disabled]="currentEditedNode|async" (click)="edit()" mat-icon-button><mat-icon>edit</mat-icon></button> <button [disabled]="currentEditedNode|async" (click)="delete()" mat-icon-button><mat-icon>delete</mat-icon></button></span></div><div *ngIf="hasContent"><ajf-fb-node-entry *ngFor="let contentEntry of realNodeEntry.content; let isFirstChild = first; let idx = index" [isFirst]="isFirstChild" [firstBranchColor]="branchColors[idx]" [nodeEntry]="contentEntry"></ajf-fb-node-entry><mat-card class="ajf-empty" *ngIf="realNodeEntry.content.length === 0" cdkDropList [cdkDropListEnterPredicate]="disableSlideDropPredicate" (cdkDropListDropped)="onDropSuccess($event, true)">&nbsp;</mat-card></div></mat-card></ng-template><ng-template [ngIf]="!isNodeEntry"><mat-card class="ajf-empty" cdkDropList [cdkDropListEnterPredicate]="emptyAreaDropPredicate" (cdkDropListDropped)="onDropSuccess($event)">&nbsp;</mat-card></ng-template></div><ng-template [ngIf]="isNodeEntry"><ajf-fb-node-entry *ngFor="let childNodeEntry of realNodeEntry.children; let idx = index" [originOffset]="idx" [firstBranchColor]="branchColors[idx]" [nodeEntry]="childNodeEntry"></ajf-fb-node-entry></ng-template></ng-template>',styles:["ajf-fb-node-entry{display:block;position:relative}ajf-fb-node-entry .mat-card-container{position:relative}ajf-fb-node-entry .mat-card-container .ajf-origin-line{position:absolute;top:0;left:25px;width:25px;height:25px;border-bottom:2px solid;border-left:2px solid;border-bottom-left-radius:.5em}ajf-fb-node-entry .mat-card-container mat-card{margin-left:50px;padding:.5em 1em;margin-top:.2em;margin-bottom:.2em;background-color:#fff}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row{display:flex;flex-direction:row;align-items:center}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-title{flex:1 1 auto}ajf-fb-node-entry .mat-card-container mat-card .ajf-title-row>.ajf-actions{flex:0 0 auto;white-space:nowrap}ajf-fb-node-entry .mat-card-container mat-card.ajf-empty{line-height:36px;border:2px dashed;box-shadow:none;box-sizing:border-box}ajf-fb-node-entry .mat-card-container.ajf-highlight>mat-card{background-color:#fff9c4}"],host:{"(window.resize)":"onResize()"},encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],ai.ctorParameters=function(){return[{type:J}]},ai.propDecorators={branchLines:[{type:o.ViewChildren,args:[w]}],childEntries:[{type:o.ViewChildren,args:[ai,{read:o.ElementRef}]}],isFirst:[{type:o.Input}],nodeEntry:[{type:o.Input}],originOffset:[{type:o.Input}],firstBranchColor:[{type:o.Input}]},ai);function ai(i){this._service=i,this._hasContent=!1,this._isFirst=!1,this._isNodeEntry=!1,this._branchColors=oi.slice(0),this._dropZones=["fbdz-node"],this._slideDropZones=["fbdz-slide"],this._originOffset=0,this._originLeftMargin="0",this._firstBranchColor=oi[0],this._isSlide=!1,this._branchLinesSubscription=F.Subscription.EMPTY,this._childEntriesSubscription=F.Subscription.EMPTY,this._currentEditedNode=this._service.editedNodeEntry}var si=(Object.defineProperty(li.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),li.prototype.saveCondition=function(){if(null!=this.editor){var i=this.editor.editedValue;this.dialogRef.close({condition:i,errorMessage:this.errorMessage})}},li.decorators=[{type:o.Component,args:[{selector:"ajf-fb-validation-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3><mat-dialog-content><mat-form-field><input matInput [(ngModel)]="errorMessage" [placeholder]="\'Error message\' | translate"></mat-form-field><ajf-condition-editor [fields]="fields|async" [condition]="condition"></ajf-condition-editor></mat-dialog-content><mat-dialog-actions><button mat-button translate (click)="saveCondition()">Save</button> <button mat-button translate matDialogClose>Close</button></mat-dialog-actions>',styles:["ajf-fb-validation-condition-editor-dialog mat-dialog-content{overflow:visible}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],li.ctorParameters=function(){return[{type:J},{type:s.MatDialogRef}]},li.propDecorators={editor:[{type:o.ViewChild,args:[Q,{static:!0}]}]},li);function li(i,t){this.dialogRef=t,this._fields=i.flatFields.pipe(S.map(function(i){return i.sort(function(i,t){return i.name.localeCompare(t.name)})}))}var di=(Object.defineProperty(ci.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),ci.prototype.saveCondition=function(){if(null!=this.editor){var i=this.editor.editedValue;this.dialogRef.close({condition:i,warningMessage:this.warningMessage})}},ci.decorators=[{type:o.Component,args:[{selector:"ajf-fb-warning-condition-editor-dialog",template:'<h3 matDialogTitle translate>Edit condition</h3><mat-dialog-content><mat-form-field><input matInput [(ngModel)]="warningMessage" [placeholder]="\'Warning message\' | translate"></mat-form-field><ajf-condition-editor [fields]="fields|async" [condition]="condition"></ajf-condition-editor></mat-dialog-content><mat-dialog-actions><button mat-button translate (click)="saveCondition()">Save</button> <button mat-button translate matDialogClose>Close</button></mat-dialog-actions>',styles:["ajf-fb-warning-condition-editor-dialog mat-dialog-content{overflow:visible}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],ci.ctorParameters=function(){return[{type:J},{type:s.MatDialogRef}]},ci.propDecorators={editor:[{type:o.ViewChild,args:[Q,{static:!0}]}]},ci);function ci(i,t){this.dialogRef=t,this._fields=i.flatFields.pipe(S.map(function(i){return i.sort(function(i,t){return i.name.localeCompare(t.name)})}))}function ui(i){var t=i.value.minReps,e=i.value.maxReps;return null!=t&&null!=e&&e<t?{reps:"Min repetions cannot be greater than max repetitions"}:null}function pi(i){var t=i.value.minValue,e=i.value.maxValue;return null!=t&&null!=e&&e<t?{valueLimit:"Min value cannot be greater than max value"}:null}function fi(i){var t=i.value.minDigits,e=i.value.maxDigits;return null!=t&&null!=e&&e<t?{digits:"Min digits cannot be greater than max digits"}:null}var hi=(Object.defineProperty(gi.prototype,"fieldSizes",{get:function(){return this._fieldSizes},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"nodeEntry",{get:function(){return this._nodeEntry},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"choicesOrigins",{get:function(){return this._choicesOrigins},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"propertiesForm",{get:function(){return this._propertiesForm},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"hasChoices",{get:function(){return this._hasChoices},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"curVisibility",{get:function(){return this._curVisibility},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"curFormulaReps",{get:function(){return this._curFormulaReps},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"curChoicesFilter",{get:function(){return this._curChoicesFilter},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"curForceValue",{get:function(){return this._curForceValue},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"curFormula",{get:function(){return this._curFormula},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"conditionalBranches",{get:function(){return this._conditionalBranches},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"validationConditions",{get:function(){return this._validationConditions},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"warningConditions",{get:function(){return this._warningConditions},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"nextSlideCondition",{get:function(){return this._nextSlideCondition},enumerable:!0,configurable:!0}),Object.defineProperty(gi.prototype,"triggerConditions",{get:function(){return this._triggerConditions},enumerable:!0,configurable:!0}),gi.prototype.editVisibility=function(){this._editVisibilityEvt.emit()},gi.prototype.editConditionalBranch=function(i){i<0||i>=this._conditionalBranches.length||this._editConditionalBranchEvt.emit(i)},gi.prototype.editFormulaReps=function(){this._editFormulaRepsEvt.emit()},gi.prototype.editChoicesFilter=function(){this._editChoicesFilterEvt.emit()},gi.prototype.editFormula=function(){this._editFormulaEvt.emit()},gi.prototype.editForceValue=function(){this._editForceValueEvt.emit()},gi.prototype.editValidationCondition=function(i){i<0||i>=this._validationConditions.length||this._editValidationConditionEvt.emit(i)},gi.prototype.addValidationCondition=function(){this._addValidationConditionEvt.emit()},gi.prototype.removeValidationCondition=function(i){i<0||i>=this._validationConditions.length||this._removeValidationConditionEvt.emit(i)},gi.prototype.editWarningCondition=function(i){i<0||i>=this._warningConditions.length||this._editWarningConditionEvt.emit(i)},gi.prototype.addWarningCondition=function(){this._addWarningConditionEvt.emit()},gi.prototype.removeWarningCondition=function(i){i<0||i>=this._warningConditions.length||this._removeWarningConditionEvt.emit(i)},gi.prototype.editNextSlideCondition=function(){this._editNextSlideConditionEvt.emit()},gi.prototype.editTriggerCondition=function(i){i<0||i>=this._triggerConditions.length||this._editTriggerConditionEvt.emit(i)},gi.prototype.addTriggerCondition=function(){this._addTriggerConditionEvt.emit()},gi.prototype.removeTriggerCondition=function(i){i<0||i>=this._triggerConditions.length||this._removeTriggerConditionEvt.emit(i)},gi.prototype.isField=function(i){return x.isField(i)},gi.prototype.isNumericField=function(i){return x.isField(i)&&x.isNumberField(i)},gi.prototype.isFieldWithChoices=function(i){return x.isField(i)&&x.isFieldWithChoices(i)},gi.prototype.save=function(){this._saveEvt.emit()},gi.prototype.cancel=function(){this._service.cancelNodeEntryEdit()},gi.prototype.ngOnDestroy=function(){this._choicesOriginsSub.unsubscribe(),this._visibilitySub.unsubscribe(),this._formulaRepsSub.unsubscribe(),this._choicesFilterSub.unsubscribe(),this._formulaSub.unsubscribe(),this._forceValueSub.unsubscribe(),this._validationConditionsSub.unsubscribe(),this._warningConditionsSub.unsubscribe(),this._triggerConditionsSub.unsubscribe(),this._editConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub.unsubscribe(),this._editChoicesFilterSub.unsubscribe(),this._editConditionalBranchSub.unsubscribe(),this._editVisibilitySub.unsubscribe(),this._editFormulaRepsSub.unsubscribe(),this._editFormulaSub.unsubscribe(),this._editForceValueSub.unsubscribe(),this._editValidationConditionSub.unsubscribe(),this._editWarningConditionSub.unsubscribe(),this._nextSlideConditionSub.unsubscribe(),this._addTriggerConditionSub.unsubscribe(),this._addValidationConditionSub.unsubscribe(),this._addWarningConditionSub.unsubscribe(),this._editNextSlideConditionSub.unsubscribe(),this._editTriggerConditionSub.unsubscribe(),this._removeTriggerConditionSub.unsubscribe(),this._removeValidationConditionSub.unsubscribe(),this._removeWarningConditionSub.unsubscribe(),this._saveSub.unsubscribe()},gi.prototype._initSave=function(){var n=this;this._saveSub=this._saveEvt.pipe(S.withLatestFrom(this.propertiesForm)).subscribe(function(i){var t=i[1],e=T({},t.value,{conditionalBranches:n._conditionalBranches});n._service.saveNodeEntry(e)})},gi.prototype._initForm=function(){var j=this;this._propertiesForm=this._nodeEntry.pipe(S.filter(function(i){return null!=i}),S.map(function(i){null!=j._visibilitySub&&j._visibilitySub.unsubscribe(),null!=j._conditionalBranchesSub&&j._conditionalBranchesSub.unsubscribe();var t=null!=(i=i).node.visibility?i.node.visibility.condition:null,e=null!=i.node.visibility?j._guessVisibilityOpt(i.node.visibility):null,n={name:[i.node.name,E.Validators.required],label:i.node.label,visibilityOpt:[e,E.Validators.required],visibility:[t,E.Validators.required],conditionalBranchesNum:i.node.conditionalBranches.length},o=[];if(x.isRepeatingContainerNode(i.node)){var r=i.node,a=null!=r.formulaReps?r.formulaReps.formula:null;n.formulaReps=[a,E.Validators.required],n.minReps=r.minReps,n.maxReps=r.maxReps,j._curFormulaReps=a,o.push(ui)}if(j.isField(i.node)){var s=i.node,l=null,d=!1,c=[];null!=s.validation&&(null!=s.validation.forceValue&&(l=s.validation.forceValue.condition),d=null!=s.validation.notEmpty,c=(s.validation.conditions||[]).map(function(i){return{condition:i.condition,errorMessage:i.errorMessage}}));var u=!1,p=[];null!=s.warning&&(u=null!=s.warning.notEmpty,p=(s.warning.conditions||[]).map(function(i){return{condition:i.condition,warningMessage:i.warningMessage}}));var f=null!=s.formula?s.formula.formula:null;n.description=s.description,n.defaultValue=s.defaultValue,n.size=s.size,n.formula=f,n.forceValue=l,n.notEmpty=d,n.validationConditions=[c,[]],n.notEmptyWarning=u,n.warningConditions=[p,[]],n.nextSlideCondition=[s.nextSlideCondition],j._curForceValue=l,j._curFormula=f,j._validationConditions=c,j._warningConditions=p}if(j.isNumericField(i.node)){var h=i.node,g=void 0,m=void 0,b=void 0,v=void 0;null!=h.validation&&(null!=h.validation.minValue&&(g=(h.validation.minValue.condition||"").replace("$value >= ","")),null!=h.validation.maxValue&&(m=(h.validation.maxValue.condition||"").replace("$value <= ","")),null!=h.validation.minDigits&&(b=(h.validation.minDigits.condition||"").replace("$value.toString().length >= ","")),null!=h.validation.maxDigits&&(v=(h.validation.maxDigits.condition||"").replace("$value.toString().length <= ",""))),n.minValue=g,n.maxValue=m,n.minDigits=b,n.maxDigits=v,o.push(pi),o.push(fi)}if(j.isFieldWithChoices(i.node)){var _=i.node,y=(_.triggerConditions||[]).map(function(i){return i.condition});n.choicesOrigin=_.choicesOrigin.name,n.choicesFilter=null!=_.choicesFilter?_.choicesFilter.formula:null,n.forceExpanded=_.forceExpanded,n.forceNarrow=_.forceNarrow,n.triggerConditions=y,j._triggerConditions=y}var C=j._fb.group(n);return C.setValidators(o),j._conditionalBranches=i.node.conditionalBranches.map(function(i){return i.condition}),j._curVisibility=null!=i.node.visibility?i.node.visibility.condition:null,j._handleConditionalBranchesChange(C),j._handleVisibilityChange(C),j._handleFormulaRepsChange(C),j._handleChoicesFilterChange(C),j._handleFormulaChange(C),j._handleForceValueChange(C),j._handleValidationCondtionsChange(C),j._handleWarningCondtionsChange(C),j._handleNextSlideConditionChange(C),j._handleTriggerCondtionsChange(C),C}),S.publishReplay(1),S.refCount())},gi.prototype._destroyConditionDialog=function(){null!=this._editConditionDialogSub&&(this._editConditionDialogSub.unsubscribe(),this._editConditionDialogSub=F.Subscription.EMPTY),null!=this._editConditionDialog&&(this._editConditionDialog.close(),this._editConditionDialog=null)},gi.prototype._destroyValidationConditionDialog=function(){null!=this._editValidationConditionDialogSub&&(this._editValidationConditionDialogSub.unsubscribe(),this._editValidationConditionDialogSub=F.Subscription.EMPTY),null!=this._editValidationConditionDialog&&(this._editValidationConditionDialog.close(),this._editValidationConditionDialog=null)},gi.prototype._destroyWarningConditionDialog=function(){null!=this._editWarningConditionDialogSub&&(this._editWarningConditionDialogSub.unsubscribe(),this._editWarningConditionDialogSub=F.Subscription.EMPTY),null!=this._editWarningConditionDialog&&(this._editWarningConditionDialog.close(),this._editWarningConditionDialog=null)},gi.prototype._initRemoveTriggerCondition=function(){this._removeTriggerConditionSub=this._removeTriggerConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[0],e=i[1];if(null!=e){var n=e.controls.triggerConditions,o=(n.value||[]).slice(0);t<0||t>=o.length||(o.splice(t,1),n.setValue(o))}})},gi.prototype._initAddTriggerCondition=function(){this._addTriggerConditionSub=this._addTriggerConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[1];if(null!=t){var e=t.controls.triggerConditions,n=(e.value||[]).slice(0);n.push(""),e.setValue(n)}})},gi.prototype._initTriggerConditionEdit=function(){var n=this;this._editTriggerConditionSub=this._editTriggerConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[0],e=i[1];t<0||t>=n._triggerConditions.length||null==e||(n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=n._triggerConditions[t],n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&(n._triggerConditions[t]=i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY}))})},gi.prototype._initRemoveWarningCondition=function(){this._removeWarningConditionSub=this._removeWarningConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[0],e=i[1];if(null!=e){var n=e.controls.warningConditions,o=(n.value||[]).slice(0);t<0||t>=o.length||(o.splice(t,1),n.setValue(o))}})},gi.prototype._initAddWarningCondition=function(){this._addWarningConditionSub=this._addWarningConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[1];if(null!=t){var e=t.controls.warningConditions,n=(e.value||[]).slice(0);n.push({condition:"",errorMessage:""}),e.setValue(n)}})},gi.prototype._initWarningConditionEdit=function(){var r=this;this._editWarningConditionSub=this._editWarningConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){r._destroyWarningConditionDialog();var t=i[0],e=i[1];if(!(t<0||t>=r._warningConditions.length||null==e)){r._editWarningConditionDialog=r._dialog.open(di);var n=r._editWarningConditionDialog.componentInstance,o=r._warningConditions[t];n.condition=o.condition,n.warningMessage=o.warningMessage,r._editWarningConditionDialogSub=r._editWarningConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&(r._warningConditions[t]=i),r._editWarningConditionDialogSub.unsubscribe(),r._editWarningConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initRemoveValidationCondition=function(){this._removeValidationConditionSub=this._removeValidationConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[0],e=i[1];if(null!=e){var n=e.controls.validationConditions,o=(n.value||[]).slice(0);t<0||t>=o.length||(o.splice(t,1),n.setValue(o))}})},gi.prototype._initAddValidationCondition=function(){this._addValidationConditionSub=this._addValidationConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){var t=i[1];if(null!=t){var e=t.controls.validationConditions,n=(e.value||[]).slice(0);n.push({condition:"",errorMessage:""}),e.setValue(n)}})},gi.prototype._initValidationConditionEdit=function(){var r=this;this._editValidationConditionSub=this._editValidationConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){r._destroyValidationConditionDialog();var t=i[0],e=i[1];if(!(t<0||t>=r._validationConditions.length||null==e)){r._editValidationConditionDialog=r._dialog.open(si);var n=r._editValidationConditionDialog.componentInstance,o=r._validationConditions[t];n.condition=o.condition,n.errorMessage=o.errorMessage,r._editValidationConditionDialogSub=r._editValidationConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&(r._validationConditions[t]=i),r._editValidationConditionDialogSub.unsubscribe(),r._editValidationConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initForceValueEdit=function(){var n=this;this._editForceValueSub=this._editForceValueEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.forceValue;n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=e.value,n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initNextSlideConditionEdit=function(){var n=this;this._editNextSlideConditionSub=this._editNextSlideConditionEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.nextSlideCondition;n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=e.value,n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initFormulaEdit=function(){var n=this;this._editFormulaSub=this._editFormulaEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.formula;n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=e.value,n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initFormulaRepsEdit=function(){var n=this;this._editFormulaRepsSub=this._editFormulaRepsEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.formulaReps;n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=e.value,n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initChoicesFilterEdit=function(){var n=this;this._editChoicesFilterSub=this._editChoicesFilterEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.choicesFilter;n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=e.value,n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._initConditionalBranchEdit=function(){var n=this;this._editConditionalBranchSub=this._editConditionalBranchEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){n._destroyConditionDialog();var t=i[0],e=i[1];t<0||t>=n._conditionalBranches.length||null==e||(n._editConditionDialog=n._dialog.open(ii),n._editConditionDialog.componentInstance.condition=n._conditionalBranches[t],n._editConditionDialogSub=n._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&(n._conditionalBranches[t]=i),n._editConditionDialogSub.unsubscribe(),n._editConditionDialogSub=F.Subscription.EMPTY}))})},gi.prototype._initVisibilityEdit=function(){var o=this;this._editVisibilitySub=this._editVisibilityEvt.pipe(S.withLatestFrom(this._propertiesForm)).subscribe(function(i){o._destroyConditionDialog();var t=i[1];if(null!=t){var e=t.controls.visibility,n=e.value;o._editConditionDialog=o._dialog.open(ii),o._editConditionDialog.componentInstance.condition=n,o._editConditionDialogSub=o._editConditionDialog.afterClosed().subscribe(function(i){void 0!==i&&e.setValue(i),o._editConditionDialogSub.unsubscribe(),o._editConditionDialogSub=F.Subscription.EMPTY})}})},gi.prototype._handleTriggerCondtionsChange=function(i){var t=this;this._triggerConditionsSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return JSON.stringify(i.triggerConditions)===JSON.stringify(t.triggerConditions)})).subscribe(function(i){t._triggerConditions=i.triggerConditions})},gi.prototype._handleWarningCondtionsChange=function(i){var t=this;this._warningConditionsSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return JSON.stringify(i.warningConditions)===JSON.stringify(t.warningConditions)})).subscribe(function(i){t._warningConditions=i.warningConditions})},gi.prototype._handleValidationCondtionsChange=function(i){var t=this;this._validationConditionsSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return JSON.stringify(i.validationConditions)===JSON.stringify(t.validationConditions)})).subscribe(function(i){t._validationConditions=i.validationConditions})},gi.prototype._handleForceValueChange=function(i){var t=this;this._forceValueSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.forceValue===t.forceValue})).subscribe(function(i){t._curForceValue=i.forceValue})},gi.prototype._handleNextSlideConditionChange=function(i){var t=this;this._formulaSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.nextSlideCondition===t.nextSlideCondition})).subscribe(function(i){t._nextSlideCondition=i.nextSlideCondition})},gi.prototype._handleFormulaChange=function(i){var t=this;this._formulaSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.formula===t.formula})).subscribe(function(i){t._curFormula=i.formula})},gi.prototype._handleFormulaRepsChange=function(i){var t=this;this._formulaRepsSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.formulaReps===t.formulaReps})).subscribe(function(i){t._curFormulaReps=i.formulaReps})},gi.prototype._handleChoicesFilterChange=function(i){var t=this;this._choicesFilterSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.choicesFilter===t.choicesFilter})).subscribe(function(i){t._curChoicesFilter=i.choicesFilter})},gi.prototype._handleConditionalBranchesChange=function(i){var r=this;this._conditionalBranchesSub=i.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.conditionalBranchesNum===t.conditionalBranchesNum})).subscribe(function(i){var t=i.conditionalBranchesNum,e=r._conditionalBranches.length;if(e<t){for(var n=[],o=e;o<t;o++)n.push(D.alwaysCondition().condition);r._conditionalBranches=r._conditionalBranches.concat(n)}else t<e&&r._conditionalBranches.splice(0,e-t)})},gi.prototype._handleVisibilityChange=function(e){var n=this;this._visibilitySub=e.valueChanges.pipe(S.distinctUntilChanged(function(i,t){return i.visibilityOpt===t.visibilityOpt})).subscribe(function(i){var t;switch(i.visibilityOpt){case"always":t=D.alwaysCondition().condition;break;case"never":t=D.neverCondition().condition;break;default:t=null}n._curVisibility=t,e.controls.visibility.setValue(t)})},gi.prototype._guessVisibilityOpt=function(i){return 0===i.condition.localeCompare(D.alwaysCondition().condition)?"always":0===i.condition.localeCompare(D.neverCondition().condition)?"never":"condition"},gi.decorators=[{type:o.Component,args:[{selector:"ajf-fb-node-properties",template:'<div [style.display]="(enabled|async) ? \'none\' : \'block\'" class="ajf-disabled-overlay"></div><div class="ajf-header"><h3 translate>Properties</h3><mat-icon (click)="save()">save</mat-icon><mat-icon (click)="cancel()">cancel</mat-icon></div><ng-container *ngIf="nodeEntry|async as ne"><ng-container *ngIf="propertiesForm|async as pf"><form [formGroup]="pf" novalidate><div class="ajf-prop"><mat-form-field><input matInput formControlName="name" [placeholder]="\'Name\' | translate"></mat-form-field></div><div class="ajf-prop"><mat-form-field><input matInput formControlName="label" [placeholder]="\'Label\' | translate"></mat-form-field></div><div class="ajf-prop"><div class="ajf-select-container"><mat-select formControlName="visibilityOpt" [placeholder]="\'Visible\' | translate"><mat-option value="always" translate>Always</mat-option><mat-option value="never" translate>Never</mat-option><mat-option value="condition" translate>Condition...</mat-option></mat-select><button (click)="editVisibility()" [disabled]="pf.value[\'visibilityOpt\'] != \'condition\'" mat-raised-button [matTooltip]="curVisibility"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ curVisibility }}</span></div></button></div></div><div class="ajf-prop"><div><label translate>Branches</label></div><div><mat-slider formControlName="conditionalBranchesNum" thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider></div><div *ngFor="let branch of conditionalBranches; let idx = index"><button (click)="editConditionalBranch(idx)" mat-raised-button [matTooltip]="branch"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ branch }}</span></div></button></div></div><ng-template [ngIf]="isRepeatingContainerNode((ne)?.node)"><div class="ajf-prop"><div><label translate>Repetitions</label></div><div><button (click)="editFormulaReps()" mat-raised-button [matTooltip]="curFormulaReps"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ curFormulaReps }}</span></div></button></div><div><label translate>Min repetitions</label></div><div><mat-slider formControlName="minReps" thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider></div><div><label translate>Max repetitions</label></div><div><mat-slider formControlName="maxReps" thumbLabel tickInterval="auto" min="1" max="5" step="1"></mat-slider></div></div></ng-template><ng-template [ngIf]="isField((ne)?.node)"><div class="ajf-prop"><div class="ajf-select-container"><mat-select formControlName="size" [placeholder]="\'Size\' | translate"><mat-option *ngFor="let fieldSize of fieldSizes" [value]="fieldSize.value">{{ fieldSize.label }}</mat-option></mat-select></div></div><div class="ajf-prop"><mat-form-field><textarea matInput formControlName="description" [placeholder]="\'Description\' | translate"></textarea></mat-form-field></div><div class="ajf-prop"><mat-form-field><input matInput formControlName="defaultValue" [placeholder]="\'Default value\' | translate"></mat-form-field></div><div class="ajf-prop"><div><label translate>Formula</label></div><div><button (click)="editFormula()" mat-raised-button [matTooltip]="curFormula"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ curFormula }}</span></div></button></div></div><div class="ajf-prop"><div><label translate>Force value</label></div><div><button (click)="editForceValue()" mat-raised-button [matTooltip]="curForceValue"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ curForceValue }}</span></div></button></div></div><div class="ajf-prop"><mat-checkbox formControlName="notEmpty" translate>Not empty</mat-checkbox></div><ng-template [ngIf]="isNumericField((ne)?.node)"><div class="ajf-prop"><mat-form-field><input matInput formControlName="minValue" [placeholder]="\'Min value\' | translate"></mat-form-field></div><div class="ajf-prop"><mat-form-field><input matInput formControlName="maxValue" [placeholder]="\'Max value\' | translate"></mat-form-field></div><div class="ajf-prop"><mat-form-field><input matInput formControlName="minDigits" [placeholder]="\'Min digits\' | translate"></mat-form-field></div><div class="ajf-prop"><mat-form-field><input matInput formControlName="maxDigits" [placeholder]="\'Max digits\' | translate"></mat-form-field></div></ng-template><div class="ajf-prop"><div class="ajf-header"><label translate>Validation</label><mat-icon class="ajf-pointer" (click)="addValidationCondition()">add_circle_outline</mat-icon></div><div *ngIf="validationConditions == null || validationConditions.length == 0" class="ajf-validation-row ajf-emph" translate>No conditions</div><div class="ajf-validation-row" *ngFor="let validationCondition of validationConditions; let idx = index"><button (click)="editValidationCondition(idx)" mat-raised-button [matTooltip]="validationCondition.condition"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ validationCondition.condition }}</span></div></button><mat-icon class="ajf-pointer" (click)="removeValidationCondition(idx)">remove_circle_outline</mat-icon></div></div><div class="ajf-prop"><mat-checkbox formControlName="notEmptyWarning" translate>Not empty warning</mat-checkbox></div><div class="ajf-prop"><div class="ajf-header"><label translate>Warnings</label><mat-icon class="ajf-pointer" (click)="addWarningCondition()">add_circle_outline</mat-icon></div><div *ngIf="warningConditions == null || warningConditions.length == 0" class="ajf-validation-row ajf-emph" translate>No warnings</div><div class="ajf-validation-row" *ngFor="let warningCondition of warningConditions; let idx = index"><button (click)="editWarningCondition(idx)" mat-raised-button [matTooltip]="warningCondition.condition"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ warningCondition.condition }}</span></div></button><mat-icon class="ajf-pointer" (click)="removeWarningCondition(idx)">remove_circle_outline</mat-icon></div></div><div class="ajf-prop"><div><label translate>Go to next slide condition</label></div><div><button (click)="editNextSlideCondition()" mat-raised-button [matTooltip]="nextSlideCondition"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ nextSlideCondition }}</span></div></button></div></div><ng-template [ngIf]="isFieldWithChoices((ne)?.node)"><div class="ajf-prop"><div class="ajf-select-container"><mat-select formControlName="choicesOrigin" [placeholder]="\'Choices\' | translate"><mat-option *ngFor="let choicesOrigin of choicesOrigins" [value]="choicesOrigin.name">{{ choicesOrigin.label || choicesOrigin.name }}</mat-option></mat-select></div></div><div class="ajf-prop"><div><label translate>Choices filter</label></div><div><button (click)="editChoicesFilter()" mat-raised-button [matTooltip]="curChoicesFilter"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ curChoicesFilter }}</span></div></button></div></div><div class="ajf-prop"><mat-checkbox formControlName="forceExpanded" translate>Force expanded selection</mat-checkbox></div><div class="ajf-prop"><mat-checkbox formControlName="forceNarrow" translate>Force narrow selection</mat-checkbox></div><div class="ajf-prop"><div class="ajf-header"><label translate>Trigger selection</label><mat-icon class="ajf-pointer" (click)="addTriggerCondition()">add_circle_outline</mat-icon></div><div *ngIf="triggerConditions == null || triggerConditions.length == 0" class="ajf-validation-row ajf-emph" translate>No trigger condition</div><div class="ajf-validation-row" *ngFor="let triggerCondition of triggerConditions; let idx = index"><button (click)="editTriggerCondition(idx)" mat-raised-button [matTooltip]="triggerCondition"><div class="ajf-icon-cont"><mat-icon>edit</mat-icon><span>{{ triggerCondition }}</span></div></button><mat-icon class="pointer" (click)="removeTriggerCondition(idx)">remove_circle_outline</mat-icon></div></div></ng-template></ng-template></form></ng-container></ng-container>',styles:["ajf-fb-node-properties{display:block;padding:1em;position:relative}ajf-fb-node-properties mat-icon{cursor:pointer}ajf-fb-node-properties .ajf-header{display:flex;flex-direction:row;align-items:center;flex-wrap:nowrap}ajf-fb-node-properties .ajf-header>h3,ajf-fb-node-properties .ajf-header>label{flex:1 0 auto;margin-right:.5em}ajf-fb-node-properties .ajf-header>mat-icon{flex:0 0 auto;margin-left:.5em}ajf-fb-node-properties .ajf-disabled-overlay{position:absolute;top:0;right:0;bottom:0;left:0;opacity:.4;background-color:#fff}ajf-fb-node-properties .ajf-select-container{padding-top:16px;display:flex;flex-direction:column;align-items:stretch}ajf-fb-node-properties .ajf-emph{font-style:italic}ajf-fb-node-properties [mat-raised-button]{margin:.5em 0}ajf-fb-node-properties [mat-raised-button].ajf-pointer{cursor:pointer}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont{display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties [mat-raised-button] .ajf-icon-cont span{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;display:block;min-height:36px}ajf-fb-node-properties .ajf-validation-row{margin:.5em 0;display:flex;flex-direction:row;align-items:center}ajf-fb-node-properties .ajf-validation-row button{flex:1 1 auto}ajf-fb-node-properties .ajf-validation-row mat-icon{flex:0 0 auto}ajf-fb-node-properties .ajf-prop{margin:.5em 0}ajf-fb-node-properties [mat-raised-button],ajf-fb-node-properties mat-form-field,ajf-fb-node-properties mat-slider{width:100%}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],gi.ctorParameters=function(){return[{type:J},{type:s.MatDialog},{type:E.FormBuilder}]},gi);function gi(i,t,e){var n=this;this._service=i,this._dialog=t,this._fb=e,this._fieldSizes=[{label:"Normal",value:"normal"},{label:"Small",value:"small"},{label:"Smaller",value:"smaller"},{label:"Tiny",value:"tiny"},{label:"Mini",value:"mini"}],this._choicesOrigins=[],this._conditionalBranches=[],this._validationConditions=[],this._warningConditions=[],this.isRepeatingContainerNode=x.isRepeatingContainerNode,this._visibilitySub=F.Subscription.EMPTY,this._conditionalBranchesSub=F.Subscription.EMPTY,this._formulaRepsSub=F.Subscription.EMPTY,this._choicesFilterSub=F.Subscription.EMPTY,this._formulaSub=F.Subscription.EMPTY,this._forceValueSub=F.Subscription.EMPTY,this._validationConditionsSub=F.Subscription.EMPTY,this._warningConditionsSub=F.Subscription.EMPTY,this._nextSlideConditionSub=F.Subscription.EMPTY,this._choicesOriginsSub=F.Subscription.EMPTY,this._triggerConditionsSub=F.Subscription.EMPTY,this._editConditionDialogSub=F.Subscription.EMPTY,this._editValidationConditionDialogSub=F.Subscription.EMPTY,this._editWarningConditionDialogSub=F.Subscription.EMPTY,this._editVisibilityEvt=new o.EventEmitter,this._editVisibilitySub=F.Subscription.EMPTY,this._editConditionalBranchEvt=new o.EventEmitter,this._editConditionalBranchSub=F.Subscription.EMPTY,this._editFormulaRepsEvt=new o.EventEmitter,this._editFormulaRepsSub=F.Subscription.EMPTY,this._editChoicesFilterEvt=new o.EventEmitter,this._editChoicesFilterSub=F.Subscription.EMPTY,this._editFormulaEvt=new o.EventEmitter,this._editFormulaSub=F.Subscription.EMPTY,this._editForceValueEvt=new o.EventEmitter,this._editForceValueSub=F.Subscription.EMPTY,this._editValidationConditionEvt=new o.EventEmitter,this._editValidationConditionSub=F.Subscription.EMPTY,this._addValidationConditionEvt=new o.EventEmitter,this._addValidationConditionSub=F.Subscription.EMPTY,this._removeValidationConditionEvt=new o.EventEmitter,this._removeValidationConditionSub=F.Subscription.EMPTY,this._editWarningConditionEvt=new o.EventEmitter,this._editWarningConditionSub=F.Subscription.EMPTY,this._addWarningConditionEvt=new o.EventEmitter,this._addWarningConditionSub=F.Subscription.EMPTY,this._removeWarningConditionEvt=new o.EventEmitter,this._removeWarningConditionSub=F.Subscription.EMPTY,this._editNextSlideConditionEvt=new o.EventEmitter,this._editNextSlideConditionSub=F.Subscription.EMPTY,this._editTriggerConditionEvt=new o.EventEmitter,this._editTriggerConditionSub=F.Subscription.EMPTY,this._addTriggerConditionEvt=new o.EventEmitter,this._addTriggerConditionSub=F.Subscription.EMPTY,this._removeTriggerConditionEvt=new o.EventEmitter,this._removeTriggerConditionSub=F.Subscription.EMPTY,this._saveEvt=new o.EventEmitter,this._saveSub=F.Subscription.EMPTY,this._nodeEntry=i.editedNodeEntry,this._choicesOriginsSub=i.choicesOrigins.subscribe(function(i){return n._choicesOrigins=i||[]}),this._enabled=this._nodeEntry.pipe(S.map(function(i){return null!=i})),this._initForm(),this._initVisibilityEdit(),this._initConditionalBranchEdit(),this._initFormulaRepsEdit(),this._initChoicesFilterEdit(),this._initFormulaEdit(),this._initForceValueEdit(),this._initValidationConditionEdit(),this._initAddValidationCondition(),this._initRemoveValidationCondition(),this._initWarningConditionEdit(),this._initAddWarningCondition(),this._initRemoveWarningCondition(),this._initNextSlideConditionEdit(),this._initTriggerConditionEdit(),this._initAddTriggerCondition(),this._initRemoveTriggerCondition(),this._initSave()}var mi=(Object.defineProperty(bi.prototype,"nodeType",{get:function(){return this._nodeType},set:function(i){this._nodeType=i,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),bi.decorators=[{type:o.Component,args:[{selector:"ajf-fb-node-type-entry",template:'<ng-container *ngIf="nodeType"><mat-icon [fontSet]="nodeType.icon.fontSet" [fontIcon]="nodeType.icon.fontIcon"></mat-icon>{{ nodeType.label }}</ng-container>',styles:["ajf-fb-node-type-entry{display:block;padding:1em 1.5em}ajf-fb-node-type-entry mat-icon{vertical-align:middle}"],encapsulation:o.ViewEncapsulation.None,changeDetection:o.ChangeDetectionStrategy.OnPush}]}],bi.ctorParameters=function(){return[{type:o.ChangeDetectorRef}]},bi.propDecorators={nodeType:[{type:o.Input}]},bi);function bi(i){this._cdr=i}var vi=(_i.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule,E.FormsModule,E.ReactiveFormsModule,e.DragDropModule,n.MatButtonModule,r.MatCardModule,a.MatCheckboxModule,s.MatDialogModule,l.MatFormFieldModule,d.MatIconModule,c.MatInputModule,u.MatListModule,p.MatMenuModule,f.MatSelectModule,h.MatSidenavModule,g.MatSliderModule,m.MatTableModule,b.MatToolbarModule,v.MatTooltipModule,_.TranslateModule,y.AjfMonacoEditorModule,C.AjfNodeIconModule],declarations:[w,G,B,ii,Q,ri,hi,mi,si,di,ei],exports:[ei],entryComponents:[G,ii,si,di],providers:[J]}]}],_i);function _i(){}i.AjfFormBuilder=ei,i.AjfFormBuilderModule=vi,i.AjfFormBuilderService=J,i.flattenNodes=q,i.a=w,i.b=G,i.c=B,i.d=ii,i.e=Q,i.f=ri,i.g=hi,i.h=mi,i.i=si,i.j=di,Object.defineProperty(i,"__esModule",{value:!0})});
//# sourceMappingURL=material-form-builder.umd.min.js.map
